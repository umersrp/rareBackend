import{R as D,r as i,j as a,F as b,b as d,I as J,C as k,an as B}from"./index.5e55c1ba.js";import{D as ee}from"./index.esm.c068ea99.js";import"./jspdf.es.min.085956f0.js";import"./html2canvas.esm.0eae2bf4.js";import{r as C}from"./index.c89ffb9d.js";const K=D.forwardRef(({allBooking:e,propertyData:n},O)=>{function x(t,s){if(s<1||s>12||isNaN(s)||isNaN(t))throw new Error("Invalid month or year");return new Date(t,s,0).getDate()}function f(t,s){if(isNaN(s)||isNaN(t)||s<1||s>12)throw new Error("Invalid month or year");return`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][s-1]} ${t}`}i.exports.useState("");const y=[{Header:"Sr no",accessor:"id",Cell:({row:t,flatRows:s})=>a("span",{children:s.indexOf(t)+1})},{Header:"MONTH / PERIOD",accessor:"guestname",Cell:t=>{const{original:s}=(t==null?void 0:t.row)||{},c=s==null?void 0:s.year,h=s==null?void 0:s.month;let o="Not Available";return c&&h&&(o=`${f(c,h)}`),a("div",{children:a("span",{className:"inline-flex items-center",children:a("span",{className:"text-sm text-slate-600 dark:text-slate-300",children:o})})})}},{Header:"TOTAL AVAILABLE NUMBER OF NIGHTS / MONTH",accessor:"guestnames",Cell:t=>{const{original:s}=(t==null?void 0:t.row)||{},c=s==null?void 0:s.year,h=s==null?void 0:s.month;let o="Not Available";return c&&h&&(o=`${x(c,h)} nights`),a("div",{children:a("span",{className:"inline-flex items-center",children:a("span",{className:"text-sm text-slate-600 dark:text-slate-300",children:o})})})}},{Header:"NO OF NIGHTS BOOKED",accessor:"totalNonight",Cell:t=>{var s,c;return a("span",{children:(s=t==null?void 0:t.cell)!=null&&s.value?(c=t==null?void 0:t.cell)==null?void 0:c.value:"Not Available"})}},{Header:"AVERAGE RATE PER NIGHT",accessor:"averageCost",Cell:t=>{var s,c;return a("span",{children:(s=t==null?void 0:t.cell)!=null&&s.value?(c=t==null?void 0:t.cell)==null?void 0:c.value:"Not Available"})}},{Header:"OCCUPANCY RATE",accessor:"checkindate",Cell:t=>{const{original:s}=(t==null?void 0:t.row)||{},c=s==null?void 0:s.year,h=s==null?void 0:s.month,o=s==null?void 0:s.totalNonight;let u="Not Available";if(c&&h){const P=x(c,h);u=`${Number(Math.round(o/P*100)).toFixed(0)} %`}return a("div",{children:a("span",{className:"inline-flex items-center",children:a("span",{className:"text-sm text-slate-600 dark:text-slate-300",children:u})})})}},{Header:"REFUND /CANCELLATIONT",accessor:"refund",Cell:t=>{var s,c;return a("span",{children:(s=t==null?void 0:t.cell)!=null&&s.value?(c=t==null?void 0:t.cell)==null?void 0:c.value:"Not Available"})}},{Header:"TOTAL BOOKING AMOUNT",accessor:"totalhostpayble",Cell:t=>{var s,c;return a("span",{children:(s=t==null?void 0:t.cell)!=null&&s.value?(c=t==null?void 0:t.cell)==null?void 0:c.value:"Not Available"})}}],g=i.exports.useMemo(()=>y,[]),E=i.exports.useMemo(()=>e),p=C.exports.useTable({columns:g,data:E,initialState:{pageIndex:0,pageSize:50}},C.exports.useGlobalFilter,C.exports.useSortBy,C.exports.usePagination,C.exports.useRowSelect),{getTableProps:M,getTableBodyProps:T,headerGroups:I,footerGroups:z,page:S,nextPage:F,previousPage:H,canNextPage:N,canPreviousPage:v,pageOptions:A,state:l,gotoPage:m,pageCount:r,setPageSize:q,setGlobalFilter:se,prepareRow:Y}=p,{globalFilter:ae,pageIndex:_,pageSize:V}=l,[R,Q]=i.exports.useState(0),[j,W]=i.exports.useState(0),[L,X]=i.exports.useState(0),[$,Z]=i.exports.useState(0),[G,w]=i.exports.useState(0);return i.exports.useEffect(()=>{if(e!=null&&e.length){let t=[];e.filter(s=>{const{year:c,month:h}=s;c&&h&&t.push(x(c,h))}),Q(t.reduce((s,c)=>s+c,0))}},[e==null?void 0:e.length]),i.exports.useEffect(()=>{if(e!=null&&e.length){let t=[],s=[];e.filter(o=>{const{year:u,month:P,totalNonight:U}=o;u&&P&&t.push(x(u,P)),U&&s.push(U)});let c=t.reduce((o,u)=>o+u,0),h=s.reduce((o,u)=>o+u,0);X(Math.round(h/c*100))}},[e==null?void 0:e.length]),i.exports.useEffect(()=>{var t;if(e!=null&&e.length){let s=0;for(let c=0;c<(e==null?void 0:e.length);c++){let h=parseFloat((t=e[c])==null?void 0:t.totalNonight);s+=h}Z(s||0)}},[e==null?void 0:e.length]),i.exports.useEffect(()=>{var t;if(e!=null&&e.length){let s=0;for(let c=0;c<(e==null?void 0:e.length);c++){let h=parseFloat((t=e[c])==null?void 0:t.averageCost);s+=h}w(s||0)}},[e==null?void 0:e.length]),i.exports.useEffect(()=>{var t;if(e!=null&&e.length){let s=0;for(let c=0;c<(e==null?void 0:e.length);c++){let h=parseFloat((t=e[c])==null?void 0:t.totalhostpayble);s+=h}W(s||0)}},[e==null?void 0:e.length]),a(b,{children:d("div",{ref:O,children:[d("div",{className:"mt-[25px]",children:[d("div",{className:"flex gap-x-[10px]",children:[a("p",{className:"font-semibold",children:"Landlord Name: "}),a("p",{className:"capitalize",children:n!=null&&n.owner_name?n==null?void 0:n.owner_name:"Not Avaiable"})]}),d("div",{className:"flex gap-x-[10px]",children:[a("p",{className:"font-semibold",children:"Community Name: "}),a("p",{className:"capitalize",children:n!=null&&n.communityname?n==null?void 0:n.communityname:"Not Avaiable"})]}),d("div",{className:"flex gap-x-[10px]",children:[a("p",{className:"font-semibold",children:"Project Name: "}),a("p",{className:"capitalize",children:n!=null&&n.project_name?n==null?void 0:n.project_name:"Not Avaiable"})]}),d("div",{className:"flex gap-x-[10px]",children:[a("p",{className:"font-semibold",children:"Apartment No: "}),a("p",{className:"capitalize",children:n!=null&&n.unitnumber?n==null?void 0:n.unitnumber:"Not Avaiable"})]}),d("div",{className:"flex gap-x-[10px]",children:[a("p",{className:"font-semibold",children:"Building No: "}),a("p",{className:"capitalize",children:n!=null&&n.building_name?n==null?void 0:n.building_name:"Not Avaiable"})]})]}),a("div",{className:"overflow-x-auto -mx-6 mt-6",children:a("div",{className:"inline-block min-w-full align-middle",children:a("div",{className:"",children:d("table",{className:"min-w-[100%] overflow-x-scroll divide-y divide-slate-100 table-fixed dark:divide-slate-700",...M,children:[a("thead",{className:"bg-slate-200 dark:bg-slate-700",children:I.map(t=>a("tr",{...t.getHeaderGroupProps(),children:t.headers.map(s=>d("th",{...s.getHeaderProps(s.getSortByToggleProps()),scope:"col",className:"table-th",children:[s.render("Header"),a("span",{children:s.isSorted?s.isSortedDesc?" \u{1F53D}":" \u{1F53C}":""})]}))}))}),d("tbody",{className:"bg-white divide-y divide-slate-100 dark:bg-slate-800 dark:divide-slate-700",...T,children:[S&&S.length>0&&S.map(t=>(Y(t),a(b,{children:a("tr",{...t.getRowProps(),children:t.cells.map(s=>a("td",{...s.getCellProps(),className:"table-td",children:s.render("Cell")}))})}))),d("tr",{children:[a("td",{}),a("td",{}),a("td",{className:"table-td",children:(R==null?void 0:R.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0}))+"  Available Nights"}),a("td",{className:"table-td",children:($==null?void 0:$.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0}))+"  Booked Nights"}),a("td",{className:"table-td",children:(G==null?void 0:G.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))+" AED"}),a("td",{className:"table-td",children:(L==null?void 0:L.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0}))+" %"}),a("td",{}),a("td",{className:"table-td",children:(j==null?void 0:j.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))+" AED"}),a("td",{})]})]})]})})})}),d("div",{className:"md:flex md:space-y-0 space-y-5 justify-between mt-6 items-center",children:[d("div",{className:" flex items-center space-x-3 rtl:space-x-reverse",children:[a("select",{className:"form-control py-2 w-max",value:V,onChange:t=>q(Number(t.target.value)),children:[50,100,200].map(t=>d("option",{value:t,children:["Show ",t]},t))}),d("span",{className:"text-sm font-medium text-slate-600 dark:text-slate-300",children:["Page"," ",d("span",{children:[_+1," of ",A.length]})]})]}),d("ul",{className:"flex items-center  space-x-3  rtl:space-x-reverse",children:[a("li",{className:"text-xl leading-4 text-slate-900 dark:text-white rtl:rotate-180",children:a("button",{className:` ${v?"":"opacity-50 cursor-not-allowed"}`,onClick:()=>m(0),disabled:!v,children:a(J,{icon:"heroicons:chevron-double-left-solid"})})}),a("li",{className:"text-sm leading-4 text-slate-900 dark:text-white rtl:rotate-180",children:a("button",{className:` ${v?"":"opacity-50 cursor-not-allowed"}`,onClick:()=>H(),disabled:!v,children:"Prev"})}),A.map((t,s)=>a("li",{children:a("button",{href:"#","aria-current":"page",className:` ${s===_?"bg-slate-900 dark:bg-slate-600  dark:text-slate-200 text-white font-medium ":"bg-slate-100 dark:bg-slate-700 dark:text-slate-400 text-slate-900  font-normal  "}    text-sm rounded leading-[16px] flex h-6 w-6 items-center justify-center transition-all duration-150`,onClick:()=>m(s),children:t+1})},s)),a("li",{className:"text-sm leading-4 text-slate-900 dark:text-white rtl:rotate-180",children:a("button",{className:` ${N?"":"opacity-50 cursor-not-allowed"}`,onClick:()=>F(),disabled:!N,children:"Next"})}),a("li",{className:"text-xl leading-4 text-slate-900 dark:text-white rtl:rotate-180",children:a("button",{onClick:()=>m(r-1),disabled:!N,className:` ${N?"":"opacity-50 cursor-not-allowed"}`,children:a(J,{icon:"heroicons:chevron-double-right-solid"})})})]})]})]})})}),te={option:(e,n)=>({...e,fontSize:"14px"})},re=()=>{var A;const[e,n]=i.exports.useState({propertyid:"",filteredDates:[]}),[O,x]=i.exports.useState([]),[f,y]=i.exports.useState(""),[g,E]=i.exports.useState(""),[p,M]=i.exports.useState([]),[T,I]=i.exports.useState("");i.exports.useEffect(()=>{fetch("http://dev-rare.srp.ai/property").then(l=>l.json()).then(l=>{const m=l==null?void 0:l.map(r=>({label:r.unitnumber+" | "+r.communityname+" | "+r.projectname+" | "+r.buildingname,value:r._id}));M(m)})},[]),i.exports.useEffect(()=>{(async()=>{if(e!=null&&e.propertyid){const r=await(await fetch(`http://dev-rare.srp.ai/property/${e==null?void 0:e.propertyid}`)).json();r&&I(r)}})()},[e==null?void 0:e.propertyid]),i.exports.useEffect(()=>{(async()=>{const r=await(await fetch("http://dev-rare.srp.ai/booking")).json();y(r)})()},[]);const[z,S]=i.exports.useState({startDate:"",endDate:""}),F=i.exports.useRef(null),H=async()=>{const m=await(await fetch(`http://dev-rare.srp.ai/booking/summary/${e==null?void 0:e.propertyid}`)).json();x(m.data),console.log("=============>",m)};i.exports.useEffect(()=>{if(f!=null&&f.length&&(e==null?void 0:e.propertyid)&&(e==null?void 0:e.startDate)&&(e==null?void 0:e.endDate)){const l=f.filter(m=>{let r=!0;return e.propertyid&&m.propertyid!==e.propertyid&&(r=!1),(m==null?void 0:m.checkindate)<(e==null?void 0:e.startDate)&&(m==null?void 0:m.checkindate)>(e==null?void 0:e.endDate)&&(r=!1),r});x(l)}H()},[e==null?void 0:e.propertyid,e==null?void 0:e.startDate,e==null?void 0:e.endDate,f]);const N=()=>{E(""),n({...e,filteredDates:[]}),S({startDate:null,endDate:null})},v=async l=>{if(console.log("newValue",l),E(l),!l){n({...e,filteredDates:[]});return}const r=await(await fetch(`http://dev-rare.srp.ai/booking/summarybyDates/${e==null?void 0:e.propertyid}?fromdate=${l.startDate}&todate=${l.endDate}`)).json();n({...e,filteredDates:r==null?void 0:r.data})};return a(b,{children:a("div",{className:"xl:col-span-2 col-span-1",children:d(k,{title:"Booking Summary",children:[a("div",{className:"flex flex-row-reverse"}),d("div",{children:[d("form",{className:"lg:grid-cols-3 grid gap-5 grid-cols-1 ",children:[a("div",{className:"w-[100%] col-span-3",children:a("h4",{className:"text-base text-slate-800 dark:text-slate-300 mb-[0.5rem] mt-[0.5rem]",children:"Select Property"})}),a("div",{className:"w-[100%] col-span-3",children:a(B,{label:"Basic Select",className:"react-select",classNamePrefix:"select",options:p,value:p&&g?p.filter(function(l){return l.value===(e==null?void 0:e.propertyid)}):p.filter(function(l){return l.value===(e==null?void 0:e.propertyid)}),onChange:l=>{g?N():n({...e,propertyid:l==null?void 0:l.value})},styles:te,id:"hh",placeholder:"Select and Search property"})})]}),console.log("userData222=========HJKL=====>",e),e.propertyid&&a(b,{children:d("div",{className:"flex justify-end mt-[25px]",children:[a("div",{className:"w-[150px]",children:a("div",{className:"date-range-custom relative",children:a(ee,{value:z,inputClassName:"input-class",containerClassName:"container-class",onChange:v,placeholder:"SELECT DATE"})})}),g&&a("div",{className:"flex justify-end",children:a("div",{className:"w-[90px]",children:a("div",{className:"date-range-custom relative",children:a("button",{className:"btn btn-dark text-white  text-center",type:"button",onClick:N,children:"Reset"})})})})]})})]}),(A=e.filteredDates)!=null&&A.length?a(b,{children:a(K,{allBooking:e.filteredDates,propertyData:T,ref:F})}):a(b,{children:a(K,{allBooking:O,propertyData:T,ref:F})})]})})})};export{re as default};
