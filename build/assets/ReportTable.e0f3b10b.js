import{R as _,j as a,F as N,r as o,b as h,C as Ee,ap as Te}from"./index.300fc045.js";import{L as Ce}from"./Rare logo New Gif Loading.02c4dc82.js";import{D as Oe}from"./index.esm.6d76aaaf.js";import"./jspdf.es.min.3e3f0040.js";import"./html2canvas.esm.0eae2bf4.js";import{E as Pe}from"./exceljs.min.caa97cb3.js";import{E as Re}from"./excel.9601f4f9.js";var t="C:\\Users\\LENOVO\\Desktop\\rareProjects\\Rare_Frontend\\src\\pages\\owner-pages\\booking\\summary-reports\\ReportTable.jsx";const w=_.forwardRef(({indeterminate:b,...S},g)=>{const A=_.useRef(),r=g||A;return _.useEffect(()=>{r.current.indeterminate=b},[r,b]),a(N,{children:a("input",{type:"checkbox",ref:r,...S,className:"table-checkbox"},void 0,!1,{fileName:t,lineNumber:33,columnNumber:17},void 0)},void 0,!1)}),ke={option:(b,S)=>({...b,fontSize:"14px"})},Xe=({title:b,allData:S})=>{var U,G,$,z,V,K,q,W,Y,J,Q;const[g,A]=o.exports.useState([]);o.exports.useState([]);const[r,E]=o.exports.useState([]),ee=localStorage.getItem("isAuth"),f=JSON.parse(ee),[L,ae]=o.exports.useState();o.exports.useState(0),o.exports.useState(0),o.exports.useState();const[I,le]=o.exports.useState(),[x,te]=o.exports.useState([]),[T,y]=o.exports.useState(!1),[ie,re]=o.exports.useState({filteredData:[],PropertyData:{}});o.exports.useState(!1);const[n,C]=o.exports.useState({propertyid:"",filteredDates:[]}),[oe,se]=o.exports.useState({startDate:"",endDate:""}),[O,H]=o.exports.useState("");console.log("selectedProperty",n,"ownerBooking",r);const ne=async e=>{y(!0),H(e);const l=await(await fetch(`http://dev-rare.srp.ai/booking/summarybyDates/${n==null?void 0:n.propertyid}?fromdate=${e.startDate}&todate=${e.endDate}`)).json();console.log("=============>",l),y(!1),C({...n,filteredDates:l==null?void 0:l.data}),E(l==null?void 0:l.data);const u=n.propertyname.split(" | ").shift(),D=m.map(X=>{const{owner_name:P,building_name:R,communityname:v,project_name:Z,unitnumber:k}=X;if(u==k)return{owner_name:P,building_name:R,community_name:v,project_name:Z,unitnumber:k}}),p=me(D);re({filteredData:l==null?void 0:l.data,PropertyData:p})},[m,ce]=o.exports.useState([]),de=e=>{const i=new Set;return e.filter(l=>i.has(l._id)?!1:(i.add(l._id),!0))},me=e=>{const i=new Set;return e.filter(l=>l!==void 0&&!i.has(l.unitnumber)?(i.add(l.unitnumber),!0):!1)};o.exports.useEffect(()=>{(async()=>{try{const i=`http://dev-rare.srp.ai/property/api/advancesearch?customerid=${f==null?void 0:f._id}&sort=descending&type=customer&page=0&perPage=all`,l=`http://dev-rare.srp.ai/property/api/advancesearch?owner_representative_id=${f==null?void 0:f._id}&sort=descending&type=customer&page=0&perPage=all`,c=await fetch(i);if(!c.ok&&c.status!==400)throw new Error(`API 1 failed with status: ${c.status}`);const d=c.status===400?[]:await c.json(),s=await fetch(l);if(!s.ok&&s.status!==400)throw new Error(`API 2 failed with status: ${s.status}`);const u=s.status===400?[]:await s.json(),p=[...d,...u].map(v=>v._id),P=(await Promise.all(p.map(async v=>await(await fetch(`http://dev-rare.srp.ai/booking/ownerrepresentative/pages?propertyid=${v}&page=0&perPage=all`)).json()))).flat([2]),R=de(P);A(R)}catch(i){console.error("Error fetching data:",i),setLoadingData(!1)}})()},[]),o.exports.useEffect(()=>{(async()=>{const i=g.map(async c=>{const{propertyid:d}=c;return await(await fetch(`http://dev-rare.srp.ai/property/${d}`)).json()}),l=await Promise.all(i);ce(l)})()},[g]),o.exports.useEffect(()=>{if(y(!0),m.length){const e=[...new Map(m.map(l=>[l._id,l])).values()],i=e==null?void 0:e.map(l=>({label:l.unitnumber+" | "+l.communityname+" | "+l.projectname+" | "+l.buildingname,value:l._id}));y(!1),te(i)}},[m]),o.exports.useEffect(()=>{(async()=>{const l=await(await fetch(`http://dev-rare.srp.ai/booking/summary/${n==null?void 0:n.propertyid}`)).json();E(l==null?void 0:l.data)})()},[n.propertyid]);function ue(e){const{filteredData:i,PropertyData:l}=e,c=new Pe.Workbook,d=c.addWorksheet("CombinedSheet");d.mergeCells("A1:E1"),d.addRow(["PROPERTY DETAIL"]),d.columns=[{header:"Landlord Name",key:"owner_name",width:40,fgColor:{argb:"008000"}},{header:"Community Name",key:"community_name",width:40,fgColor:{argb:"008000"}},{header:"Project Name",key:"project_name",width:40},{header:"Apartment No",key:"unitnumber",width:35},{header:"Building No",key:"building_name",width:55}],l&&([["Landlord Name","Community Name","Project Name","Apartment No","Building No"],...l.map(u=>[u.owner_name,u.community_name,u.project_name,u.unitnumber,u.building_name])].forEach(u=>{d.addRow(u)}),d.addRow([])),d.addRow(["MONTH / PERIOD","TOTAL AVAILABLE NUMBER OF NIGHTS / MONTH","NO OF NIGHTS BOOKED","AVERAGE RATE PER NIGHT","OCCUPANCY RATE","REFUND /CANCELLATIONT","TOTAL BOOKING AMOUNT"]),i&&i.forEach(s=>{d.addRow([s==null?void 0:s.TimePerid,s==null?void 0:s.TotalDaysinMonth,s==null?void 0:s.No_of_Booked_Nights,s==null?void 0:s.AveragePerNight,s==null?void 0:s.OccpancyRate,s.Occp,s==null?void 0:s.TotalHostPayable])}),d.getRow(2).font={bold:!0},d.getRow(2).fill={type:"pattern",pattern:"solid",fgColor:{argb:"008000"}},d.getRow(8).fill={type:"pattern",pattern:"solid",fgColor:{argb:"008000"}},c.xlsx.writeBuffer().then(s=>{const u=new Blob([s],{type:"application/octet-stream"}),D=URL.createObjectURL(u),p=document.createElement("a");p.href=D,p.download="booking-"+new Date+".xlsx",document.body.appendChild(p),p.click(),document.body.removeChild(p)})}o.exports.useState(!1);const[j,Ne]=o.exports.useState(0),[B,pe]=o.exports.useState(0),[F,fe]=o.exports.useState(0),M=()=>{H(""),E([]),C({propertyid:""}),se({startDate:null,endDate:null})};o.exports.useEffect(()=>{var i;let e=0;for(let l=0;l<(r==null?void 0:r.length);l++){let c=parseInt((i=r[l])==null?void 0:i.TotalDaysinMonth);e+=c}ae(e)},[r==null?void 0:r.length]),o.exports.useEffect(()=>{var i;let e=0;for(let l=0;l<(r==null?void 0:r.length);l++){let c=parseInt((i=r[l])==null?void 0:i.No_of_Booked_Nights);e+=c}Ne(e)},[r==null?void 0:r.length]),o.exports.useEffect(()=>{const e=r.map(c=>c.OccpancyRate),l=e.reduce((c,d)=>c+Number(d),0)/e.length;pe(Math.round(l))},[r==null?void 0:r.length]),o.exports.useEffect(()=>{const i=r.map(l=>l.AveragePerNight).reduce((l,c)=>l+c,0);fe(i)},[r==null?void 0:r.length]),o.exports.useEffect(()=>{let e=r.map(i=>Number(i.TotalHostPayable)).reduce((i,l)=>i+l,0);le(e)},[r==null?void 0:r.length]),o.exports.useRef(null);const be=[{Header:"Sr no",accessor:"id",Cell:({row:e,flatRows:i})=>a("span",{children:i.indexOf(e)+1},void 0,!1,{fileName:t,lineNumber:485,columnNumber:24},void 0)},{Header:"MONTH / PERIOD",accessor:"TimePerid",Cell:e=>{var i,l;return a("span",{children:(i=e==null?void 0:e.cell)!=null&&i.value?new Date((l=e==null?void 0:e.cell)==null?void 0:l.value).toDateString():"Not Available"},void 0,!1,{fileName:t,lineNumber:492,columnNumber:24},void 0)}},{Header:"TOTAL AVAILABLE NUMBER OF NIGHTS / MONTH",accessor:"TotalDaysinMonth",Cell:e=>{var i,l;return a("span",{children:(i=e==null?void 0:e.cell)!=null&&i.value?(l=e==null?void 0:e.cell)==null?void 0:l.value:"Not Available"},void 0,!1,{fileName:t,lineNumber:499,columnNumber:24},void 0)}},{Header:"NO OF NIGHTS BOOKED",accessor:"No_of_Booked_Nights",Cell:e=>{var i,l;return a("span",{children:(i=e==null?void 0:e.cell)!=null&&i.value?(l=e==null?void 0:e.cell)==null?void 0:l.value:"Not Available"},void 0,!1,{fileName:t,lineNumber:506,columnNumber:24},void 0)}},{Header:"AVERAGE RATE PER NIGHT",accessor:"AveragePerNight",Cell:e=>{var i,l;return a("span",{children:(i=e==null?void 0:e.cell)!=null&&i.value?Number((l=e==null?void 0:e.cell)==null?void 0:l.value).toFixed(2):"Not Available"},void 0,!1,{fileName:t,lineNumber:513,columnNumber:24},void 0)}},{Header:"OCCUPANCY RATE",accessor:"OccpancyRate",Cell:e=>{var i,l;return a("span",{children:(i=e==null?void 0:e.cell)!=null&&i.value?((l=e==null?void 0:e.cell)==null?void 0:l.value)+" %":"Not Available"},void 0,!1,{fileName:t,lineNumber:520,columnNumber:24},void 0)}},{Header:"REFUND /CANCELLATIONT",accessor:"nonight",Cell:e=>{var i,l;return a("span",{children:(i=e==null?void 0:e.cell)!=null&&i.value?(l=e==null?void 0:e.cell)==null?void 0:l.value:"Not Available"},void 0,!1,{fileName:t,lineNumber:527,columnNumber:24},void 0)}},{Header:"TOTAL BOOKING AMOUNT",accessor:"TotalHostPayable",Cell:e=>{var i,l;return a("span",{children:(i=e==null?void 0:e.cell)!=null&&i.value?Number((l=e==null?void 0:e.cell)==null?void 0:l.value).toFixed(2):"Not Available"},void 0,!1,{fileName:t,lineNumber:534,columnNumber:24},void 0)}}],ve=o.exports.useMemo(()=>be,[]),he=o.exports.useMemo(()=>r),ge=h.exports.useTable({columns:ve,data:he,initialState:{pageIndex:0,pageSize:50}},h.exports.useGlobalFilter,h.exports.useSortBy,h.exports.usePagination,h.exports.useRowSelect,e=>{e.visibleColumns.push(i=>[{id:"selection",Header:({getToggleAllRowsSelectedProps:l})=>a("div",{children:a(w,{...l()},void 0,!1,{fileName:t,lineNumber:577,columnNumber:29},void 0)},void 0,!1,{fileName:t,lineNumber:576,columnNumber:25},void 0),Cell:({row:l})=>a("div",{children:a(w,{...l.getToggleRowSelectedProps()},void 0,!1,{fileName:t,lineNumber:582,columnNumber:29},void 0)},void 0,!1,{fileName:t,lineNumber:581,columnNumber:25},void 0)},...i])}),{getTableProps:xe,getTableBodyProps:ye,headerGroups:De,footerGroups:_e,page:Se,nextPage:Le,previousPage:Ie,canNextPage:He,canPreviousPage:je,pageOptions:Be,state:Fe,gotoPage:Me,pageCount:Ue,setPageSize:Ge,setGlobalFilter:$e,prepareRow:Ae}=ge;return a(N,{children:a("div",{className:"xl:col-span-2 col-span-1",children:a(Ee,{title:"Booking Summary Report",children:[(n==null?void 0:n.filteredDates)&&((U=n==null?void 0:n.filteredDates)==null?void 0:U.length)?a(N,{children:a("div",{className:"flex flex-row-reverse",children:a("button",{className:"h-[34px] rounded-[10px] relative bg-white border1px flex items-center gap-x-[10px] justify-around px-[10px] py-[5px] cursor-pointer",onClick:()=>ue(ie),children:[a("img",{src:Re,alt:"Excel icon",className:"w-[20px] h-[20px] noselect"},void 0,!1,{fileName:t,lineNumber:620,columnNumber:25},void 0),a("p",{className:"text-[14px] leading regular color-black",children:"Export in Excel"},void 0,!1,{fileName:t,lineNumber:621,columnNumber:25},void 0)]},void 0,!0,{fileName:t,lineNumber:619,columnNumber:25},void 0)},void 0,!1,{fileName:t,lineNumber:618,columnNumber:25},void 0)},void 0,!1):null,a("div",{children:[a("form",{className:"lg:grid-cols-3 grid gap-5 grid-cols-1 ",children:[T===!0?null:a(N,{children:a("div",{className:"w-[100%] col-span-3",children:a("h4",{className:"text-base text-slate-800 dark:text-slate-300 mb-[0.5rem] mt-[0.5rem]",children:"Select Property"},void 0,!1,{fileName:t,lineNumber:637,columnNumber:37},void 0)},void 0,!1,{fileName:t,lineNumber:636,columnNumber:33},void 0)},void 0,!1),a("div",{className:"w-[100%] col-span-3",children:T===!0?a(N,{children:a("div",{className:"flex items-center justify-center h-[100%]",children:a("img",{src:Ce,width:150,height:150},void 0,!1,{fileName:t,lineNumber:652,columnNumber:49},void 0)},void 0,!1,{fileName:t,lineNumber:651,columnNumber:46},void 0)},void 0,!1):a(N,{children:a(Te,{label:"Basic Select",className:"react-select",classNamePrefix:"select",options:x,value:x&&O?x.filter(function(e){return e.value===(n==null?void 0:n.propertyid)}):x.filter(function(e){return e.value===(n==null?void 0:n.propertyid)}),placeholder:"Select and Search Property",onChange:e=>{O?M():C({propertyid:e==null?void 0:e.value,propertyname:e==null?void 0:e.label},"select box")},styles:ke,id:"hh"},void 0,!1,{fileName:t,lineNumber:657,columnNumber:41},void 0)},void 0,!1)},void 0,!1,{fileName:t,lineNumber:644,columnNumber:33},void 0)]},void 0,!0,{fileName:t,lineNumber:628,columnNumber:21},void 0),"  ",(n==null?void 0:n.propertyid)&&a(N,{children:a("div",{className:"flex justify-end mt-[25px]",children:[a("div",{className:"w-[150px]",children:a("div",{className:"date-range-custom relative",children:a(Oe,{value:oe,inputClassName:"input-class",containerClassName:"container-class",onChange:ne},void 0,!1,{fileName:t,lineNumber:692,columnNumber:53},void 0)},void 0,!1,{fileName:t,lineNumber:691,columnNumber:45},void 0)},void 0,!1,{fileName:t,lineNumber:690,columnNumber:37},void 0),O&&a(N,{children:a("div",{className:"flex justify-end",children:a("div",{className:"w-[90px]",children:a("div",{className:"date-range-custom relative",children:a("button",{className:"btn btn-dark text-white  text-center",onClick:M,children:"Reset"},void 0,!1,{fileName:t,lineNumber:706,columnNumber:45},void 0)},void 0,!1,{fileName:t,lineNumber:705,columnNumber:45},void 0)},void 0,!1,{fileName:t,lineNumber:704,columnNumber:41},void 0)},void 0,!1,{fileName:t,lineNumber:703,columnNumber:33},void 0)},void 0,!1)]},void 0,!0,{fileName:t,lineNumber:689,columnNumber:33},void 0)},void 0,!1)]},void 0,!0,{fileName:t,lineNumber:627,columnNumber:21},void 0),a("div",{className:"overflow-x-auto -mx-6",children:a("div",{className:"inline-block min-w-full align-middle",children:a("div",{className:"overflow-hidden ",children:r&&r.length>0?a(N,{children:[" ",a("div",{className:"mt-[25px] p-8",children:[a("div",{className:"flex gap-x-[10px]",children:[a("p",{className:"font-semibold",children:"Landlord Name: "},void 0,!1,{fileName:t,lineNumber:760,columnNumber:65},void 0),a("p",{className:"capitalize",children:(G=m[0])!=null&&G.owner_name?($=m[0])==null?void 0:$.owner_name:"Not Available"},void 0,!1,{fileName:t,lineNumber:761,columnNumber:65},void 0)]},void 0,!0,{fileName:t,lineNumber:759,columnNumber:61},void 0),a("div",{className:"flex gap-x-[10px]",children:[a("p",{className:"font-semibold",children:"Community Name: "},void 0,!1,{fileName:t,lineNumber:764,columnNumber:65},void 0),a("p",{className:"capitalize",children:(z=m[0])!=null&&z.communityname?(V=m[0])==null?void 0:V.communityname:"Not Available"},void 0,!1,{fileName:t,lineNumber:765,columnNumber:65},void 0)]},void 0,!0,{fileName:t,lineNumber:763,columnNumber:61},void 0),a("div",{className:"flex gap-x-[10px]",children:[a("p",{className:"font-semibold",children:"Project Name: "},void 0,!1,{fileName:t,lineNumber:768,columnNumber:65},void 0),a("p",{className:"capitalize",children:(K=m[0])!=null&&K.project_name?(q=m[0])==null?void 0:q.project_name:"Not Available"},void 0,!1,{fileName:t,lineNumber:769,columnNumber:65},void 0)]},void 0,!0,{fileName:t,lineNumber:767,columnNumber:61},void 0),a("div",{className:"flex gap-x-[10px]",children:[a("p",{className:"font-semibold",children:"Apartment No: "},void 0,!1,{fileName:t,lineNumber:772,columnNumber:65},void 0),a("p",{className:"capitalize",children:(W=m[0])!=null&&W.unitnumber?(Y=m[0])==null?void 0:Y.unitnumber:"Not Available"},void 0,!1,{fileName:t,lineNumber:773,columnNumber:65},void 0)]},void 0,!0,{fileName:t,lineNumber:771,columnNumber:61},void 0),a("div",{className:"flex gap-x-[10px]",children:[a("p",{className:"font-semibold",children:"Building No: "},void 0,!1,{fileName:t,lineNumber:776,columnNumber:65},void 0),a("p",{className:"capitalize",children:(J=m[0])!=null&&J.building_name?(Q=m[0])==null?void 0:Q.building_name:"Not Available"},void 0,!1,{fileName:t,lineNumber:777,columnNumber:65},void 0)]},void 0,!0,{fileName:t,lineNumber:775,columnNumber:61},void 0)]},void 0,!0,{fileName:t,lineNumber:758,columnNumber:41},void 0)," ",a("table",{className:"min-w-full divide-y divide-slate-100 table-fixed dark:divide-slate-700",...xe,children:[a("thead",{className:"bg-slate-200 dark:bg-slate-700",children:De.map(e=>a("tr",{...e.getHeaderGroupProps(),children:e.headers.map(i=>a("th",{...i.getHeaderProps(i.getSortByToggleProps()),scope:"col",className:" table-th ",children:[i.render("Header"),a("span",{children:i.isSorted?i.isSortedDesc?" \u{1F53D}":" \u{1F53C}":""},void 0,!1,{fileName:t,lineNumber:797,columnNumber:69},void 0)]},void 0,!0,{fileName:t,lineNumber:789,columnNumber:65},void 0))},void 0,!1,{fileName:t,lineNumber:787,columnNumber:57},void 0))},void 0,!1,{fileName:t,lineNumber:785,columnNumber:49},void 0),a("tbody",{className:"bg-white divide-y divide-slate-100 dark:bg-slate-800 dark:divide-slate-700",...ye,children:[Se.map(e=>(Ae(e),a("tr",{...e.getRowProps(),children:e.cells.map(i=>a("td",{...i.getCellProps(),className:"table-td",children:i.render("Cell")},void 0,!1,{fileName:t,lineNumber:822,columnNumber:73},void 0))},void 0,!1,{fileName:t,lineNumber:819,columnNumber:61},void 0))),a("tr",{children:[a("td",{className:"table-td",children:"TOTAL"},void 0,!1,{fileName:t,lineNumber:831,columnNumber:57},void 0),a("td",{},void 0,!1,{fileName:t,lineNumber:832,columnNumber:57},void 0),a("td",{},void 0,!1,{fileName:t,lineNumber:833,columnNumber:57},void 0),a("td",{className:"table-td",children:[L?L.toLocaleString():0," Avaiable Nights"]},void 0,!0,{fileName:t,lineNumber:834,columnNumber:57},void 0),a("td",{className:"table-td",children:[j?j.toLocaleString():0," Booked Nights"]},void 0,!0,{fileName:t,lineNumber:835,columnNumber:57},void 0),a("td",{className:"table-td",children:[F?F.toLocaleString():0," AED"]},void 0,!0,{fileName:t,lineNumber:836,columnNumber:57},void 0),a("td",{className:"table-td",children:[B?B.toLocaleString():0," %"]},void 0,!0,{fileName:t,lineNumber:837,columnNumber:57},void 0),a("td",{className:"table-td"},void 0,!1,{fileName:t,lineNumber:838,columnNumber:57},void 0),a("td",{className:"table-td",children:[I?I.toLocaleString():0," AED"]},void 0,!0,{fileName:t,lineNumber:839,columnNumber:57},void 0)]},void 0,!0,{fileName:t,lineNumber:830,columnNumber:53},void 0)]},void 0,!0,{fileName:t,lineNumber:809,columnNumber:49},void 0)]},void 0,!0,{fileName:t,lineNumber:781,columnNumber:45},void 0)]},void 0,!0):a(N,{children:T===!0?null:a(N,{children:a("div",{className:"pl-6",children:a("h6",{className:" text-base text-slate-800 dark:text-slate-300 mb-[0.5rem] mt-[0.5rem]",children:"No Property Data Found"},void 0,!1,{fileName:t,lineNumber:851,columnNumber:57},void 0)},void 0,!1,{fileName:t,lineNumber:850,columnNumber:53},void 0)},void 0,!1)},void 0,!1)},void 0,!1,{fileName:t,lineNumber:750,columnNumber:41},void 0)},void 0,!1,{fileName:t,lineNumber:749,columnNumber:37},void 0)},void 0,!1,{fileName:t,lineNumber:748,columnNumber:37},void 0)]},void 0,!0,{fileName:t,lineNumber:614,columnNumber:17},void 0)},void 0,!1,{fileName:t,lineNumber:613,columnNumber:9},void 0)},void 0,!1)};export{Xe as default};
