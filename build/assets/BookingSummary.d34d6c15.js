import{R as q,r as o,b as R,j as a,F as x,c as u,C as D,aq as J,Q}from"./index.f2f04dad.js";import{D as X}from"./index.esm.7d8ba192.js";import"./jspdf.es.min.897281b9.js";import"./html2canvas.esm.0eae2bf4.js";import{E as K}from"./exceljs.min.9fb89bb8.js";import{E as Z}from"./excel.9601f4f9.js";const $=q.forwardRef(({allBooking:e,propertyData:l},H)=>{console.log("@@@@@@@@@@@@@@@@@@@@2",l);const C=[{Header:"Sr no",accessor:"id",Cell:({row:t,flatRows:s})=>a("span",{children:s.indexOf(t)+1})},{Header:"MONTH / PERIOD",accessor:"TimePerid",Cell:t=>{var s,c;return a("span",{children:(s=t==null?void 0:t.cell)!=null&&s.value?(c=t==null?void 0:t.cell)==null?void 0:c.value:"Not Available"})}},{Header:"TOTAL AVAILABLE NUMBER OF NIGHTS / MONTH",accessor:"TotalDaysinMonth",Cell:t=>{var s,c;return a("span",{children:(s=t==null?void 0:t.cell)!=null&&s.value?(c=t==null?void 0:t.cell)==null?void 0:c.value:"Not Available"})}},{Header:"NO OF NIGHTS BOOKED",accessor:"No_of_Booked_Nights",Cell:t=>{var s,c;return a("span",{children:(s=t==null?void 0:t.cell)!=null&&s.value?(c=t==null?void 0:t.cell)==null?void 0:c.value:"Not Available"})}},{Header:"AVERAGE RATE PER NIGHT",accessor:"AveragePerNight",Cell:t=>{var s,c;return a("span",{children:(s=t==null?void 0:t.cell)!=null&&s.value?Number((c=t==null?void 0:t.cell)==null?void 0:c.value).toFixed(2):"Not Available"})}},{Header:"OCCUPANCY RATE",accessor:"OccpancyRate",Cell:t=>{var s,c;return a("span",{children:(s=t==null?void 0:t.cell)!=null&&s.value?((c=t==null?void 0:t.cell)==null?void 0:c.value)+" %":"Not Available"})}},{Header:"REFUND /CANCELLATIONT",accessor:"refund",Cell:t=>{var s,c;return a("span",{children:(s=t==null?void 0:t.cell)!=null&&s.value?(c=t==null?void 0:t.cell)==null?void 0:c.value:"Not Available"})}},{Header:"TOTAL BOOKING AMOUNT",accessor:"TotalHostPayable",Cell:t=>{var s,c;return a("span",{children:(s=t==null?void 0:t.cell)!=null&&s.value?Number((c=t==null?void 0:t.cell)==null?void 0:c.value).toFixed(2):"Not Available"})}}],b=o.exports.useMemo(()=>C,[]),_=o.exports.useMemo(()=>e),E=R.exports.useTable({columns:b,data:_,initialState:{pageIndex:0,pageSize:50}},R.exports.useGlobalFilter,R.exports.useSortBy,R.exports.usePagination,R.exports.useRowSelect),{getTableProps:O,getTableBodyProps:v,headerGroups:j,footerGroups:I,page:g,nextPage:G,previousPage:Y,canNextPage:U,canPreviousPage:P,pageOptions:S,state:W,gotoPage:w,pageCount:V,setPageSize:M,setGlobalFilter:z,prepareRow:y}=E,[T,L]=o.exports.useState(0),[A,F]=o.exports.useState(0),[i,h]=o.exports.useState(0),[d,p]=o.exports.useState(0),[m,r]=o.exports.useState(0),[n,N]=o.exports.useState(0);return o.exports.useEffect(()=>{if(e!=null&&e.length){const t=e.map(s=>{const{TotalDaysinMonth:c}=s;return c});L(t.reduce((s,c)=>s+c,0))}},[e==null?void 0:e.length]),o.exports.useEffect(()=>{if(e!=null&&e.length){const t=e.map(s=>{const{No_of_Booked_Nights:c}=s;return c});F(t.reduce((s,c)=>s+c,0))}},[e==null?void 0:e.length]),o.exports.useEffect(()=>{if(e!=null&&e.length){const t=e.map(c=>{const{OccpancyRate:f}=c;return f});let s=Math.round(t.reduce((c,f)=>c+Number(f),0)/t.length);p(s)}},[e==null?void 0:e.length]),o.exports.useEffect(()=>{var t;if(e!=null&&e.length){let s=0;for(let c=0;c<(e==null?void 0:e.length);c++){let f=parseFloat((t=e[c])==null?void 0:t.totalNonight);s+=f}r(s||0)}},[e==null?void 0:e.length]),o.exports.useEffect(()=>{var t;if(e!=null&&e.length){let s=0;for(let c=0;c<(e==null?void 0:e.length);c++){let f=Number((t=e[c])==null?void 0:t.AveragePerNight);s+=f}N(s||0)}},[e==null?void 0:e.length]),o.exports.useEffect(()=>{var t;if(e!=null&&e.length){let s=0;for(let c=0;c<(e==null?void 0:e.length);c++){console.log("@@@@@3333",e);let f=Number((t=e[c])==null?void 0:t.TotalHostPayable);s+=f}console.log("totalbookednights",s),h(s||0)}},[e==null?void 0:e.length]),a(x,{children:e&&e.length>0?a(x,{children:u("div",{ref:H,children:[u("div",{className:"mt-[25px]",children:[u("div",{className:"flex gap-x-[10px]",children:[a("p",{className:"font-semibold",children:"Landlord Name: "}),a("p",{className:"capitalize",children:l!=null&&l.owner_name?l==null?void 0:l.owner_name:"Not Available"})]}),u("div",{className:"flex gap-x-[10px]",children:[a("p",{className:"font-semibold",children:"Community Name: "}),a("p",{className:"capitalize",children:l!=null&&l.communityname?l==null?void 0:l.communityname:"Not Available"})]}),u("div",{className:"flex gap-x-[10px]",children:[a("p",{className:"font-semibold",children:"Project Name: "}),a("p",{className:"capitalize",children:l!=null&&l.project_name?l==null?void 0:l.project_name:"Not Available"})]}),u("div",{className:"flex gap-x-[10px]",children:[a("p",{className:"font-semibold",children:"Apartment No: "}),a("p",{className:"capitalize",children:l!=null&&l.unitnumber?l==null?void 0:l.unitnumber:"Not Available"})]}),u("div",{className:"flex gap-x-[10px]",children:[a("p",{className:"font-semibold",children:"Building No: "}),a("p",{className:"capitalize",children:l!=null&&l.building_name?l==null?void 0:l.building_name:"Not Available"})]})]}),a("div",{className:"overflow-x-auto -mx-6 mt-6",children:a("div",{className:"inline-block min-w-full align-middle",children:a("div",{className:"",children:u("table",{className:"min-w-[100%] overflow-x-scroll divide-y divide-slate-100 table-fixed dark:divide-slate-700",...O,children:[a("thead",{className:"bg-slate-200 dark:bg-slate-700",children:j.map(t=>a("tr",{...t.getHeaderGroupProps(),children:t.headers.map(s=>u("th",{...s.getHeaderProps(s.getSortByToggleProps()),scope:"col",className:"table-th",children:[s.render("Header"),a("span",{children:s.isSorted?s.isSortedDesc?" \u{1F53D}":" \u{1F53C}":""})]}))}))}),u("tbody",{className:"bg-white divide-y divide-slate-100 dark:bg-slate-800 dark:divide-slate-700",...v,children:[g&&g.length>0&&g.map(t=>(y(t),a(x,{children:a("tr",{...t.getRowProps(),children:t.cells.map(s=>a("td",{...s.getCellProps(),className:"table-td",children:s.render("Cell")}))})}))),u("tr",{children:[a("td",{className:"font-semibold",children:"TOTAL"}),a("td",{}),u("td",{className:"table-td font-semibold",children:[T==null?void 0:T.toLocaleString()," Available Nights"]}),u("td",{className:"table-td font-semibold",children:[A==null?void 0:A.toLocaleString()," Booked Nights"]}),u("td",{className:"table-td font-semibold",children:[n==null?void 0:n.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})," AED"]}),u("td",{className:"table-td font-semibold",children:[d==null?void 0:d.toLocaleString()," %"]}),a("td",{}),u("td",{className:"table-td font-semibold",children:[i==null?void 0:i.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})," AED"]}),a("td",{})]})]})]})})})})]})}):a(x,{children:a("h6",{className:"text-base text-slate-800 dark:text-slate-300 mb-[0.5rem] mt-[0.5rem]",children:"No Property Data Found"})})})}),k={option:(e,l)=>({...e,fontSize:"14px"})},ne=()=>{var A,F;const[e,l]=o.exports.useState({propertyid:"",filteredDates:[]}),[H,C]=o.exports.useState([]),[b,_]=o.exports.useState(""),[E,O]=o.exports.useState(""),[v,j]=o.exports.useState([]),[I,g]=o.exports.useState(""),[G,Y]=o.exports.useState({}),[U,P]=o.exports.useState([]),[S,W]=o.exports.useState([]);o.exports.useEffect(()=>{fetch("http://dev-rare.srp.ai/property").then(i=>i.json()).then(i=>{const h=i==null?void 0:i.map(d=>({label:d.unitnumber+" | "+d.communityname+" | "+d.projectname+" | "+d.buildingname,value:d._id}));j(h)})},[]),o.exports.useEffect(()=>{(async()=>{if(e!=null&&e.propertyid){const d=await(await fetch(`http://dev-rare.srp.ai/property/${e==null?void 0:e.propertyid}`)).json();P(S==null?void 0:S.data),d&&g(d)}})()},[e==null?void 0:e.propertyid]),o.exports.useEffect(()=>{(async()=>{const d=await(await fetch(`http://dev-rare.srp.ai/booking/summarybyDates/${e==null?void 0:e.propertyid}?fromdate=${newValue.startDate}&todate=${newValue.endDate}`)).json();P(d==null?void 0:d.data),_(d==null?void 0:d.data)})()},[]);const[w,V]=o.exports.useState({startDate:"",endDate:""}),M=o.exports.useRef(null),z=async()=>{const h=await(await fetch(`http://dev-rare.srp.ai/booking/summary/${e==null?void 0:e.propertyid}`)).json();C(h.data)};o.exports.useEffect(()=>{if(b!=null&&b.length&&(e==null?void 0:e.propertyid)&&(e==null?void 0:e.startDate)&&(e==null?void 0:e.endDate)){const i=b.filter(h=>{let d=!0;return e.propertyid&&h.propertyid!==e.propertyid&&(d=!1),(h==null?void 0:h.checkindate)<(e==null?void 0:e.startDate)&&(h==null?void 0:h.checkindate)>(e==null?void 0:e.endDate)&&(d=!1),d});C(i)}z()},[e==null?void 0:e.propertyid,e==null?void 0:e.startDate,e==null?void 0:e.endDate,b]);const y=()=>{O(""),l({...e,filteredDates:[]}),V({startDate:null,endDate:null})},T=async i=>{if(g(!0),console.log("newValue",i),O(i),!i){l({...e,filteredDates:[]});return}const d=await(await fetch(`http://dev-rare.srp.ai/booking/summary/${e==null?void 0:e.propertyid}`)).json();d.data.length==0&&Q.error("No Data Found against this Property",{position:"top-right",autoClose:1500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),g(!1);let p=I;l({...e,filteredDates:d==null?void 0:d.data});const m={owner_name:p.owner_name,building_name:p.building_name,community_name:p.communityname,project_name:p.project_name,unitnumber:p.unitnumber};setselectedProperty(m),P({filteredData:d==null?void 0:d.data,PropertyData:m})};function L(i){const{filteredData:h,PropertyData:d}=i;let p=[];p.push(d),console.log("122222",p);const m=new K.Workbook,r=m.addWorksheet("CombinedSheet");if(r.mergeCells("A1:E1"),r.addRow(["PROPERTY DETAIL"]),r.columns=[{header:"Landlord Name",key:"owner_name",width:40,fgColor:{argb:"008000"}},{header:"Community Name",key:"community_name",width:40,fgColor:{argb:"008000"}},{header:"Project Name",key:"project_name",width:40},{header:"Apartment No",key:"unitnumber",width:35},{header:"Building No",key:"building_name",width:55}],p){console.log("PropertyData",d);const n=[["Landlord Name","Community Name","Project Name","Apartment No","Building No"],...p==null?void 0:p.map(N=>[N.owner_name,N.community_name,N.project_name,N.unitnumber,N.building_name])];n==null||n.forEach(N=>{r.addRow(N)}),r.addRow([])}r.addRow(["MONTH / PERIOD","TOTAL AVAILABLE NUMBER OF NIGHTS / MONTH","NO OF NIGHTS BOOKED","AVERAGE RATE PER NIGHT","OCCUPANCY RATE","REFUND /CANCELLATIONT","TOTAL BOOKING AMOUNT"]),h&&(h==null||h.forEach(n=>{r.addRow([n==null?void 0:n.TimePerid,n==null?void 0:n.TotalDaysinMonth,n==null?void 0:n.No_of_Booked_Nights,n==null?void 0:n.AveragePerNight,n==null?void 0:n.OccpancyRate,n.Occp,n==null?void 0:n.TotalHostPayable])})),r.getRow(2).font={bold:!0},r.getRow(2).fill={type:"pattern",pattern:"solid",fgColor:{argb:"008000"}},r.getRow(8).fill={type:"pattern",pattern:"solid",fgColor:{argb:"008000"}},m.xlsx.writeBuffer().then(n=>{const N=new Blob([n],{type:"application/octet-stream"}),t=URL.createObjectURL(N),s=document.createElement("a");s.href=t,s.download="booking-"+new Date+".xlsx",document.body.appendChild(s),s.click(),document.body.removeChild(s)})}return a(x,{children:a("div",{className:"xl:col-span-2 col-span-1",children:u(D,{title:"Booking Summary",children:[(e==null?void 0:e.filteredDates)&&((A=e==null?void 0:e.filteredDates)==null?void 0:A.length)?a(x,{children:a("div",{className:"flex flex-row-reverse",children:u("button",{className:"h-[34px] rounded-[10px] relative bg-white border1px flex items-center gap-x-[10px] justify-around px-[10px] py-[5px] cursor-pointer",onClick:()=>L(U),children:[a("img",{src:Z,alt:"Excel icon",className:"w-[20px] h-[20px] noselect"}),a("p",{className:"text-[14px] leading regular color-black",children:"Export in Excel"})]})})}):null,u("div",{children:[u("form",{className:"lg:grid-cols-3 grid gap-5 grid-cols-1 ",children:[a("div",{className:"w-[100%] col-span-3",children:a("h4",{className:"text-base text-slate-800 dark:text-slate-300 mb-[0.5rem] mt-[0.5rem]",children:"Select Property"})}),a("div",{className:"w-[100%] col-span-3",children:a(J,{label:"Basic Select",className:"react-select",classNamePrefix:"select",options:v,value:v&&E?v.filter(function(i){return i.value===(e==null?void 0:e.propertyid)}):v.filter(function(i){return i.value===(e==null?void 0:e.propertyid)}),onChange:i=>{E?y():l({...e,propertyid:i==null?void 0:i.value})},styles:k,id:"hh",placeholder:"Select and Search property"})})]}),console.log("userData222=========HJKL=====>",e),e.propertyid&&a(x,{children:u("div",{className:"flex justify-end mt-[25px]",children:[a("div",{className:"w-[150px]",children:a("div",{className:"date-range-custom relative",children:a(X,{value:w,inputClassName:"input-class",containerClassName:"container-class",onChange:T,placeholder:"SELECT DATE"})})}),E&&a("div",{className:"flex justify-end",children:a("div",{className:"w-[90px]",children:a("div",{className:"date-range-custom relative",children:a("button",{className:"btn btn-dark text-white  text-center",type:"button",onClick:y,children:"Reset"})})})})]})})]}),(F=e.filteredDates)!=null&&F.length?a(x,{children:a($,{allBooking:e.filteredDates,propertyData:G,ref:M})}):a(x,{children:a($,{allBooking:H,propertyData:I,ref:M})})]})})})};export{ne as default};
