import{R as k,r,j as i,F as g,I as K,C as B,am as ee}from"./index.0d75234e.js";import{D as ie}from"./index.esm.3c705dd8.js";import"./jspdf.es.min.2b6ef780.js";import"./html2canvas.esm.0eae2bf4.js";import{r as F}from"./index.a246dc5d.js";var s="D:\\Ahsan\\Rare\\Dev\\Rare_Frontend\\src\\pages\\booking-management\\booking-summary\\ReportTable.jsx";const q=k.forwardRef(({allBooking:e,propertyData:a},R)=>{function v(l,t){if(t<1||t>12||isNaN(t)||isNaN(l))throw new Error("Invalid month or year");return new Date(l,t,0).getDate()}function b(l,t){if(isNaN(t)||isNaN(l)||t<1||t>12)throw new Error("Invalid month or year");return`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t-1]} ${l}`}r.exports.useState("");const M=[{Header:"Sr no",accessor:"id",Cell:({row:l,flatRows:t})=>i("span",{children:t.indexOf(l)+1},void 0,!1,{fileName:s,lineNumber:47,columnNumber:24},void 0)},{Header:"MONTH / PERIOD",accessor:"guestname",Cell:l=>{const{original:t}=(l==null?void 0:l.row)||{},m=t==null?void 0:t.year,c=t==null?void 0:t.month;let N="Not Available";return m&&c&&(N=`${b(m,c)}`),i("div",{children:i("span",{className:"inline-flex items-center",children:i("span",{className:"text-sm text-slate-600 dark:text-slate-300",children:N},void 0,!1,{fileName:s,lineNumber:68,columnNumber:21},void 0)},void 0,!1,{fileName:s,lineNumber:67,columnNumber:19},void 0)},void 0,!1,{fileName:s,lineNumber:66,columnNumber:17},void 0)}},{Header:"TOTAL AVAILABLE NUMBER OF NIGHTS / MONTH",accessor:"guestnames",Cell:l=>{const{original:t}=(l==null?void 0:l.row)||{},m=t==null?void 0:t.year,c=t==null?void 0:t.month;let N="Not Available";return m&&c&&(N=`${v(m,c)} nights`),i("div",{children:i("span",{className:"inline-flex items-center",children:i("span",{className:"text-sm text-slate-600 dark:text-slate-300",children:N},void 0,!1,{fileName:s,lineNumber:94,columnNumber:21},void 0)},void 0,!1,{fileName:s,lineNumber:93,columnNumber:19},void 0)},void 0,!1,{fileName:s,lineNumber:92,columnNumber:17},void 0)}},{Header:"NO OF NIGHTS BOOKED",accessor:"totalNonight",Cell:l=>{var t,m;return i("span",{children:(t=l==null?void 0:l.cell)!=null&&t.value?(m=l==null?void 0:l.cell)==null?void 0:m.value:"Not Available"},void 0,!1,{fileName:s,lineNumber:106,columnNumber:24},void 0)}},{Header:"AVERAGE RATE PER NIGHT",accessor:"averageCost",Cell:l=>{var t,m;return i("span",{children:(t=l==null?void 0:l.cell)!=null&&t.value?(m=l==null?void 0:l.cell)==null?void 0:m.value:"Not Available"},void 0,!1,{fileName:s,lineNumber:113,columnNumber:24},void 0)}},{Header:"OCCUPANCY RATE",accessor:"checkindate",Cell:l=>{const{original:t}=(l==null?void 0:l.row)||{},m=t==null?void 0:t.year,c=t==null?void 0:t.month,N=t==null?void 0:t.totalNonight;let f="Not Available";if(m&&c){const y=v(m,c);f=`${Number(Math.round(N/y*100)).toFixed(0)} %`}return i("div",{children:i("span",{className:"inline-flex items-center",children:i("span",{className:"text-sm text-slate-600 dark:text-slate-300",children:f},void 0,!1,{fileName:s,lineNumber:134,columnNumber:23},void 0)},void 0,!1,{fileName:s,lineNumber:133,columnNumber:21},void 0)},void 0,!1,{fileName:s,lineNumber:132,columnNumber:19},void 0)}},{Header:"REFUND /CANCELLATIONT",accessor:"refund",Cell:l=>{var t,m;return i("span",{children:(t=l==null?void 0:l.cell)!=null&&t.value?(m=l==null?void 0:l.cell)==null?void 0:m.value:"Not Available"},void 0,!1,{fileName:s,lineNumber:147,columnNumber:24},void 0)}},{Header:"TOTAL BOOKING AMOUNT",accessor:"totalhostpayble",Cell:l=>{var t,m;return i("span",{children:(t=l==null?void 0:l.cell)!=null&&t.value?(m=l==null?void 0:l.cell)==null?void 0:m.value:"Not Available"},void 0,!1,{fileName:s,lineNumber:155,columnNumber:24},void 0)}}],S=r.exports.useMemo(()=>M,[]),E=r.exports.useMemo(()=>e),x=F.exports.useTable({columns:S,data:E,initialState:{pageIndex:0,pageSize:50}},F.exports.useGlobalFilter,F.exports.useSortBy,F.exports.usePagination,F.exports.useRowSelect),{getTableProps:O,getTableBodyProps:T,headerGroups:j,footerGroups:z,page:A,nextPage:P,previousPage:I,canNextPage:h,canPreviousPage:p,pageOptions:C,state:n,gotoPage:o,pageCount:d,setPageSize:V,setGlobalFilter:te,prepareRow:Y}=x,{globalFilter:se,pageIndex:U,pageSize:Q}=n,[H,W]=r.exports.useState(0),[$,X]=r.exports.useState(0),[L,Z]=r.exports.useState(0),[_,w]=r.exports.useState(0),[G,D]=r.exports.useState(0);return r.exports.useEffect(()=>{if(e!=null&&e.length){let l=[];e.filter(t=>{const{year:m,month:c}=t;m&&c&&l.push(v(m,c))}),W(l.reduce((t,m)=>t+m,0))}},[e==null?void 0:e.length]),r.exports.useEffect(()=>{if(e!=null&&e.length){let l=[],t=[];e.filter(N=>{const{year:f,month:y,totalNonight:J}=N;f&&y&&l.push(v(f,y)),J&&t.push(J)});let m=l.reduce((N,f)=>N+f,0),c=t.reduce((N,f)=>N+f,0);Z(Math.round(c/m*100))}},[e==null?void 0:e.length]),r.exports.useEffect(()=>{var l;if(e!=null&&e.length){let t=0;for(let m=0;m<(e==null?void 0:e.length);m++){let c=parseFloat((l=e[m])==null?void 0:l.totalNonight);t+=c}w(t||0)}},[e==null?void 0:e.length]),r.exports.useEffect(()=>{var l;if(e!=null&&e.length){let t=0;for(let m=0;m<(e==null?void 0:e.length);m++){let c=parseFloat((l=e[m])==null?void 0:l.averageCost);t+=c}D(t||0)}},[e==null?void 0:e.length]),r.exports.useEffect(()=>{var l;if(e!=null&&e.length){let t=0;for(let m=0;m<(e==null?void 0:e.length);m++){let c=parseFloat((l=e[m])==null?void 0:l.totalhostpayble);t+=c}X(t||0)}},[e==null?void 0:e.length]),i(g,{children:i("div",{ref:R,children:[i("div",{className:"mt-[25px]",children:[i("div",{className:"flex gap-x-[10px]",children:[i("p",{className:"font-semibold",children:"Landlord Name: "},void 0,!1,{fileName:s,lineNumber:299,columnNumber:21},void 0),i("p",{className:"capitalize",children:a!=null&&a.owner_name?a==null?void 0:a.owner_name:"Not Avaiable"},void 0,!1,{fileName:s,lineNumber:300,columnNumber:21},void 0)]},void 0,!0,{fileName:s,lineNumber:298,columnNumber:17},void 0),i("div",{className:"flex gap-x-[10px]",children:[i("p",{className:"font-semibold",children:"Community Name: "},void 0,!1,{fileName:s,lineNumber:303,columnNumber:21},void 0),i("p",{className:"capitalize",children:a!=null&&a.communityname?a==null?void 0:a.communityname:"Not Avaiable"},void 0,!1,{fileName:s,lineNumber:304,columnNumber:21},void 0)]},void 0,!0,{fileName:s,lineNumber:302,columnNumber:17},void 0),i("div",{className:"flex gap-x-[10px]",children:[i("p",{className:"font-semibold",children:"Project Name: "},void 0,!1,{fileName:s,lineNumber:307,columnNumber:21},void 0),i("p",{className:"capitalize",children:a!=null&&a.project_name?a==null?void 0:a.project_name:"Not Avaiable"},void 0,!1,{fileName:s,lineNumber:308,columnNumber:21},void 0)]},void 0,!0,{fileName:s,lineNumber:306,columnNumber:17},void 0),i("div",{className:"flex gap-x-[10px]",children:[i("p",{className:"font-semibold",children:"Apartment No: "},void 0,!1,{fileName:s,lineNumber:311,columnNumber:21},void 0),i("p",{className:"capitalize",children:a!=null&&a.unitnumber?a==null?void 0:a.unitnumber:"Not Avaiable"},void 0,!1,{fileName:s,lineNumber:312,columnNumber:21},void 0)]},void 0,!0,{fileName:s,lineNumber:310,columnNumber:17},void 0),i("div",{className:"flex gap-x-[10px]",children:[i("p",{className:"font-semibold",children:"Building No: "},void 0,!1,{fileName:s,lineNumber:315,columnNumber:21},void 0),i("p",{className:"capitalize",children:a!=null&&a.building_name?a==null?void 0:a.building_name:"Not Avaiable"},void 0,!1,{fileName:s,lineNumber:316,columnNumber:21},void 0)]},void 0,!0,{fileName:s,lineNumber:314,columnNumber:17},void 0)]},void 0,!0,{fileName:s,lineNumber:297,columnNumber:13},void 0),i("div",{className:"overflow-x-auto -mx-6 mt-6",children:i("div",{className:"inline-block min-w-full align-middle",children:i("div",{className:"",children:i("table",{className:"min-w-[100%] overflow-x-scroll divide-y divide-slate-100 table-fixed dark:divide-slate-700",...O,children:[i("thead",{className:"bg-slate-200 dark:bg-slate-700",children:j.map(l=>i("tr",{...l.getHeaderGroupProps(),children:l.headers.map(t=>i("th",{...t.getHeaderProps(t.getSortByToggleProps()),scope:"col",className:"table-th",children:[t.render("Header"),i("span",{children:t.isSorted?t.isSortedDesc?" \u{1F53D}":" \u{1F53C}":""},void 0,!1,{fileName:s,lineNumber:337,columnNumber:53},void 0)]},void 0,!0,{fileName:s,lineNumber:331,columnNumber:49},void 0))},void 0,!1,{fileName:s,lineNumber:328,columnNumber:37},void 0))},void 0,!1,{fileName:s,lineNumber:326,columnNumber:29},void 0),i("tbody",{className:"bg-white divide-y divide-slate-100 dark:bg-slate-800 dark:divide-slate-700",...T,children:[A&&A.length>0&&A.map(l=>(Y(l),i(g,{children:i("tr",{...l.getRowProps(),children:l.cells.map(t=>i("td",{...t.getCellProps(),className:"table-td",children:t.render("Cell")},void 0,!1,{fileName:s,lineNumber:358,columnNumber:57},void 0))},void 0,!1,{fileName:s,lineNumber:355,columnNumber:45},void 0)},void 0,!1))),i("tr",{children:[i("td",{},void 0,!1,{fileName:s,lineNumber:368,columnNumber:37},void 0),i("td",{},void 0,!1,{fileName:s,lineNumber:369,columnNumber:37},void 0),i("td",{className:"table-td",children:(H==null?void 0:H.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0}))+"  Available Nights"},void 0,!1,{fileName:s,lineNumber:370,columnNumber:38},void 0),i("td",{className:"table-td",children:(_==null?void 0:_.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0}))+"  Booked Nights"},void 0,!1,{fileName:s,lineNumber:374,columnNumber:37},void 0),i("td",{className:"table-td",children:(G==null?void 0:G.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))+" AED"},void 0,!1,{fileName:s,lineNumber:377,columnNumber:37},void 0),i("td",{className:"table-td",children:(L==null?void 0:L.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0}))+" %"},void 0,!1,{fileName:s,lineNumber:380,columnNumber:37},void 0),i("td",{},void 0,!1,{fileName:s,lineNumber:383,columnNumber:37},void 0),i("td",{className:"table-td",children:($==null?void 0:$.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))+" AED"},void 0,!1,{fileName:s,lineNumber:384,columnNumber:37},void 0),i("td",{},void 0,!1,{fileName:s,lineNumber:387,columnNumber:37},void 0)]},void 0,!0,{fileName:s,lineNumber:367,columnNumber:33},void 0)]},void 0,!0,{fileName:s,lineNumber:346,columnNumber:29},void 0)]},void 0,!0,{fileName:s,lineNumber:322,columnNumber:25},void 0)},void 0,!1,{fileName:s,lineNumber:321,columnNumber:21},void 0)},void 0,!1,{fileName:s,lineNumber:320,columnNumber:17},void 0)},void 0,!1,{fileName:s,lineNumber:319,columnNumber:13},void 0),i("div",{className:"md:flex md:space-y-0 space-y-5 justify-between mt-6 items-center",children:[i("div",{className:" flex items-center space-x-3 rtl:space-x-reverse",children:[i("select",{className:"form-control py-2 w-max",value:Q,onChange:l=>V(Number(l.target.value)),children:[50,100,200].map(l=>i("option",{value:l,children:["Show ",l]},l,!0,{fileName:s,lineNumber:403,columnNumber:29},void 0))},void 0,!1,{fileName:s,lineNumber:397,columnNumber:21},void 0),i("span",{className:"text-sm font-medium text-slate-600 dark:text-slate-300",children:["Page"," ",i("span",{children:[U+1," of ",C.length]},void 0,!0,{fileName:s,lineNumber:410,columnNumber:25},void 0)]},void 0,!0,{fileName:s,lineNumber:408,columnNumber:21},void 0)]},void 0,!0,{fileName:s,lineNumber:396,columnNumber:17},void 0),i("ul",{className:"flex items-center  space-x-3  rtl:space-x-reverse",children:[i("li",{className:"text-xl leading-4 text-slate-900 dark:text-white rtl:rotate-180",children:i("button",{className:` ${p?"":"opacity-50 cursor-not-allowed"}`,onClick:()=>o(0),disabled:!p,children:i(K,{icon:"heroicons:chevron-double-left-solid"},void 0,!1,{fileName:s,lineNumber:423,columnNumber:29},void 0)},void 0,!1,{fileName:s,lineNumber:417,columnNumber:25},void 0)},void 0,!1,{fileName:s,lineNumber:416,columnNumber:21},void 0),i("li",{className:"text-sm leading-4 text-slate-900 dark:text-white rtl:rotate-180",children:i("button",{className:` ${p?"":"opacity-50 cursor-not-allowed"}`,onClick:()=>I(),disabled:!p,children:"Prev"},void 0,!1,{fileName:s,lineNumber:427,columnNumber:25},void 0)},void 0,!1,{fileName:s,lineNumber:426,columnNumber:21},void 0),C.map((l,t)=>i("li",{children:i("button",{href:"#","aria-current":"page",className:` ${t===U?"bg-slate-900 dark:bg-slate-600  dark:text-slate-200 text-white font-medium ":"bg-slate-100 dark:bg-slate-700 dark:text-slate-400 text-slate-900  font-normal  "}    text-sm rounded leading-[16px] flex h-6 w-6 items-center justify-center transition-all duration-150`,onClick:()=>o(t),children:l+1},void 0,!1,{fileName:s,lineNumber:438,columnNumber:29},void 0)},t,!1,{fileName:s,lineNumber:437,columnNumber:25},void 0)),i("li",{className:"text-sm leading-4 text-slate-900 dark:text-white rtl:rotate-180",children:i("button",{className:` ${h?"":"opacity-50 cursor-not-allowed"}`,onClick:()=>P(),disabled:!h,children:"Next"},void 0,!1,{fileName:s,lineNumber:452,columnNumber:25},void 0)},void 0,!1,{fileName:s,lineNumber:451,columnNumber:21},void 0),i("li",{className:"text-xl leading-4 text-slate-900 dark:text-white rtl:rotate-180",children:i("button",{onClick:()=>o(d-1),disabled:!h,className:` ${h?"":"opacity-50 cursor-not-allowed"}`,children:i(K,{icon:"heroicons:chevron-double-right-solid"},void 0,!1,{fileName:s,lineNumber:468,columnNumber:29},void 0)},void 0,!1,{fileName:s,lineNumber:462,columnNumber:25},void 0)},void 0,!1,{fileName:s,lineNumber:461,columnNumber:21},void 0)]},void 0,!0,{fileName:s,lineNumber:415,columnNumber:17},void 0)]},void 0,!0,{fileName:s,lineNumber:395,columnNumber:13},void 0)]},void 0,!0,{fileName:s,lineNumber:296,columnNumber:9},void 0)},void 0,!1)});var u="D:\\Ahsan\\Rare\\Dev\\Rare_Frontend\\src\\pages\\booking-management\\booking-summary\\BookingSummary.jsx";const le={option:(e,a)=>({...e,fontSize:"14px"})},ce=()=>{var C;const[e,a]=r.exports.useState({propertyid:"",filteredDates:[]}),[R,v]=r.exports.useState([]),[b,M]=r.exports.useState(""),[S,E]=r.exports.useState(""),[x,O]=r.exports.useState([]),[T,j]=r.exports.useState("");r.exports.useEffect(()=>{fetch("http://stg.srp.ai/property").then(n=>n.json()).then(n=>{const o=n==null?void 0:n.map(d=>({label:d.unitnumber+" | "+d.communityname+" | "+d.projectname+" | "+d.buildingname,value:d._id}));O(o)})},[]),r.exports.useEffect(()=>{(async()=>{if(e!=null&&e.propertyid){const d=await(await fetch(`http://stg.srp.ai/property/${e==null?void 0:e.propertyid}`)).json();d&&j(d)}})()},[e==null?void 0:e.propertyid]),r.exports.useEffect(()=>{(async()=>{const d=await(await fetch("http://stg.srp.ai/booking")).json();M(d)})()},[]);const[z,A]=r.exports.useState({startDate:"",endDate:""}),P=r.exports.useRef(null),I=async()=>{const o=await(await fetch(`http://stg.srp.ai/booking/summary/${e==null?void 0:e.propertyid}`)).json();v(o.data),console.log("=============>",o)};r.exports.useEffect(()=>{if(b!=null&&b.length&&(e==null?void 0:e.propertyid)&&(e==null?void 0:e.startDate)&&(e==null?void 0:e.endDate)){const n=b.filter(o=>{let d=!0;return e.propertyid&&o.propertyid!==e.propertyid&&(d=!1),(o==null?void 0:o.checkindate)<(e==null?void 0:e.startDate)&&(o==null?void 0:o.checkindate)>(e==null?void 0:e.endDate)&&(d=!1),d});v(n)}I()},[e==null?void 0:e.propertyid,e==null?void 0:e.startDate,e==null?void 0:e.endDate,b]);const h=()=>{E(""),a({...e,filteredDates:[]}),A({startDate:null,endDate:null})},p=async n=>{if(console.log("newValue",n),E(n),!n){a({...e,filteredDates:[]});return}const d=await(await fetch(`http://stg.srp.ai/booking/summarybyDates/${e==null?void 0:e.propertyid}?fromdate=${n.startDate}&todate=${n.endDate}`)).json();a({...e,filteredDates:d==null?void 0:d.data})};return i(g,{children:i("div",{className:"xl:col-span-2 col-span-1",children:i(B,{title:"Booking Summary",children:[i("div",{className:"flex flex-row-reverse"},void 0,!1,{fileName:u,lineNumber:167,columnNumber:21},void 0),i("div",{children:[i("form",{className:"lg:grid-cols-3 grid gap-5 grid-cols-1 ",children:[i("div",{className:"w-[100%] col-span-3",children:i("h4",{className:"text-base text-slate-800 dark:text-slate-300 mb-[0.5rem] mt-[0.5rem]",children:"Select Property"},void 0,!1,{fileName:u,lineNumber:176,columnNumber:33},void 0)},void 0,!1,{fileName:u,lineNumber:175,columnNumber:29},void 0),i("div",{className:"w-[100%] col-span-3",children:i(ee,{label:"Basic Select",className:"react-select",classNamePrefix:"select",options:x,value:x&&S?x.filter(function(n){return n.value===(e==null?void 0:e.propertyid)}):x.filter(function(n){return n.value===(e==null?void 0:e.propertyid)}),onChange:n=>{S?h():a({...e,propertyid:n==null?void 0:n.value})},styles:le,id:"hh",placeholder:"Select and Search property"},void 0,!1,{fileName:u,lineNumber:184,columnNumber:33},void 0)},void 0,!1,{fileName:u,lineNumber:180,columnNumber:29},void 0)]},void 0,!0,{fileName:u,lineNumber:171,columnNumber:25},void 0),console.log("userData222=========HJKL=====>",e),e.propertyid&&i(g,{children:i("div",{className:"flex justify-end mt-[25px]",children:[i("div",{className:"w-[150px]",children:i("div",{className:"date-range-custom relative",children:i(ie,{value:z,inputClassName:"input-class",containerClassName:"container-class",onChange:p,placeholder:"SELECT DATE"},void 0,!1,{fileName:u,lineNumber:232,columnNumber:49},void 0)},void 0,!1,{fileName:u,lineNumber:231,columnNumber:45},void 0)},void 0,!1,{fileName:u,lineNumber:230,columnNumber:41},void 0),S&&i("div",{className:"flex justify-end",children:i("div",{className:"w-[90px]",children:i("div",{className:"date-range-custom relative",children:i("button",{className:"btn btn-dark text-white  text-center",type:"button",onClick:h,children:"Reset"},void 0,!1,{fileName:u,lineNumber:246,columnNumber:45},void 0)},void 0,!1,{fileName:u,lineNumber:245,columnNumber:45},void 0)},void 0,!1,{fileName:u,lineNumber:244,columnNumber:41},void 0)},void 0,!1,{fileName:u,lineNumber:243,columnNumber:25},void 0)]},void 0,!0,{fileName:u,lineNumber:229,columnNumber:37},void 0)},void 0,!1)]},void 0,!0,{fileName:u,lineNumber:170,columnNumber:21},void 0),(C=e.filteredDates)!=null&&C.length?i(g,{children:i(q,{allBooking:e.filteredDates,propertyData:T,ref:P},void 0,!1,{fileName:u,lineNumber:262,columnNumber:33},void 0)},void 0,!1):i(g,{children:i(q,{allBooking:R,propertyData:T,ref:P},void 0,!1,{fileName:u,lineNumber:266,columnNumber:33},void 0)},void 0,!1)]},void 0,!0,{fileName:u,lineNumber:166,columnNumber:17},void 0)},void 0,!1,{fileName:u,lineNumber:165,columnNumber:13},void 0)},void 0,!1)};export{ce as default};
