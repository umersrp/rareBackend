import{R as B,r as i,j as e,c,F as f,C as q,aq as _,b$ as H}from"./index.ff2edc16.js";import{D as Y}from"./index.esm.b17abfdf.js";import"./jspdf.es.min.e2b79676.js";import"./html2canvas.esm.0eae2bf4.js";import{T as $}from"./Table.e48059ec.js";import{E as Q}from"./excel.9601f4f9.js";import{L as V}from"./Rare logo New Gif Loading.02c4dc82.js";import{E as W}from"./exceljs.min.dc649ba1.js";import"./index.186db273.js";const z=B.forwardRef(({allBooking:t,propertyData:u},w)=>{const E=r=>{const{contractstartdate:h,contractenddate:a}=r;let N=new Date(h),y=new Date(a);return(y.getFullYear()-N.getFullYear())*12+(y.getMonth()-N.getMonth())+" Months"};i.exports.useState(0),i.exports.useState(0),i.exports.useState(0);const s=({title:r,value:h})=>c("tr",{className:"bg-slate-200 border border-gray-300 ",children:[e("td",{className:"px-2 py-2 whitespace-nowrap text-sm font-semibold text-slate-800 border-r  ",children:r}),e("td",{className:"px-2 py-2 whitespace-nowrap text-sm text-gray-500 capitalize bg-white",children:h})]});return e("div",{children:t&&t.length>0&&t.map(r=>{var h;return c("div",{ref:w,children:[e("div",{className:"w-[100%] col-span-3 mb-4",children:e("div",{className:"borderBottom"})}),e("div",{className:"w-[100%] col-span-3",children:e("h4",{className:"text-lg font-semibold text-slate-800 dark:text-slate-300 mb-[0.5rem] mt-[0.5rem]",children:"CONTRACT DETAILS"})}),c("div",{className:"mt-[25px] flex justify-between",children:[e("div",{className:"overflow-hidden p-2 w-[35%]",children:c("table",{className:"min-w-full divide-y divide-gray-200 animate-slide-right",children:[e("thead",{children:e("tr",{children:e("h4",{className:"text-[16px] text-slate-800",children:"PROPERTY DETAILS"})})}),c("tbody",{children:[e(s,{title:"Property Code",value:r.propertycode?r.propertycode:"Not Available"}),e(s,{title:"Landlord Name",value:r.owner_name?r.owner_name:"Not Available"}),e(s,{title:"Community Name",value:r.communityname?r.communityname:"Not Available"}),e(s,{title:"Project Name",value:r.project_name?r.project_name:"Not Available"}),e(s,{title:"Apartment No",value:r.unitnumber?r.unitnumber:"Not Available"}),e(s,{title:"Building No",value:r.building_name?r.building_name:"Not Available"})]})]})}),e("div",{className:"overflow-hidden p-2 w-[35%]",children:c("table",{className:"min-w-full divide-y divide-gray-200 animate-slide-right",children:[e("h4",{className:"text-[16px] text-slate-800",children:"TENANCY DETAILS "}),c("tbody",{className:"transition-all duration-1000 ease-in",children:[e(s,{title:"Tenancy contract No",value:r.tenantcontractno?r.tenantcontractno:"Not Available"}),e(s,{title:"Tenant Name",value:r.guestname?r.guestname:"Not Available"}),e(s,{title:"Tenancy Start Date",value:r?new Date(r.contractstartdate).toDateString():"Not Available"}),e(s,{title:"Tenancy Expiry Date",value:r?new Date(r.contractenddate).toDateString():"Not Available"}),e(s,{title:"Tenancy Period",value:r?E(r):"Not Available"})]})]})}),e("div",{className:"overflow-hidden p-2 w-[30%]",children:c("table",{className:"min-w-full divide-y divide-gray-200 animate-slide-right",children:[e("h4",{className:"text-[16px] text-slate-800",children:"AMOUNTS DETAILS "}),c("tbody",{className:"transition-all duration-1000 ease-in",children:[e(s,{title:"Rental Amount",value:r?"AED "+r.rentalamount:"Not Available"}),e(s,{title:"Payment Terms",value:r?r.noofchequeorinstallment+" installments":"Not Available"}),e(s,{title:"Each Installment",value:r?"AED "+(Number(r.rentalamount)/r.noofchequeorinstallment).toFixed(2):"Not Available"})]})]})})]}),c("div",{className:"overflow-x-auto -mx-6 mt-6",children:[e("div",{className:"w-[100%] col-span-3",children:e("h4",{className:"text-lg font-semibold text-slate-800 dark:text-slate-300 mb-[0.5rem] mt-[0.5rem] p-[20px]",children:"CHEQUE MANAGEMENT DETAIL"})}),e("div",{className:"p-[20px]",children:c($,{responsive:"lg",bordered:!0,children:[e("thead",{className:"border text-black table-back",children:c("tr",{className:"w-[150px] h-[60px]",children:[e("th",{className:"text-center border-r border-gray-500 text-[12px]",children:"Sr no"}),e("th",{className:"text-center border-r border-gray-500 text-[12px]",children:"RENTAL INCOME PERIOD"}),e("th",{className:"text-center border-r border-gray-500 text-[12px]",children:"STATUS"}),e("th",{className:"text-center border-r border-gray-500 text-[12px]",children:"CHEQUE NUMBER"}),e("th",{className:"text-center border-r border-gray-500 text-[12px]",children:"CHEQUE DATE"}),e("th",{className:"text-center border-r border-gray-500 text-[12px]",children:"CHEQUE AMOUNT"}),e("th",{className:"text-center border-r border-gray-500 text-[12px]",children:"EARLY TERMINATION (RENT REFUND)"}),e("th",{className:"text-center border-r border-gray-500 text-[12px]",children:"CASH COLLECTED"}),e("th",{className:"text-center border-r border-gray-500 text-[12px]",children:"DEPOSITED IN OWNER ACCOUNT"}),e("th",{className:"text-center border-r border-gray-500 text-[12px]",children:"BOUNCED / UNREALISED"})]})}),c("tbody",{children:[r&&((h=r==null?void 0:r.chequeDetails)==null?void 0:h.length)>0&&(r==null?void 0:r.chequeDetails.map((a,N)=>c("tr",{className:"w-[150px] h-[100px]",children:[e("td",{className:"border border-gray-100 text-center",children:N+1}),e("td",{className:"border border-gray-100 text-center",children:a.someProperty?a.someProperty:"Not Available"}),e("td",{className:"border border-gray-100 text-center",children:a.someOtherProperty?a.someOtherProperty:"Not Available"}),e("td",{className:"border border-gray-100 text-center",children:a.chequenumbe?a.chequenumbe:"Not Available"}),e("td",{className:"border border-gray-100 text-center",children:a.chequedate?new Date(a.chequedate).toDateString():"Not Available"}),c("td",{className:"border border-gray-100 text-center",children:[a.totalamount?Number(a.totalamount).toLocaleString():"Not Available"," AED"]}),e("td",{className:"border border-gray-100 text-center",children:a.someOtherProperty?a.someOtherProperty:"Not Available"}),c("td",{className:"border border-gray-100 text-center",children:[a.totalamount?Number(a.totalamount).toLocaleString():"Not Available"," AED"]}),"                                                         ",e("td",{className:"border border-gray-100 text-center",children:"Not Available"}),e("td",{className:"border border-gray-100 text-center",children:a.someOtherProperty?a.someOtherProperty:"Not Available"})]},a._id))),c("tr",{children:[e("td",{colSpan:"5",className:"border border-gray-100 text-center font-semibold",children:"RENT TO BE REALISED"}),c("td",{className:"border border-gray-100 text-center font-semibold",children:[r.chequeDetails.map(a=>Number(a.totalamount)).reduce((a,N)=>a+N,0).toLocaleString()," AED"]}),"                                                ",e("td",{className:"border border-gray-100 text-center"}),c("td",{className:"border border-gray-100 text-center font-semibold",children:[r.chequeDetails.map(a=>Number(a.totalamount)).reduce((a,N)=>a+N,0).toLocaleString()," AED"]}),e("td",{colSpan:"2",className:"border border-gray-100 text-center"})]})]})]})})]}),e("div",{})]})})})}),G={option:(t,u)=>({...t,fontSize:"14px"})},oe=()=>{var T,R;const[t,u]=i.exports.useState({propertyid:"",filteredDates:[]}),[w,E]=i.exports.useState([]),[s,r]=i.exports.useState(""),[h,a]=i.exports.useState(""),[N,y]=i.exports.useState(!1),[x,S]=i.exports.useState([]),[b,C]=i.exports.useState(""),[F,A]=i.exports.useState({filterData:[],propertyData:{}}),L=o=>{const{contractstartdate:d,contractenddate:n}=o;let g=new Date(d),l=new Date(n);return(l.getFullYear()-g.getFullYear())*12+(l.getMonth()-g.getMonth())+" Months"},O=async o=>{console.log("Export button clicked",o);const{filterData:d,propertyData:n}=o,g=new W.Workbook,l=g.addWorksheet("Sheet1");l.mergeCells("A1:F1"),l.addRow(["TENANCY REPORTS"]),l.addRow(["Landlord Name","Community Name","Project Name","Apartment No","Building No"]),l.columns=[{header:"Landlord Name",key:"customername",width:30},{header:"Community Name",key:"communityname",width:40},{header:"Project Name",key:"projectname",width:25},{header:"Apartment No",key:"unitnumber",width:25},{header:"Building No",key:"buildingname",width:25},{header:"",key:"nonight",width:20},{header:"",key:"roomrenthostpayable",width:55}];const v=[];v.push(n),v.map(p=>{l.addRow([p.customername,p.communityname,p.projectname,p.unitnumber,p.buildingname])}),l.addRow([]),l.addRow([]),l.addRow([]),l.addRow(["Tenancy contract No","Tenant Name","Tenancy Start Date","Tenancy Expiry Date","Tenancy Period"]),d.forEach(p=>{l.addRow([p.tenantcontractno,p.guestname,new Date(p.contractstartdate).toDateString(),new Date(p.contractenddate).toDateString(),L(p)])}),l.addRow([]),l.addRow([]),l.addRow([]),l.addRow([]);const k=["RENTAL INCOME PERIOD","STATUS","CHEQUE NUMBER","CHEQUE DATE","CHEQUE AMOUNT","EARLY TERMINATION (RENT REFUND)","CASH COLLECTED","DEPOSITED IN OWNER ACCOUNT","BOUNCED / UNREALISED"];l.addRow(k),d.forEach(p=>{p.chequeDetails.map(m=>{l.addRow(["NOT AVAILIBLE",m.status,m==null?void 0:m.chequenumbe,new Date(m==null?void 0:m.chequedate).toDateString(),m==null?void 0:m.totalamount,m.state,m.totalamount,m==null?void 0:m.rentalamount,"NOT AVAILIBLE","NOT AVAILIBLE"])})}),l.getRow(2).font={bold:!0},l.getRow(2).fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},l.getRow(8).fill={type:"pattern",pattern:"solid",fgColor:{argb:"808080"}},l.getRow(3).fill={type:"pattern",pattern:"solid",fgColor:{argb:"808080"}},l.getRow(16).fill={type:"pattern",pattern:"solid",fgColor:{argb:"808080"}},l.getRow(2).font={color:{argb:"FFFFFF"}},l.getRow(3).font={color:{argb:"FFFFFF"}},l.getRow(8).font={color:{argb:"FFFFFF"}},l.getRow(16).font={color:{argb:"FFFFFF"}};const M=await g.xlsx.writeBuffer();H.exports.saveAs(new Blob([M]),"tenancy_report.xlsx")};i.exports.useEffect(()=>{fetch("http://dev-rare.srp.ai/property").then(o=>o.json()).then(o=>{const d=o==null?void 0:o.map(n=>({label:n.unitnumber+" | "+n.communityname+" | "+n.projectname+" | "+n.buildingname,value:n._id}));S(d)})},[]),i.exports.useEffect(()=>{(async()=>{if(t!=null&&t.propertyid){const n=await(await fetch(`http://dev-rare.srp.ai/property/${t==null?void 0:t.propertyid}`)).json();n&&C(n)}})()},[t==null?void 0:t.propertyid]),i.exports.useEffect(()=>{(async()=>{const n=await(await fetch(`http://dev-rare.srp.ai/tenantcontract/report/${t==null?void 0:t.propertyid}?contractstartdate=${newValue.startDate}&contractenddate=${newValue.endDate}`)).json();A(n==null?void 0:n.data),r(n==null?void 0:n.data)})()},[]);const[P,I]=i.exports.useState({startDate:"",endDate:""}),U=i.exports.useRef(null);i.exports.useEffect(()=>{if(s!=null&&s.length&&(t==null?void 0:t.propertyid)&&(t==null?void 0:t.startDate)&&(t==null?void 0:t.endDate)){const o=s.filter(d=>{let n=!0;return t.propertyid&&d.propertyid!==t.propertyid&&(n=!1),(d==null?void 0:d.checkindate)<(t==null?void 0:t.startDate)&&(d==null?void 0:d.checkindate)>(t==null?void 0:t.endDate)&&(n=!1),n});E(o)}},[t==null?void 0:t.propertyid,t==null?void 0:t.startDate,t==null?void 0:t.endDate,s]);const D=()=>{a(""),u({...t,filteredDates:[]}),I({startDate:null,endDate:null})},j=async o=>{if(y(!0),console.log("newValue",o),a(o),!o){u({...t,filteredDates:[]});return}const n=await(await fetch(`http://dev-rare.srp.ai/tenantcontract/report/${t==null?void 0:t.propertyid}?contractstartdate=${o.startDate}&contractenddate=${o.endDate}`)).json();y(!1),u({...t,filteredDates:n==null?void 0:n.data}),b.customername,b.communityname,b.projectname,b.unitnumber,b.buildingname,A({filterData:n==null?void 0:n.data,propertyData:b})};return e(f,{children:e("div",{className:"xl:col-span-2 col-span-1",children:c(q,{title:"Tenancy Reports",children:[e("div",{className:"flex flex-row-reverse",children:t&&((T=t.filteredDates)==null?void 0:T.length)>0?c("button",{className:"h-[34px] rounded-[10px] relative bg-white border1px flex items-center gap-x-[10px] justify-around px-[10px] py-[5px] cursor-pointer",onClick:()=>O(F),children:[e("img",{src:Q,alt:"Excel icon",className:"w-[20px] h-[20px] noselect"}),e("p",{className:"text-[14px] leading regular color-black",children:"Export in Excel"})]}):null}),c("div",{children:[c("form",{className:"lg:grid-cols-3 grid gap-5 grid-cols-1 ",children:[e("div",{className:"w-[100%] col-span-3",children:e("h4",{className:"text-base text-slate-800 dark:text-slate-300 mb-[0.5rem] mt-[0.5rem]",children:"Select Property"})}),e("div",{className:"w-[100%] col-span-3",children:e(_,{label:"Basic Select",className:"react-select",classNamePrefix:"select",options:x,value:x&&h?x.filter(function(o){return o.value===(t==null?void 0:t.propertyid)}):x.filter(function(o){return o.value===(t==null?void 0:t.propertyid)}),onChange:o=>{h?D():u({...t,propertyid:o==null?void 0:o.value})},styles:G,id:"hh",placeholder:"Select and Search property"})})]}),t.propertyid&&e(f,{children:c("div",{className:"flex justify-end mt-[25px]",children:[e("div",{className:"w-[150px]",children:e("div",{className:"date-range-custom relative",children:e(Y,{value:P,inputClassName:"input-class",containerClassName:"container-class",onChange:j,placeholder:"SELECT DATE"})})}),h&&e("div",{className:"flex justify-end",children:e("div",{className:"w-[90px]",children:e("div",{className:"date-range-custom relative",children:e("button",{className:"btn btn-dark text-white  text-center",type:"button",onClick:D,children:"Reset"})})})})]})})]}),N===!0?e(f,{children:e("div",{className:"flex items-center justify-center h-[100%]",children:e("img",{src:V,width:150,height:150})})}):(R=t.filteredDates)!=null&&R.length?e(f,{children:e(z,{allBooking:t.filteredDates,propertyData:b,ref:U})}):e(f,{children:e("h6",{className:"text-base text-slate-800 dark:text-slate-300  mt-[0.5rem] mb-12",children:"No Property Data Found"})})]})})})};export{oe as default};
