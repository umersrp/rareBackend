import{R as j,j as t,F as m,r as c,b as s,C as ke,an as Se,I as W}from"./index.5e55c1ba.js";import{r as f}from"./index.c89ffb9d.js";import{D as Ce}from"./index.esm.c068ea99.js";import"./jspdf.es.min.085956f0.js";import"./html2canvas.esm.0eae2bf4.js";const J=j.forwardRef(({indeterminate:u,...C},x)=>{const D=j.useRef(),r=x||D;return j.useEffect(()=>{r.current.indeterminate=u},[r,u]),t(m,{children:t("input",{type:"checkbox",ref:r,...C,className:"table-checkbox"})})}),De={option:(u,C)=>({...u,fontSize:"14px"})},Pe=({title:u,allData:C})=>{var z,F,B,L,M,O,G,U,q,V;const[x,D]=c.exports.useState([]),[r,v]=c.exports.useState([]),K=localStorage.getItem("isAuth"),p=JSON.parse(K),[N,Q]=c.exports.useState();c.exports.useState();const[b,X]=c.exports.useState(),[y,Y]=c.exports.useState([]),[Z,_]=c.exports.useState(!1),[i,$]=c.exports.useState({propertyid:"",filteredDates:[]}),[w,ee]=c.exports.useState({startDate:"",endDate:""}),[P,H]=c.exports.useState("");console.log("selectedProperty",i);const te=async e=>{console.log("newValue",e),H(e);const n=(await(await fetch(`http://dev-rare.srp.ai/booking/api/reservationdate?ownerid=${p==null?void 0:p._id}&${i!=null&&i.propertyid?"propertyid="+(i==null?void 0:i.propertyid)+"&":""}checkindate=${e.startDate}&checkindate=${e.endDate}`)).json()).filter(o=>o.propertyid===i.propertyid&&o.cancelled===!1);$({...i,filteredDates:n}),v(n)},[d,ae]=c.exports.useState([]);c.exports.useEffect(()=>{(async()=>{const l=await(await fetch(`http://dev-rare.srp.ai/booking/pagination/pages?ownerid=${p==null?void 0:p._id}&page=0&perPage=all`)).json();l!=null&&l.booking?v([]):v([])})()},[]);const le=e=>{const a=new Set;return e.filter(l=>a.has(l._id)?!1:(a.add(l._id),!0))};c.exports.useEffect(()=>{(async()=>{try{const a=`http://dev-rare.srp.ai/property/api/advancesearch?customerid=${p==null?void 0:p._id}&sort=descending&type=customer&page=0&perPage=all`,l=`http://dev-rare.srp.ai/property/api/advancesearch?owner_representative_id=${p==null?void 0:p._id}&sort=descending&type=customer&page=0&perPage=all`,n=await fetch(a);if(!n.ok&&n.status!==400)throw new Error(`API 1 failed with status: ${n.status}`);const o=n.status===400?[]:await n.json(),h=await fetch(l);if(!h.ok&&h.status!==400)throw new Error(`API 2 failed with status: ${h.status}`);const g=h.status===400?[]:await h.json(),Ne=[...o,...g].map(R=>R._id),be=(await Promise.all(Ne.map(async R=>await(await fetch(`http://dev-rare.srp.ai/booking/ownerrepresentative/pages?propertyid=${R}&page=0&perPage=all`)).json()))).flat([2]),ye=le(be);D(ye)}catch(a){console.error("Error fetching data:",a),setLoadingData(!1)}})()},[]),c.exports.useEffect(()=>{(async()=>{const a=x.map(async n=>{const{propertyid:o}=n;return await(await fetch(`http://dev-rare.srp.ai/property/${o}`)).json()}),l=await Promise.all(a);ae(l)})()},[x]),c.exports.useEffect(()=>{if(_(!0),d.length){const e=[...new Map(d.map(l=>[l._id,l])).values()],a=e==null?void 0:e.map(l=>({label:l.unitnumber+" | "+l.communityname+" | "+l.projectname+" | "+l.buildingname,value:l._id}));_(!1),Y(a)}},[d]),c.exports.useState(!1);const I=()=>{H(""),v([]),ee({startDate:null,endDate:null})};c.exports.useEffect(()=>{var a;let e=0;for(let l=0;l<(r==null?void 0:r.length);l++){let n=parseInt((a=r[l])==null?void 0:a.nonight);e+=n}Q(e)},[r==null?void 0:r.length]),c.exports.useEffect(()=>{var a;let e=0;for(let l=0;l<(r==null?void 0:r.length);l++){let n=parseInt((a=r[l])==null?void 0:a.roomrentamount);e+=n}X(e)},[r==null?void 0:r.length]),c.exports.useRef(null);const se=[{Header:"Sr no",accessor:"id",Cell:({row:e,flatRows:a})=>t("span",{children:a.indexOf(e)+1})},{Header:"guest name",accessor:"guestname",Cell:e=>{var a,l,n,o,h;return t("span",{children:(a=e==null?void 0:e.cell)!=null&&a.value?((n=(l=e==null?void 0:e.cell)==null?void 0:l.value)==null?void 0:n.slice(0,15))+(((h=(o=e==null?void 0:e.cell)==null?void 0:o.value)==null?void 0:h.length)>15?"...":""):"Not Available"})}},{Header:"reservation date",accessor:"reservationdate",Cell:e=>{var a,l;return t("span",{children:(a=e==null?void 0:e.cell)!=null&&a.value?new Date((l=e==null?void 0:e.cell)==null?void 0:l.value).toDateString():"Not Available"})}},{Header:"Booking Ref#",accessor:"confirmationcode",Cell:e=>{var a,l,n,o;return t("div",{children:t("span",{className:"inline-flex items-center",children:t("span",{className:"text-sm text-slate-600 dark:text-slate-300 lowercase",children:(a=e==null?void 0:e.cell)!=null&&a.value?((l=e==null?void 0:e.cell)==null?void 0:l.value.slice(0,15))+(((o=(n=e==null?void 0:e.cell)==null?void 0:n.value)==null?void 0:o.length)>15?"...":""):"Not Available"})})})}},{Header:"checkin date",accessor:"checkindate",Cell:e=>{var a,l;return t("span",{children:(a=e==null?void 0:e.cell)!=null&&a.value?new Date((l=e==null?void 0:e.cell)==null?void 0:l.value).toDateString():"Not Available"})}},{Header:"checkout date",accessor:"checkoutdate",Cell:e=>{var a,l;return t("span",{children:(a=e==null?void 0:e.cell)!=null&&a.value?new Date((l=e==null?void 0:e.cell)==null?void 0:l.value).toDateString():"Not Available"})}},{id:"no nights stayed",Header:"no nights stayed",accessor:"nonight",Cell:e=>{var a,l;return t("span",{children:(a=e==null?void 0:e.cell)!=null&&a.value?(l=e==null?void 0:e.cell)==null?void 0:l.value:"Not Available"})}},{Header:"Rate per Day",accessor:"tourismfee",Cell:e=>{var a,l,n,o,h,g;return t("span",{children:parseInt(((n=(l=(a=e==null?void 0:e.cell)==null?void 0:a.row)==null?void 0:l.original)==null?void 0:n.roomrentamount)/((g=(h=(o=e==null?void 0:e.cell)==null?void 0:o.row)==null?void 0:h.original)==null?void 0:g.nonight)).toFixed(2)})}},{Header:"Booking Amount",accessor:"roomrentamount",Cell:e=>{var a,l;return t("span",{children:(a=e==null?void 0:e.cell)!=null&&a.value?parseInt((l=e==null?void 0:e.cell)==null?void 0:l.value).toFixed(2):"Not Available"})}}],ne=c.exports.useMemo(()=>se,[]),re=c.exports.useMemo(()=>r),ce=f.exports.useTable({columns:ne,data:re,initialState:{pageIndex:0,pageSize:50}},f.exports.useGlobalFilter,f.exports.useSortBy,f.exports.usePagination,f.exports.useRowSelect,e=>{e.visibleColumns.push(a=>[{id:"selection",Header:({getToggleAllRowsSelectedProps:l})=>t("div",{children:t(J,{...l()})}),Cell:({row:l})=>t("div",{children:t(J,{...l.getToggleRowSelectedProps()})})},...a])}),{getTableProps:ie,getTableBodyProps:oe,headerGroups:de,footerGroups:Ae,page:pe,nextPage:he,previousPage:me,canNextPage:k,canPreviousPage:S,pageOptions:E,state:ue,gotoPage:A,pageCount:ge,setPageSize:fe,setGlobalFilter:Re,prepareRow:xe}=ce,{globalFilter:je,pageIndex:T,pageSize:ve}=ue;return t(m,{children:t("div",{className:"xl:col-span-2 col-span-1",children:s(ke,{title:"Booking Report",children:[t("div",{className:"flex flex-row-reverse"}),s("div",{children:[s("form",{className:"lg:grid-cols-3 grid gap-5 grid-cols-1 ",children:[t("div",{className:"w-[100%] col-span-3",children:t("h4",{className:"text-base text-slate-800 dark:text-slate-300 mb-[0.5rem] mt-[0.5rem]",children:"Select Property"})}),t("div",{className:"w-[100%] col-span-3",children:Z===!0?t(m,{children:t("div",{className:"flex items-center justify-center h-[100%]",children:s("svg",{className:"animate-spin ltr:-ml-1 ltr:mr-3 rtl:-mr-1 rtl:ml-3 h-6 w-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[t("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),t("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})})}):t(m,{children:t(Se,{label:"Basic Select",className:"react-select",classNamePrefix:"select",options:y,value:y&&P?y.filter(function(e){return e.value===(i==null?void 0:i.propertyid)}):y.filter(function(e){return e.value===(i==null?void 0:i.propertyid)}),placeholder:"Select Property",onChange:e=>{P?I():$({propertyid:e==null?void 0:e.value,propertyname:e==null?void 0:e.label},"select box")},styles:De,id:"hh"})})})]}),"  ",(i==null?void 0:i.propertyid)&&t(m,{children:s("div",{className:"flex justify-end mt-[25px]",children:[t("div",{className:"w-[150px]",children:t("div",{className:"date-range-custom relative",children:t(Ce,{value:w,inputClassName:"input-class",containerClassName:"container-class",onChange:te})})}),P&&t(m,{children:t("div",{className:"flex justify-end",children:t("div",{className:"w-[90px]",children:t("div",{className:"date-range-custom relative",children:t("button",{className:"btn btn-dark text-white  text-center",onClick:I,children:"Reset"})})})})})]})})]}),t("div",{className:"overflow-x-auto -mx-6",children:t("div",{className:"inline-block min-w-full align-middle",children:t("div",{className:"overflow-hidden ",children:r&&r.length>0&&r?s(m,{children:[" ",s("div",{className:"mt-[25px] p-8",children:[s("div",{className:"flex gap-x-[10px]",children:[t("p",{className:"font-semibold",children:"Landlord Name: "}),t("p",{className:"capitalize",children:(z=d[0])!=null&&z.owner_name?(F=d[0])==null?void 0:F.owner_name:"Not Avaiable"})]}),s("div",{className:"flex gap-x-[10px]",children:[t("p",{className:"font-semibold",children:"Community Name: "}),t("p",{className:"capitalize",children:(B=d[0])!=null&&B.communityname?(L=d[0])==null?void 0:L.communityname:"Not Avaiable"})]}),s("div",{className:"flex gap-x-[10px]",children:[t("p",{className:"font-semibold",children:"Project Name: "}),t("p",{className:"capitalize",children:(M=d[0])!=null&&M.project_name?(O=d[0])==null?void 0:O.project_name:"Not Avaiable"})]}),s("div",{className:"flex gap-x-[10px]",children:[t("p",{className:"font-semibold",children:"Apartment No: "}),t("p",{className:"capitalize",children:(G=d[0])!=null&&G.unitnumber?(U=d[0])==null?void 0:U.unitnumber:"Not Avaiable"})]}),s("div",{className:"flex gap-x-[10px]",children:[t("p",{className:"font-semibold",children:"Building No: "}),t("p",{className:"capitalize",children:(q=d[0])!=null&&q.building_name?(V=d[0])==null?void 0:V.building_name:"Not Avaiable"})]})]})," ",s("table",{className:"min-w-full divide-y divide-slate-100 table-fixed dark:divide-slate-700",...ie,children:[t("thead",{className:"bg-slate-200 dark:bg-slate-700",children:de.map(e=>t("tr",{...e.getHeaderGroupProps(),children:e.headers.map(a=>s("th",{...a.getHeaderProps(a.getSortByToggleProps()),scope:"col",className:" table-th ",children:[a.render("Header"),t("span",{children:a.isSorted?a.isSortedDesc?" \u{1F53D}":" \u{1F53C}":""})]}))}))}),s("tbody",{className:"bg-white divide-y divide-slate-100 dark:bg-slate-800 dark:divide-slate-700",...oe,children:[console.log("cccccccccccccccccc",d),pe.map(e=>(xe(e),t("tr",{...e.getRowProps(),children:e.cells.map(a=>t("td",{...a.getCellProps(),className:"table-td",children:a.render("Cell")}))}))),s("tr",{children:[t("td",{className:"table-td font-bold",children:"TOTAL"}),t("td",{}),t("td",{}),t("td",{}),t("td",{}),t("td",{}),t("td",{}),s("td",{className:"table-td font-bold",children:[N?N.toLocaleString():0," Nights"]}),s("td",{className:"table-td font-bold",children:[b&&N?Math.abs(b/N).toLocaleString():0," AED"]}),s("td",{className:"table-td font-bold",children:[b?b.toLocaleString():0," AED"]})]})]})]})]}):t(m,{children:t("div",{className:"p-8",children:t("h4",{className:"text-base text-slate-800 dark:text-slate-300 mb-[0.5rem] mt-[0.5rem]",children:"No Property Data found"})})})})})}),s("div",{className:"md:flex md:space-y-0 space-y-5 justify-between mt-6 items-center",children:[s("div",{className:" flex items-center space-x-3 rtl:space-x-reverse",children:[t("select",{className:"form-control py-2 w-max",value:ve,onChange:e=>fe(Number(e.target.value)),children:[50,100,200].map(e=>s("option",{value:e,children:["Show ",e]},e))}),s("span",{className:"text-sm font-medium text-slate-600 dark:text-slate-300",children:["Page"," ",s("span",{children:[T+1," of ",E.length]})]})]}),s("ul",{className:"flex items-center  space-x-3  rtl:space-x-reverse",children:[t("li",{className:"text-xl leading-4 text-slate-900 dark:text-white rtl:rotate-180",children:t("button",{className:` ${S?"":"opacity-50 cursor-not-allowed"}`,onClick:()=>A(0),disabled:!S,children:t(W,{icon:"heroicons:chevron-double-left-solid"})})}),t("li",{className:"text-sm leading-4 text-slate-900 dark:text-white rtl:rotate-180",children:t("button",{className:` ${S?"":"opacity-50 cursor-not-allowed"}`,onClick:()=>me(),disabled:!S,children:"Prev"})}),E.map((e,a)=>t("li",{children:t("button",{href:"#","aria-current":"page",className:` ${a===T?"bg-slate-900 dark:bg-slate-600  dark:text-slate-200 text-white font-medium ":"bg-slate-100 dark:bg-slate-700 dark:text-slate-400 text-slate-900  font-normal  "}    text-sm rounded leading-[16px] flex h-6 w-6 items-center justify-center transition-all duration-150`,onClick:()=>A(a),children:e+1})},a)),t("li",{className:"text-sm leading-4 text-slate-900 dark:text-white rtl:rotate-180",children:t("button",{className:` ${k?"":"opacity-50 cursor-not-allowed"}`,onClick:()=>he(),disabled:!k,children:"Next"})}),t("li",{className:"text-xl leading-4 text-slate-900 dark:text-white rtl:rotate-180",children:t("button",{onClick:()=>A(ge-1),disabled:!k,className:` ${k?"":"opacity-50 cursor-not-allowed"}`,children:t(W,{icon:"heroicons:chevron-double-right-solid"})})})]})]})]})})})},Le=()=>t(m,{children:t("div",{className:" space-y-5",children:t(Pe,{title:"Booking Report"})})});export{Le as default};
