import{R as X,r as m,b as S,j as t,F as h,C as Z,ap as D}from"./index.f6951efa.js";import{D as k}from"./index.esm.893efb2c.js";import"./jspdf.es.min.10fe69e0.js";import"./html2canvas.esm.0eae2bf4.js";import{E as B}from"./excel.9601f4f9.js";import{E as ee}from"./exceljs.min.7de0bc2c.js";var r="D:\\srp\\Rare_Frontend\\src\\pages\\tenant-contract\\summary-reports\\ReportTable.jsx";const Q=X.forwardRef(({allBooking:e,propertyData:s},f)=>{const y=a=>{const{contractstartdate:n,contractenddate:l}=a;let N=new Date(n),P=new Date(l);return(P.getFullYear()-N.getFullYear())*12+(P.getMonth()-N.getMonth())+" Months"},p=[{Header:"Sr no",accessor:"id",Cell:({row:a,flatRows:n})=>t("span",{children:n.indexOf(a)+1},void 0,!1,{fileName:r,lineNumber:29,columnNumber:24},void 0)},{Header:"Tenancy contract No",accessor:"tenantcontractno",Cell:a=>{var n,l;return t("span",{children:(n=a==null?void 0:a.cell)!=null&&n.value?(l=a==null?void 0:a.cell)==null?void 0:l.value:"Not Available"},void 0,!1,{fileName:r,lineNumber:36,columnNumber:24},void 0)}},{Header:"Status",accessor:a=>`${a.contractenddate}`,Cell:a=>{var n,l;return t("span",{className:"block w-full",children:t("span",{className:` inline-block px-3 min-w-[90px] text-center mx-auto py-1 rounded-[999px] bg-opacity-25 ${new Date((n=a==null?void 0:a.cell)==null?void 0:n.value)>new Date?"text-success-500 bg-success-500":"text-danger-500 bg-danger-500"} `,children:new Date((l=a==null?void 0:a.cell)==null?void 0:l.value)>new Date?"Active":"Expired"},void 0,!1,{fileName:r,lineNumber:45,columnNumber:25},void 0)},void 0,!1,{fileName:r,lineNumber:44,columnNumber:21},void 0)}},{Header:"Tenancy Start Date",accessor:"contractstartdate",Cell:a=>{var n,l;return t("span",{children:(n=a==null?void 0:a.cell)!=null&&n.value?new Date((l=a==null?void 0:a.cell)==null?void 0:l.value).toDateString():"Not Available"},void 0,!1,{fileName:r,lineNumber:62,columnNumber:24},void 0)}},{Header:"Tenancy Expiry Date",accessor:"contractenddate",Cell:a=>{var n,l;return t("span",{children:(n=a==null?void 0:a.cell)!=null&&n.value?new Date((l=a==null?void 0:a.cell)==null?void 0:l.value).toDateString():"Not Available"},void 0,!1,{fileName:r,lineNumber:71,columnNumber:24},void 0)}},{Header:"Tenancy Period",accessor:"refund",Cell:a=>{const{original:n}=a.row;return console.log("original",n),t("span",{children:n?y(n):"Not Available"},void 0,!1,{fileName:r,lineNumber:80,columnNumber:24},void 0)}},{Header:"Rental Amount",accessor:"rentalamount",Cell:a=>{var n,l,N;return t("span",{children:(n=a==null?void 0:a.cell)!=null&&n.value?((N=Number((l=a==null?void 0:a.cell)==null?void 0:l.value))==null?void 0:N.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0}))+" AED":"Not Available"},void 0,!1,{fileName:r,lineNumber:87,columnNumber:24},void 0)}}],j=m.exports.useMemo(()=>p,[]),g=m.exports.useMemo(()=>e),E=S.exports.useTable({columns:j,data:g,initialState:{pageIndex:0,pageSize:50}},S.exports.useGlobalFilter,S.exports.useSortBy,S.exports.usePagination,S.exports.useRowSelect),{getTableProps:M,getTableBodyProps:w,headerGroups:L,footerGroups:_,page:v,nextPage:I,previousPage:V,canNextPage:G,canPreviousPage:b,pageOptions:Y,state:q,gotoPage:U,pageCount:W,setPageSize:O,setGlobalFilter:J,prepareRow:C}=E,[R,H]=m.exports.useState(0),[$,T]=m.exports.useState(0),[d,o]=m.exports.useState(0),[c,x]=m.exports.useState(0),[i,F]=m.exports.useState(0),[z,A]=m.exports.useState(0);return m.exports.useEffect(()=>{if(e!=null&&e.length){const a=e.map(n=>{const{rentalamount:l}=n;return Number(l)});H(a.reduce((n,l)=>n+l,0))}},[e==null?void 0:e.length]),m.exports.useEffect(()=>{if(e!=null&&e.length){const a=e.map(n=>{const{totalNonight:l}=n;return l});T(a.reduce((n,l)=>n+l,0))}},[e==null?void 0:e.length]),m.exports.useEffect(()=>{if(e!=null&&e.length){const a=e.map(l=>{const{Occupancy:N}=l;return N});let n=Math.round(a.reduce((l,N)=>l+N,0)/a.length);x(n)}},[e==null?void 0:e.length]),m.exports.useEffect(()=>{var a;if(e!=null&&e.length){let n=0;for(let l=0;l<(e==null?void 0:e.length);l++){let N=parseFloat((a=e[l])==null?void 0:a.totalNonight);n+=N}F(n||0)}},[e==null?void 0:e.length]),m.exports.useEffect(()=>{var a;if(e!=null&&e.length){let n=0;for(let l=0;l<(e==null?void 0:e.length);l++){let N=parseFloat((a=e[l])==null?void 0:a.averageCost);n+=N}A(n||0)}},[e==null?void 0:e.length]),m.exports.useEffect(()=>{var a;if(e!=null&&e.length){let n=0;for(let l=0;l<(e==null?void 0:e.length);l++){let N=parseFloat((a=e[l])==null?void 0:a.totalhostpayble);n+=N}o(n||0)}},[e==null?void 0:e.length]),t(h,{children:e&&(e==null?void 0:e.length)>0?t(h,{children:t("div",{ref:f,children:[t("div",{className:"mt-[25px]",children:[t("div",{className:"flex gap-x-[10px]",children:[t("p",{className:"font-semibold",children:"Landlord Name: "},void 0,!1,{fileName:r,lineNumber:238,columnNumber:25},void 0),t("p",{className:"capitalize",children:s!=null&&s.owner_name?s==null?void 0:s.owner_name:"Not Available"},void 0,!1,{fileName:r,lineNumber:239,columnNumber:25},void 0)]},void 0,!0,{fileName:r,lineNumber:237,columnNumber:21},void 0),t("div",{className:"flex gap-x-[10px]",children:[t("p",{className:"font-semibold",children:"Community Name: "},void 0,!1,{fileName:r,lineNumber:242,columnNumber:25},void 0),t("p",{className:"capitalize",children:s!=null&&s.communityname?s==null?void 0:s.communityname:"Not Available"},void 0,!1,{fileName:r,lineNumber:243,columnNumber:25},void 0)]},void 0,!0,{fileName:r,lineNumber:241,columnNumber:21},void 0),t("div",{className:"flex gap-x-[10px]",children:[t("p",{className:"font-semibold",children:"Project Name: "},void 0,!1,{fileName:r,lineNumber:246,columnNumber:25},void 0),t("p",{className:"capitalize",children:s!=null&&s.project_name?s==null?void 0:s.project_name:"Not Available"},void 0,!1,{fileName:r,lineNumber:247,columnNumber:25},void 0)]},void 0,!0,{fileName:r,lineNumber:245,columnNumber:21},void 0),t("div",{className:"flex gap-x-[10px]",children:[t("p",{className:"font-semibold",children:"Apartment No: "},void 0,!1,{fileName:r,lineNumber:250,columnNumber:25},void 0),t("p",{className:"capitalize",children:s!=null&&s.unitnumber?s==null?void 0:s.unitnumber:"Not Available"},void 0,!1,{fileName:r,lineNumber:251,columnNumber:25},void 0)]},void 0,!0,{fileName:r,lineNumber:249,columnNumber:21},void 0),t("div",{className:"flex gap-x-[10px]",children:[t("p",{className:"font-semibold",children:"Building No: "},void 0,!1,{fileName:r,lineNumber:254,columnNumber:25},void 0),t("p",{className:"capitalize",children:s!=null&&s.building_name?s==null?void 0:s.building_name:"Not Available"},void 0,!1,{fileName:r,lineNumber:255,columnNumber:25},void 0)]},void 0,!0,{fileName:r,lineNumber:253,columnNumber:21},void 0)]},void 0,!0,{fileName:r,lineNumber:236,columnNumber:17},void 0),t("div",{className:"overflow-x-auto -mx-6 mt-6",children:t("div",{className:"inline-block min-w-full align-middle",children:t("div",{className:"",children:t("table",{className:"min-w-[100%] overflow-x-scroll divide-y divide-slate-100 table-fixed dark:divide-slate-700",...M,children:[t("thead",{className:"bg-slate-200 dark:bg-slate-700",children:L.map(a=>t("tr",{...a.getHeaderGroupProps(),children:a.headers.map(n=>t("th",{...n.getHeaderProps(n.getSortByToggleProps()),scope:"col",className:"table-th",children:[n.render("Header"),t("span",{children:n.isSorted?n.isSortedDesc?" \u{1F53D}":" \u{1F53C}":""},void 0,!1,{fileName:r,lineNumber:276,columnNumber:57},void 0)]},void 0,!0,{fileName:r,lineNumber:270,columnNumber:53},void 0))},void 0,!1,{fileName:r,lineNumber:267,columnNumber:41},void 0))},void 0,!1,{fileName:r,lineNumber:265,columnNumber:33},void 0),t("tbody",{className:"bg-white divide-y divide-slate-100 dark:bg-slate-800 dark:divide-slate-700",...w,children:[v&&v.length>0&&v.map(a=>(C(a),t(h,{children:t("tr",{...a.getRowProps(),children:a.cells.map(n=>t("td",{...n.getCellProps(),className:"table-td",children:n.render("Cell")},void 0,!1,{fileName:r,lineNumber:297,columnNumber:61},void 0))},void 0,!1,{fileName:r,lineNumber:294,columnNumber:49},void 0)},void 0,!1))),t("tr",{className:"borderBottom",children:[t("td",{},void 0,!1,{fileName:r,lineNumber:307,columnNumber:41},void 0),t("td",{},void 0,!1,{fileName:r,lineNumber:308,columnNumber:41},void 0),t("td",{},void 0,!1,{fileName:r,lineNumber:309,columnNumber:41},void 0),t("td",{},void 0,!1,{fileName:r,lineNumber:310,columnNumber:41},void 0),t("td",{},void 0,!1,{fileName:r,lineNumber:311,columnNumber:41},void 0),t("td",{className:"font-semibold",children:"GROSS RENT INCOME"},void 0,!1,{fileName:r,lineNumber:312,columnNumber:41},void 0),t("td",{className:"table-td font-semibold",children:(R==null?void 0:R.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0}))+" AED"},void 0,!1,{fileName:r,lineNumber:313,columnNumber:41},void 0)]},void 0,!0,{fileName:r,lineNumber:306,columnNumber:37},void 0)]},void 0,!0,{fileName:r,lineNumber:285,columnNumber:33},void 0)]},void 0,!0,{fileName:r,lineNumber:261,columnNumber:29},void 0)},void 0,!1,{fileName:r,lineNumber:260,columnNumber:25},void 0)},void 0,!1,{fileName:r,lineNumber:259,columnNumber:21},void 0)},void 0,!1,{fileName:r,lineNumber:258,columnNumber:17},void 0)]},void 0,!0,{fileName:r,lineNumber:235,columnNumber:13},void 0)},void 0,!1):t("div",{className:"pl-2",children:t("h6",{className:" text-base text-slate-800 dark:text-slate-300 mb-[0.5rem] mt-[0.5rem]",children:"No Property Data Found"},void 0,!1,{fileName:r,lineNumber:420,columnNumber:13},void 0)},void 0,!1,{fileName:r,lineNumber:419,columnNumber:13},void 0)},void 0,!1)}),te="/assets/RARE-Logo-animate.7e47c055.gif";var u="D:\\srp\\Rare_Frontend\\src\\pages\\tenant-contract\\summary-reports\\TenancyReport.jsx";const ae={option:(e,s)=>({...e,fontSize:"14px"})},ce=()=>{var $,T;const[e,s]=m.exports.useState({propertyid:"",filteredDates:[]}),[f,y]=m.exports.useState([]),[p,j]=m.exports.useState(""),[g,E]=m.exports.useState(""),[M,w]=m.exports.useState(!1),[L,_]=m.exports.useState({filterData:[],propertyData:{}}),[v,I]=m.exports.useState([]),[V,G]=m.exports.useState(0),[b,Y]=m.exports.useState(""),q=d=>{const{contractstartdate:o,contractenddate:c}=d;let x=new Date(o),i=new Date(c);return(i.getFullYear()-x.getFullYear())*12+(i.getMonth()-x.getMonth())+" Months"};m.exports.useEffect(()=>{if(f!=null&&f.length){const d=f.map(o=>{const{rentalamount:c}=o;return Number(c)});G(d.reduce((o,c)=>o+c,0))}},[f==null?void 0:f.length]),m.exports.useEffect(()=>{fetch("http://dev-rare.srp.ai/property").then(d=>d.json()).then(d=>{const o=d==null?void 0:d.map(c=>({label:c.unitnumber+" | "+c.communityname+" | "+c.projectname+" | "+c.buildingname,value:c._id}));I(o)})},[]),m.exports.useEffect(()=>{(async()=>{if(e!=null&&e.propertyid){const c=await(await fetch(`http://dev-rare.srp.ai/property/${e==null?void 0:e.propertyid}`)).json();c&&Y(c)}})()},[e==null?void 0:e.propertyid]),m.exports.useEffect(()=>{(async()=>{const c=await(await fetch("http://dev-rare.srp.ai/booking")).json();j(c)})()},[]);const[U,W]=m.exports.useState({startDate:"",endDate:""}),O=m.exports.useRef(null),J=async()=>{const o=await(await fetch(`http://dev-rare.srp.ai/tenantcontract/tenantsummaryreport/${e.propertyid}`)).json();y(o.data),_(o==null?void 0:o.data),console.log("=============>",o)};m.exports.useEffect(()=>{if(p!=null&&p.length&&(e==null?void 0:e.propertyid)&&(e==null?void 0:e.startDate)&&(e==null?void 0:e.endDate)){const d=p.filter(o=>{let c=!0;return e.propertyid&&o.propertyid!==e.propertyid&&(c=!1),(o==null?void 0:o.checkindate)<(e==null?void 0:e.startDate)&&(o==null?void 0:o.checkindate)>(e==null?void 0:e.endDate)&&(c=!1),c});y(d)}J()},[e==null?void 0:e.propertyid,e==null?void 0:e.startDate,e==null?void 0:e.endDate,p]);const C=()=>{E(""),s({...e,filteredDates:[]}),W({startDate:null,endDate:null})},R=async d=>{if(console.log("newValue",d),w(!0),E(d),!d){s({...e,filteredDates:[]});return}const c=await(await fetch(`http://dev-rare.srp.ai/tenantcontract/report/${e.propertyid}?contractstartdate=${d.startDate}&contractenddate=${d.endDate}`)).json();w(!1),s({...e,filteredDates:c==null?void 0:c.data}),b.customername,b.communityname,b.projectname,b.unitnumber,b.buildingname,_({filterData:c==null?void 0:c.data,propertyData:b})},H=async d=>{console.log("Export button clicked",d);const{filterData:o,propertyData:c}=d,x=new ee.Workbook,i=x.addWorksheet("Sheet1");i.mergeCells("A1:F1"),i.addRow(["TENANCY REPORTS"]),i.addRow([]),i.addRow(["Landlord Name","Community Name","Project Name","Apartment No","Building No"]),i.columns=[{header:"Landlord Name",key:"customername",width:30},{header:"Community Name",key:"communityname",width:40},{header:"Project Name",key:"projectname",width:25},{header:"Apartment No",key:"unitnumber",width:25},{header:"Building No",key:"buildingname",width:25},{header:"",key:"nonight",width:20},{header:"",key:"roomrenthostpayable",width:55}];const F=[];F.push(c),F.map(l=>{i.addRow([l.customername,l.communityname,l.projectname,l.unitnumber,l.buildingname])}),i.addRow([]),i.addRow([]),i.addRow([]),i.addRow(["CONTRACT DETAILS"]),i.addRow([]),i.addRow(["Tenancy contract No","Tenant Name","Tenancy Start Date","Tenancy Expiry Date","Tenancy Period","RENTAL INCOME"]),i.addRow([]),o.forEach(l=>{i.addRow([l.tenantcontractno,l.guestname,new Date(l.contractstartdate).toDateString(),new Date(l.contractenddate).toDateString(),q(l),l.rentalamount])}),i.addRow([]),i.addRow([]);const z=o.map(l=>Number(l.rentalamount)).reduce((l,N)=>l+N,0),A=i.addRow(["GROSS RENT INCOME","","","",""," AED "+z.toLocaleString()]);if(z>5e3){const l={type:"pattern",pattern:"solid",fgColor:{argb:"808080"}};A.fill=l;const N={argb:"FFFFFF"};[A].forEach(P=>{P.eachCell({includeEmpty:!0},K=>{K.font={color:N}})})}i.addRow([]),i.addRow([]),i.addRow([]),i.addRow([]),i.addRow([]),i.addRow([]),i.addRow([]),i.addRow([]),i.getRow(2).font={bold:!0},i.getRow(2).fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},i.getRow(8).fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},i.getRow(4).fill={type:"pattern",pattern:"solid",fgColor:{argb:"808080"}},i.getRow(9).fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},i.getRow(11).fill={type:"pattern",pattern:"solid",fgColor:{argb:"808080"}},i.getRow(2).font={color:{argb:"FFFFFF"}},i.getRow(4).font={color:{argb:"FFFFFF"}},i.getRow(8).font={color:{argb:"FFFFFF"}},i.getRow(11).font={color:{argb:"FFFFFF"}},i.getRow(9).font={color:{argb:"FFFFFF"}};const n=await x.xlsx.writeBuffer();saveAs(new Blob([n]),"tenancy_Summery.xlsx")};return t(h,{children:t("div",{className:"xl:col-span-2 col-span-1",children:t(Z,{title:"Tenancy Summary",children:[t("div",{className:"flex flex-row-reverse",children:[e&&(($=e.filteredDates)==null?void 0:$.length)>0?t("button",{className:"h-[34px] rounded-[10px] relative bg-white border1px flex items-center gap-x-[10px] justify-around px-[10px] py-[5px] cursor-pointer",onClick:()=>H(L),children:[t("img",{src:B,alt:"Excel icon",className:"w-[20px] h-[20px] noselect"},void 0,!1,{fileName:u,lineNumber:376,columnNumber:5},void 0),t("p",{className:"text-[14px] leading regular color-black",children:"Export in Excel"},void 0,!1,{fileName:u,lineNumber:377,columnNumber:5},void 0)]},void 0,!0,{fileName:u,lineNumber:375,columnNumber:1},void 0):null,"                    "]},void 0,!0,{fileName:u,lineNumber:372,columnNumber:21},void 0),t("div",{children:[t("form",{className:"lg:grid-cols-3 grid gap-5 grid-cols-1 ",children:[t("div",{className:"w-[100%] col-span-3",children:t("h4",{className:"text-base text-slate-800 dark:text-slate-300 mb-[0.5rem] mt-[0.5rem]",children:"Select Property"},void 0,!1,{fileName:u,lineNumber:386,columnNumber:33},void 0)},void 0,!1,{fileName:u,lineNumber:385,columnNumber:29},void 0),t("div",{className:"w-[100%] col-span-3",children:t(D,{label:"Basic Select",className:"react-select",classNamePrefix:"select",options:v,value:v&&g?v.filter(function(d){return d.value===(e==null?void 0:e.propertyid)}):v.filter(function(d){return d.value===(e==null?void 0:e.propertyid)}),onChange:d=>{g?C():s({...e,propertyid:d==null?void 0:d.value})},styles:ae,id:"hh",placeholder:"Select and Search property"},void 0,!1,{fileName:u,lineNumber:394,columnNumber:33},void 0)},void 0,!1,{fileName:u,lineNumber:390,columnNumber:29},void 0)]},void 0,!0,{fileName:u,lineNumber:381,columnNumber:25},void 0),e.propertyid&&t(h,{children:t("div",{className:"flex justify-end mt-[25px]",children:[t("div",{className:"w-[150px]",children:t("div",{className:"date-range-custom relative",children:t(k,{value:U,inputClassName:"input-class",containerClassName:"container-class",onChange:R,placeholder:"SELECT DATE"},void 0,!1,{fileName:u,lineNumber:441,columnNumber:49},void 0)},void 0,!1,{fileName:u,lineNumber:440,columnNumber:45},void 0)},void 0,!1,{fileName:u,lineNumber:439,columnNumber:41},void 0),g&&t("div",{className:"flex justify-end",children:t("div",{className:"w-[90px]",children:t("div",{className:"date-range-custom relative",children:t("button",{className:"btn btn-dark text-white  text-center",type:"button",onClick:C,children:"Reset"},void 0,!1,{fileName:u,lineNumber:455,columnNumber:61},void 0)},void 0,!1,{fileName:u,lineNumber:454,columnNumber:57},void 0)},void 0,!1,{fileName:u,lineNumber:453,columnNumber:53},void 0)},void 0,!1,{fileName:u,lineNumber:452,columnNumber:49},void 0)]},void 0,!0,{fileName:u,lineNumber:438,columnNumber:37},void 0)},void 0,!1)]},void 0,!0,{fileName:u,lineNumber:380,columnNumber:21},void 0),M===!0?t(h,{children:t("div",{className:"flex items-center justify-center h-[100%]",children:t("img",{src:te,width:150,height:150},void 0,!1,{fileName:u,lineNumber:474,columnNumber:37},void 0)},void 0,!1,{fileName:u,lineNumber:473,columnNumber:33},void 0)},void 0,!1):(T=e==null?void 0:e.filteredDates)!=null&&T.length?t(h,{children:t(Q,{allBooking:e.filteredDates,propertyData:b,ref:O},void 0,!1,{fileName:u,lineNumber:480,columnNumber:37},void 0)},void 0,!1):t(h,{children:t(Q,{allBooking:f,propertyData:b,ref:O},void 0,!1,{fileName:u,lineNumber:485,columnNumber:37},void 0)},void 0,!1)]},void 0,!0,{fileName:u,lineNumber:371,columnNumber:17},void 0)},void 0,!1,{fileName:u,lineNumber:370,columnNumber:13},void 0)},void 0,!1)};export{ce as default};
