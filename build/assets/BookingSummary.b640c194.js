import{R as me,r as o,E as xe,b as H,j as s,F as v,c as p,f as be,aq as ge}from"./index.5707be80.js";import{D as ve}from"./index.esm.af8aa8cc.js";import"./jspdf.es.min.0e0bcdcb.js";import"./html2canvas.esm.0eae2bf4.js";import{E as Se}from"./exceljs.min.1836091f.js";import{E as ie}from"./excel.9601f4f9.js";const oe=me.forwardRef(({allBooking:e,propertyData:h,fetchDetails:a=!1},j)=>{const E=[{Header:"Sr no",accessor:"id",Cell:({row:t,flatRows:c})=>s("span",{children:c.indexOf(t)+1})},{Header:"MONTH / PERIOD",accessor:"TimePerid",Cell:t=>{var c,d,b,T;return a?s("button",{onClick:()=>{var l,n;return K(h._id,(l=t==null?void 0:t.cell)!=null&&l.value?(n=t==null?void 0:t.cell)==null?void 0:n.value:"")},children:(c=t==null?void 0:t.cell)!=null&&c.value?(d=t==null?void 0:t.cell)==null?void 0:d.value:"Not Available"}):s("span",{children:(b=t==null?void 0:t.cell)!=null&&b.value?(T=t==null?void 0:t.cell)==null?void 0:T.value:"Not Available"})}},{Header:"TOTAL AVAILABLE NUMBER OF NIGHTS / MONTH",accessor:"TotalDaysinMonth",Cell:t=>{var c,d;return s("span",{children:(c=t==null?void 0:t.cell)!=null&&c.value?(d=t==null?void 0:t.cell)==null?void 0:d.value:"Not Available"})}},{Header:"NO OF NIGHTS BOOKED",accessor:"No_of_Booked_Nights",Cell:t=>{var c,d;return s("span",{children:(c=t==null?void 0:t.cell)!=null&&c.value?(d=t==null?void 0:t.cell)==null?void 0:d.value:"Not Available"})}},{Header:"AVERAGE RATE PER NIGHT",accessor:"AveragePerNight",Cell:t=>{var c,d;return p("span",{className:"text-[12px]",children:[s("strong",{children:"AED"})," ",(c=t==null?void 0:t.cell)!=null&&c.value?Number((d=t==null?void 0:t.cell)==null?void 0:d.value).toFixed(2):"Not Available"]})}},{Header:"OCCUPANCY RATE",accessor:"OccpancyRate",Cell:t=>{var c,d;return s("span",{children:(c=t==null?void 0:t.cell)!=null&&c.value?Math.round(Number((d=t==null?void 0:t.cell)==null?void 0:d.value).toFixed(2))+" %":"Not Available"})}},{Header:"REFUND /CANCELLATION",accessor:"refund",Cell:t=>{var c,d;return s("span",{children:(c=t==null?void 0:t.cell)!=null&&c.value?(d=t==null?void 0:t.cell)==null?void 0:d.value:"Not Available"})}},{Header:"TOTAL BOOKING AMOUNT",accessor:"TotalHostPayable",Cell:t=>{var c,d;return p("span",{className:"text-[12px]",children:[s("strong",{children:"AED"})," ",(c=t==null?void 0:t.cell)!=null&&c.value?Number((d=t==null?void 0:t.cell)==null?void 0:d.value).toFixed(2):"Not Available"]})}}],D=o.exports.useMemo(()=>E,[]),R=o.exports.useMemo(()=>e),I=xe(),y=H.exports.useTable({columns:D,data:R,initialState:{pageIndex:0,pageSize:50}},H.exports.useGlobalFilter,H.exports.useSortBy,H.exports.usePagination,H.exports.useRowSelect),{getTableProps:V,getTableBodyProps:N,headerGroups:P,footerGroups:he,page:_,nextPage:W,previousPage:Q,canNextPage:Y,canPreviousPage:G,pageOptions:X,state:Z,gotoPage:$,pageCount:ue,setPageSize:pe,setGlobalFilter:w,prepareRow:k}=y,[O,B]=o.exports.useState(0),[C,ee]=o.exports.useState(0),[L,te]=o.exports.useState(0),[M,se]=o.exports.useState(0),[ae,ce]=o.exports.useState(0),[ne,J]=o.exports.useState(0),[le,U]=o.exports.useState(0);o.exports.useEffect(()=>{if(e!=null&&e.length){const t=e.map(c=>{const{TotalDaysinMonth:d}=c;return d});B(t.reduce((c,d)=>c+d,0))}},[e==null?void 0:e.length]),o.exports.useEffect(()=>{if(e!=null&&e.length){const t=e.map(c=>{const{No_of_Booked_Nights:d}=c;return d});ee(t.reduce((c,d)=>c+d,0))}},[e==null?void 0:e.length]),o.exports.useEffect(()=>{if(e!=null&&e.length){const t=e.map(d=>{const{OccpancyRate:b}=d;return b});let c=Math.round(t.reduce((d,b)=>d+Number(b),0)/t.length);se(c)}},[e==null?void 0:e.length]),o.exports.useEffect(()=>{var t;if(e!=null&&e.length){let c=0;for(let d=0;d<(e==null?void 0:e.length);d++){let b=parseFloat((t=e[d])==null?void 0:t.totalNonight);c+=b}ce(c||0)}},[e==null?void 0:e.length]),o.exports.useEffect(()=>{var t;totalbookednights/totalnightsData,J(Number((t=e[i])==null?void 0:t.AveragePerNight).toFixed(2))},[e==null?void 0:e.length]),o.exports.useEffect(()=>{var t;if(e!=null&&e.length){let c=0;for(let d=0;d<(e==null?void 0:e.length);d++){let b=Number((t=e[d])==null?void 0:t.TotalHostPayable);c+=b}te(c||0)}},[e==null?void 0:e.length]),o.exports.useEffect(()=>{h._id&&U(h._id)},[h._id]);function K(t,c){let d=new Date(c);if(t){let b=new Date(d.getFullYear(),d.getMonth(),1).toJSON().split("T")[0],T=new Date(d.getFullYear(),d.getMonth()+1,0).toJSON().split("T")[0],l=`/booking-reports?startDate=${b}&endDate=${T}&propertyId=${t}`;I(l)}}return s(v,{children:e&&e.length>0?s(v,{children:p("div",{ref:j,children:[p("div",{className:"mt-[25px]",children:[p("div",{className:"flex gap-x-[10px]",children:[s("p",{className:"font-semibold",children:"Landlord Name: "}),s("p",{className:"capitalize",children:h!=null&&h.owner_name?h==null?void 0:h.owner_name:"Not Available"})]}),p("div",{className:"flex gap-x-[10px]",children:[s("p",{className:"font-semibold",children:"Community Name: "}),s("p",{className:"capitalize",children:h.community_name?h.community_name:h!=null&&h.communityname?h==null?void 0:h.communityname:"Not Available"})]}),p("div",{className:"flex gap-x-[10px]",children:[s("p",{className:"font-semibold",children:"Project Name: "}),s("p",{className:"capitalize",children:h!=null&&h.project_name?h==null?void 0:h.project_name:"Not Available"})]}),p("div",{className:"flex gap-x-[10px]",children:[s("p",{className:"font-semibold",children:"Apartment No: "}),s("p",{className:"capitalize",children:h!=null&&h.unitnumber?h==null?void 0:h.unitnumber:"Not Available"})]}),p("div",{className:"flex gap-x-[10px]",children:[s("p",{className:"font-semibold",children:"Building No: "}),s("p",{className:"capitalize",children:h!=null&&h.building_name?h==null?void 0:h.building_name:"Not Available"})]})]}),s("div",{className:"overflow-x-auto -mx-6 mt-6",children:s("div",{className:"inline-block min-w-full align-middle",children:s("div",{className:"",children:p("table",{className:"min-w-[100%] overflow-x-scroll divide-y divide-slate-100 table-fixed dark:divide-slate-700",...V,children:[s("thead",{className:"bg-slate-200 dark:bg-slate-700",children:P.map(t=>s("tr",{...t.getHeaderGroupProps(),children:t.headers.map(c=>p("th",{...c.getHeaderProps(c.getSortByToggleProps()),scope:"col",className:"table-th",children:[c.render("Header"),s("span",{children:c.isSorted?c.isSortedDesc?" \u{1F53D}":" \u{1F53C}":""})]}))}))}),p("tbody",{className:"bg-white divide-y divide-slate-100 dark:bg-slate-800 dark:divide-slate-700",...N,children:[_&&_.length>0&&_.map(t=>(k(t),s(v,{children:s("tr",{...t.getRowProps(),children:t.cells.map(c=>s("td",{...c.getCellProps(),className:"table-td",children:c.render("Cell")}))})}))),p("tr",{children:[s("td",{}),s("td",{className:"font-semibold",children:"TOTAL"}),p("td",{className:"table-td font-semibold",children:[O==null?void 0:O.toLocaleString()," Available Nights"]}),p("td",{className:"table-td font-semibold",children:[C==null?void 0:C.toLocaleString()," Booked Nights"]}),p("td",{className:"table-td font-semibold",children:["AED ",Number(totalbookednights/totalnightsData).toFixed(2)]}),p("td",{className:"table-td font-semibold",children:[M==null?void 0:M.toLocaleString()," %"]}),s("td",{}),p("td",{className:"table-td font-semibold",children:["AED ",L==null?void 0:L.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),s("td",{})]})]})]})})})})]})}):s(v,{children:s("h6",{className:"text-base text-slate-800 dark:text-slate-300 mb-[0.5rem] mt-[0.5rem]",children:"No Property Data Found"})})})}),Ae={option:(e,h)=>({...e,fontSize:"14px"})},Ee=()=>{var b,T;const[e,h]=o.exports.useState({propertyid:"",filteredDates:[]}),[a,j]=o.exports.useState([]),[E,D]=o.exports.useState(""),[R,I]=o.exports.useState(""),[y,V]=o.exports.useState([]),[N,P]=o.exports.useState(""),[he,_]=o.exports.useState(""),[W,Q]=o.exports.useState({}),[Y,G]=o.exports.useState({PropertyData:{},filteredData:[]}),[X,Z]=o.exports.useState({PropertyData:{},filteredData:[]}),[$,ue]=o.exports.useState([]),[pe,w]=o.exports.useState(""),[k,O]=o.exports.useState(0),[B,C]=o.exports.useState(0),[ee,L]=o.exports.useState(0),[te,M]=o.exports.useState(0),[se,ae]=o.exports.useState(0),[ce,ne]=o.exports.useState(0);o.exports.useEffect(()=>{if(a!=null&&a.length){const l=a.map(n=>{const{TotalDaysinMonth:r}=n;return r});console.log("days"),O(l.reduce((n,r)=>n+r,0))}},[a==null?void 0:a.length]),o.exports.useEffect(()=>{if(a!=null&&a.length){const l=a.map(n=>{const{No_of_Booked_Nights:r}=n;return r});C(l.reduce((n,r)=>n+r,0))}},[a==null?void 0:a.length]),o.exports.useEffect(()=>{if(a!=null&&a.length){const l=a.map(r=>{const{OccpancyRate:u}=r;return u});let n=Math.round(l.reduce((r,u)=>r+Number(u),0)/l.length);M(n)}},[a==null?void 0:a.length]),o.exports.useEffect(()=>{var l;if(a!=null&&a.length){let n=0;for(let r=0;r<(a==null?void 0:a.length);r++){let u=parseFloat((l=a[r])==null?void 0:l.totalNonight);n+=u}ae(n||0)}},[a==null?void 0:a.length]),o.exports.useEffect(()=>{var l;if(a!=null&&a.length){let n=0;for(let r=0;r<(a==null?void 0:a.length);r++){let u=Number((l=a[r])==null?void 0:l.AveragePerNight);n+=u}ne(n||0)}},[a==null?void 0:a.length]),o.exports.useEffect(()=>{var l;if(a!=null&&a.length){let n=0;for(let r=0;r<(a==null?void 0:a.length);r++){let u=Number((l=a[r])==null?void 0:l.TotalHostPayable);n+=u}console.log("totalbookednights",n),L(n||0)}},[a==null?void 0:a.length]),o.exports.useEffect(()=>{fetch("http://portals.rarehomesgroup.com/property").then(l=>l.json()).then(l=>{const n=l==null?void 0:l.map(r=>({label:r.unitnumber+" | "+r.communityname+" | "+r.projectname+" | "+r.buildingname,value:r._id}));V(n)})},[]),o.exports.useEffect(()=>{(async()=>{if(e!=null&&e.propertyid){w(e.propertyid);const r=await(await fetch(`http://portals.rarehomesgroup.com/property/${e==null?void 0:e.propertyid}`)).json();G($==null?void 0:$.data),r&&P(r)}})()},[e==null?void 0:e.propertyid]),o.exports.useEffect(()=>{(async()=>{if(e!=null&&e.propertyid){let n=`http://portals.rarehomesgroup.com/booking/summarybyDates/${e==null?void 0:e.propertyid}`;newValue&&(newValue==null?void 0:newValue.startDate)&&(newValue==null?void 0:newValue.endDate)&&(n+=`?fromdate=${newValue.startDate}&todate=${newValue.endDate}`);const u=await(await fetch(n)).json();G(u==null?void 0:u.data),D(u==null?void 0:u.data)}})()},[]);const[J,le]=o.exports.useState({startDate:"",endDate:""}),U=o.exports.useRef(null),K=async()=>{if(e!=null&&e.propertyid){let l=new Date().toISOString(),n=new Date(l).getFullYear(),r=new Date(l).getMonth(),u=new Date(n,r+1,0).toJSON().split("T")[0],S=new Date(n,new Date(l).getMonth()-5,1).toJSON().split("T")[0],f=`http://portals.rarehomesgroup.com/booking/summarybyDates/${e==null?void 0:e.propertyid}`;S&&u&&(f+=`?fromdate=${S}&todate=${u}`);const A=await(await fetch(f)).json();j(A.data?A.data:[]);const z={owner_name:N==null?void 0:N.owner_name,building_name:N==null?void 0:N.building_name,community_name:N==null?void 0:N.communityname,project_name:N==null?void 0:N.project_name,unitnumber:N==null?void 0:N.unitnumber};G({filteredData:A==null?void 0:A.data,PropertyData:z})}};o.exports.useEffect(()=>{if(E!=null&&E.length&&(e==null?void 0:e.propertyid)&&(e==null?void 0:e.startDate)&&(e==null?void 0:e.endDate)){const l=E.filter(n=>{let r=!0;return e.propertyid&&n.propertyid!==e.propertyid&&(r=!1),(n==null?void 0:n.checkindate)<(e==null?void 0:e.startDate)&&(n==null?void 0:n.checkindate)>(e==null?void 0:e.endDate)&&(r=!1),r});j(l)}K()},[e==null?void 0:e.propertyid,e==null?void 0:e.startDate,e==null?void 0:e.endDate,E,Y]);const t=()=>{I(""),h({...e,filteredDates:[]}),le({startDate:null,endDate:null})},c=async l=>{if(P(!0),I(l),!l){h({...e,filteredDates:[]});return}const r=await(await fetch(`http://portals.rarehomesgroup.com/booking/summarybyDates/${e==null?void 0:e.propertyid}?fromdate=${l.startDate}&todate=${l.endDate}`)).json();P(!1);let u=N;h({...e,filteredDates:r==null?void 0:r.data});const S={owner_name:u.owner_name,building_name:u.building_name,community_name:u.communityname,project_name:u.project_name,unitnumber:u.unitnumber};Q(S),_(S),Z({filteredData:r==null?void 0:r.data,PropertyData:S})};function d(l){var A,z,re,de;const{filteredData:n,PropertyData:r}=l;let u=[];u.push(r),console.log("122222",u,n);const S=new Se.Workbook,f=S.addWorksheet("CombinedSheet");f.mergeCells("A1:W1"),f.addRow(["BOOKING SUMMARY"]),f.columns=[{header:"Landlord Name",key:"owner_name",width:30},{header:"Community Name",key:"community_name",width:40},{header:"Project Name",key:"project_name",width:25},{header:"Apartment No",key:"unitnumber",width:25},{header:"Building No",key:"building_name",width:25},{header:"",key:"",width:20},{header:"",key:"",width:55},{header:"",key:"",width:55}],u&&(console.log("PropertyData",r),[["Landlord Name","Community Name","Project Name","Apartment No","Building No"],...u.map(g=>[g.owner_name,g.community_name,g.project_name,g.unitnumber,g.building_name])].forEach(g=>{f.addRow(g)}),f.addRow([]),f.addRow([]));const q=f.addRow(["MONTH / PERIOD","TOTAL AVAILABLE NUMBER OF NIGHTS / MONTH","NO OF NIGHTS BOOKED","AVERAGE RATE PER NIGHT","OCCUPANCY RATE","REFUND /CANCELLATION","TOTAL BOOKING AMOUNT"]);if(n){n.forEach(m=>{f.addRow([m==null?void 0:m.TimePerid,m==null?void 0:m.TotalDaysinMonth,m==null?void 0:m.No_of_Booked_Nights,Number(m==null?void 0:m.AveragePerNight).toFixed(2),Math.round(Number(m==null?void 0:m.OccpancyRate).toFixed(0))+"%","NOT AVAILABLE",m==null?void 0:m.TotalHostPayable])}),f.addRow([]);const F=n.map(m=>Number(m.AveragePerNight)).reduce((m,x)=>m+x,0),g=f.addRow(["TOTAL",((A=n.map(m=>Number(m.TotalDaysinMonth)).reduce((m,x)=>m+x,0))==null?void 0:A.toLocaleString())+" Available Nights",((z=n.map(m=>Number(m.No_of_Booked_Nights)).reduce((m,x)=>m+x,0))==null?void 0:z.toLocaleString())+"  Booked Nights","AED "+(F==null?void 0:F.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})),Math.round(Number(n.map(m=>Number(m.OccpancyRate)).reduce((m,x)=>m+x,0)/n.length).toFixed(0))+"%","","AED "+((de=(re=n.map(m=>Number(m.TotalHostPayable)).reduce((m,x)=>m+x,0))==null?void 0:re.toLocaleString())==null?void 0:de.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))]);{const m={type:"pattern",pattern:"solid",fgColor:{argb:"808080"}};g.fill=m,q.fill=m;const x={argb:"FFFFFF"};[g,q].forEach(fe=>{fe.eachCell({includeEmpty:!0},Ne=>{Ne.font={color:x}})})}}f.getRow(2).font={bold:!0},f.getRow(2).fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},f.getRow(3).fill={type:"pattern",pattern:"solid",fgColor:{argb:"808080"}},f.getRow(7).fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},f.getRow(2).font={color:{argb:"FFFFFF"}},f.getRow(3).font={color:{argb:"FFFFFF"}},f.getRow(7).font={color:{argb:"FFFFFF"}},f.getRow(7).alignment={horizontal:"center"},S.xlsx.writeBuffer().then(F=>{const g=new Blob([F],{type:"application/octet-stream"}),m=URL.createObjectURL(g),x=document.createElement("a");x.href=m,x.download="booking-"+new Date+".xlsx",document.body.appendChild(x),x.click(),document.body.removeChild(x)})}return s(v,{children:s("div",{className:"xl:col-span-2 col-span-1",children:p(be,{title:"Booking Summary",children:[e.propertyid?(e==null?void 0:e.filteredDates)&&((b=e==null?void 0:e.filteredDates)==null?void 0:b.length)?s(v,{children:s("div",{className:"flex flex-row-reverse",children:p("button",{className:"h-[34px] rounded-[10px] relative bg-white border1px flex items-center gap-x-[10px] justify-around px-[10px] py-[5px] cursor-pointer",onClick:()=>d(X),children:[s("img",{src:ie,alt:"Excel icon",className:"w-[20px] h-[20px] noselect"}),s("p",{className:"text-[14px] leading regular color-black",children:"Export in Excel"})]})})}):s(v,{children:s("div",{className:"flex flex-row-reverse",children:p("button",{className:"h-[34px] rounded-[10px] relative bg-white border1px flex items-center gap-x-[10px] justify-around px-[10px] py-[5px] cursor-pointer",onClick:()=>d(Y),children:[s("img",{src:ie,alt:"Excel icon",className:"w-[20px] h-[20px] noselect"}),s("p",{className:"text-[14px] leading regular color-black",children:"Export in Excel"})]})})}):null,p("div",{children:[p("form",{className:"lg:grid-cols-3 grid gap-5 grid-cols-1 ",children:[s("div",{className:"w-[100%] col-span-3",children:s("h4",{className:"text-base text-slate-800 dark:text-slate-300 mb-[0.5rem] mt-[0.5rem]",children:"Select Property"})}),s("div",{className:"w-[100%] col-span-3",children:s(ge,{label:"Basic Select",className:"react-select",classNamePrefix:"select",options:y,value:y&&R?y.filter(function(l){return l.value===(e==null?void 0:e.propertyid)}):y.filter(function(l){return l.value===(e==null?void 0:e.propertyid)}),onChange:l=>{R?t():h({...e,propertyid:l==null?void 0:l.value})},styles:Ae,id:"hh",placeholder:"Select and Search property"})})]}),e.propertyid&&s(v,{children:p("div",{className:"flex justify-end mt-[25px]",children:[s("div",{className:"w-[150px]",children:s("div",{className:"date-range-custom relative",children:s(ve,{value:J,inputClassName:"input-class",containerClassName:"container-class",onChange:c,placeholder:"SELECT DATE"})})}),R&&s("div",{className:"flex justify-end",children:s("div",{className:"w-[90px]",children:s("div",{className:"date-range-custom relative",children:s("button",{className:"btn btn-dark text-white  text-center",type:"button",onClick:t,children:"Reset"})})})})]})})]}),(T=e.filteredDates)!=null&&T.length?s(v,{children:s(oe,{allBooking:e.filteredDates,propertyData:W,ref:U,fetchDetails:!0})}):s(v,{children:N?s(oe,{allBooking:a,propertyData:N,ref:U,fetchDetails:!0}):""})]})})})},Oe=me.memo(Ee);export{Oe as default};
