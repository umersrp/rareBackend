import{R as D,r,j as a,F as x,b as o,cw as B,cx as w,C as ee,an as te,cq as ae}from"./index.50bb4499.js";import{D as le}from"./index.esm.422148a5.js";import"./jspdf.es.min.e78e7abc.js";import"./html2canvas.esm.0eae2bf4.js";import{L as se}from"./Rare logo New Gif Loading.02c4dc82.js";import{r as S}from"./index.c0e2c666.js";import{E as ne}from"./exceljs.min.5c169413.js";import{E as ie}from"./excel.9601f4f9.js";const ce=D.forwardRef(({allBooking:t,propertyData:s,loadingPropertyforData:y},F)=>{const g=[{Header:"Sr no",accessor:"id",Cell:({row:e,flatRows:l})=>a("span",{children:l.indexOf(e)+1})},{Header:"Guest Name",accessor:"guestname",Cell:e=>{var l,i;return a("div",{children:a("span",{className:"inline-flex items-center",children:a("span",{className:"text-sm text-slate-600 dark:text-slate-300",children:(l=e==null?void 0:e.cell)!=null&&l.value?(i=e==null?void 0:e.cell)==null?void 0:i.value:"Not Available"})})})}},{Header:"Booking Date",accessor:"reservation_date",Cell:e=>{var l,i;return a("span",{children:(l=e==null?void 0:e.cell)!=null&&l.value?new Date((i=e==null?void 0:e.cell)==null?void 0:i.value).toDateString():"Not Available"})}},{Header:"Confirmation Code",accessor:"confirmationcode",Cell:e=>{var l,i;return a("span",{children:(l=e==null?void 0:e.cell)!=null&&l.value?(i=e==null?void 0:e.cell)==null?void 0:i.value:"Not Available"})}},{Header:"Check in Date",accessor:"checkindate",Cell:e=>{var l,i;return a("span",{children:(l=e==null?void 0:e.cell)!=null&&l.value?(i=e==null?void 0:e.cell)==null?void 0:i.value:"Not Available"})},sortType:(e,l,i,h)=>B(e,l,i,h)},{Header:"Check out Date",accessor:"checkoutdate",Cell:e=>{var l,i;return a("span",{children:(l=e==null?void 0:e.cell)!=null&&l.value?(i=e==null?void 0:e.cell)==null?void 0:i.value:"Not Available"})},sortType:(e,l,i,h)=>w(e,l,i,h)},{Header:"NO OF NIGHTS STAYED",accessor:"nonight",Cell:e=>{var l,i;return a("span",{children:(l=e==null?void 0:e.cell)!=null&&l.value?(i=e==null?void 0:e.cell)==null?void 0:i.value:"0.00"})}},{Header:"RATE PER NIGHT",accessor:"tourismfee",Cell:e=>{var E,$,U,K,q,W,Y,J,V,Q,X,Z;let l=(U=($=(E=e==null?void 0:e.cell)==null?void 0:E.row)==null?void 0:$.original)!=null&&U.nonight?parseFloat((W=(q=(K=e==null?void 0:e.cell)==null?void 0:K.row)==null?void 0:q.original)==null?void 0:W.nonight):0,h=((V=(J=(Y=e==null?void 0:e.cell)==null?void 0:Y.row)==null?void 0:J.original)!=null&&V.roomrenthostpayable?parseFloat((Z=(X=(Q=e==null?void 0:e.cell)==null?void 0:Q.row)==null?void 0:X.original)==null?void 0:Z.roomrenthostpayable):0)/l;return a("span",{children:h?parseFloat(h).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})+" AED":"0.00"})}},{Header:"BOOKING AMOUNT",accessor:"roomrenthostpayable",Cell:e=>{var l,i;return a("span",{children:(l=e==null?void 0:e.cell)!=null&&l.value?parseFloat((i=e==null?void 0:e.cell)==null?void 0:i.value).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})+" AED":"0.00"})}}],P=r.exports.useMemo(()=>g,[]),b=r.exports.useMemo(()=>t),C=S.exports.useTable({columns:P,data:b,initialState:{pageIndex:0,pageSize:50}},S.exports.useGlobalFilter,S.exports.useSortBy,S.exports.usePagination,S.exports.useRowSelect),{getTableProps:v,getTableBodyProps:R,headerGroups:u,footerGroups:k,page:N,nextPage:T,previousPage:H,canNextPage:O,canPreviousPage:L,pageOptions:G,state:I,gotoPage:z,pageCount:_,setPageSize:M,setGlobalFilter:j,prepareRow:A}=C,[n,m]=r.exports.useState(0),[c,p]=r.exports.useState(0),[f,d]=r.exports.useState(0);return r.exports.useEffect(()=>{var e;if(t!=null&&t.length){let l=0;for(let i=0;i<(t==null?void 0:t.length);i++){let h=parseFloat((e=t[i])==null?void 0:e.nonight);l+=h}m(l||0)}},[t==null?void 0:t.length]),r.exports.useEffect(()=>{if(t!=null&&t.length){let i=t.filter(h=>h.roomrenthostpayable!==void 0?h.roomrenthostpayable:null).map(h=>Number(h.roomrenthostpayable)).reduce((h,E)=>h+E,0);console.log("mmmmmmmmmmmm333",i),p(i.toFixed(2))}},[t==null?void 0:t.length]),r.exports.useEffect(()=>{if(n&&c){let e=c/n;d(e)}},[n,c]),a(x,{children:o("div",{ref:F,children:[o("div",{className:"mt-[25px]",children:[o("div",{className:"flex gap-x-[10px]",children:[a("p",{className:"font-semibold",children:"Landlord Name: "}),a("p",{className:"capitalize",children:s!=null&&s.owner_name?s==null?void 0:s.owner_name:"Not Available"})]}),o("div",{className:"flex gap-x-[10px]",children:[a("p",{className:"font-semibold",children:"Community Name: "}),a("p",{className:"capitalize",children:s!=null&&s.communityname?s==null?void 0:s.communityname:"Not Available"})]}),o("div",{className:"flex gap-x-[10px]",children:[a("p",{className:"font-semibold",children:"Project Name: "}),a("p",{className:"capitalize",children:s!=null&&s.project_name?s==null?void 0:s.project_name:"Not Available"})]}),o("div",{className:"flex gap-x-[10px]",children:[a("p",{className:"font-semibold",children:"Apartment No: "}),a("p",{className:"capitalize",children:s!=null&&s.unitnumber?s==null?void 0:s.unitnumber:"Not Available"})]}),o("div",{className:"flex gap-x-[10px]",children:[a("p",{className:"font-semibold",children:"Building No: "}),a("p",{className:"capitalize",children:s!=null&&s.building_name?s==null?void 0:s.building_name:"Not Available"})]})]}),a("div",{className:"overflow-x-auto -mx-6 mt-6",children:a("div",{className:"inline-block min-w-full align-middle",children:a("div",{className:"",children:o("table",{className:"min-w-[100%] overflow-x-scroll divide-y divide-slate-100 table-fixed dark:divide-slate-700",...v,children:[a("thead",{className:"bg-slate-200 dark:bg-slate-700",children:u.map(e=>a("tr",{...e.getHeaderGroupProps(),children:e.headers.map(l=>o("th",{...l.getHeaderProps(l.getSortByToggleProps()),scope:"col",className:"table-th",children:[l.render("Header"),a("span",{children:l.isSorted?l.isSortedDesc?" \u{1F53D}":" \u{1F53C}":""})]}))}))}),o("tbody",{className:"bg-white divide-y divide-slate-100 dark:bg-slate-800 dark:divide-slate-700",...R,children:[N&&N.length>0&&N.map(e=>(A(e),a(x,{children:a("tr",{...e.getRowProps(),children:e.cells.map(l=>a("td",{...l.getCellProps(),className:"table-td",children:l.render("Cell")}))})}))),o("tr",{children:[a("td",{}),a("td",{}),a("td",{}),a("td",{}),a("td",{}),a("td",{className:"font-semibold",children:"TOTAL"}),a("td",{className:"table-td font-semibold",children:(n==null?void 0:n.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))+" Nights"}),a("td",{className:"table-td font-semibold",children:(f==null?void 0:f.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))+" AED"}),a("td",{className:"table-td font-semibold",children:(c==null?void 0:c.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))+" AED"})]})]})]})})})})]})})}),re={option:(t,s)=>({...t,fontSize:"14px"})},ge=()=>{var j,A;const[t,s]=r.exports.useState({propertyid:"",filteredDates:[]}),[y,F]=r.exports.useState([]),[g,P]=r.exports.useState(""),[b,C]=r.exports.useState(""),[v,R]=r.exports.useState([]),[u,k]=r.exports.useState(""),[N,T]=r.exports.useState(!1),[H,O]=r.exports.useState({filteredData:[],PropertyData:{}});function L(n){const{filteredData:m,PropertyData:c}=n;let p=[];p.push(c);const f=new ne.Workbook,d=f.addWorksheet("Sheet1");d.mergeCells("A1:F1"),d.addRow(["BOOKING REPORTS"]),d.columns=[{header:"Landlord Name",key:"",width:30},{header:"Community Name",key:"",width:40},{header:"Project Name",key:"",width:25},{header:"Apartment No",key:"",width:25},{header:"Building No",key:"",width:25},{header:"",key:"",width:25}],p&&([["Landlord Name","Community Name","Project Name","Apartment No","Building No"],...p.map(l=>[l.owner_name,l.community_name,l.project_name,l.unitnumber,l.building_name])].forEach(l=>{d.addRow(l)}),d.addRow([]),d.addRow([]),d.addRow([]),d.addRow([])),d.addRow(["GUEST NAME","BOOKING DATE","CONFIRMATION CODE","CHECK IN DATE","CHECK OUT DATE","NO OF NIGHTS STAYED","BOOKING AMOUNT"]),m.forEach(e=>{d.addRow([e.guestname,e.Created_At,e.confirmationcode,e.checkin_date,e.checkout_date,e.nonight,Number(e.roomrenthostpayable).toFixed(2)])}),d.getRow(2).font={color:{argb:"FFFFFF"}},d.getRow(2).fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},d.getRow(3).fill={type:"pattern",pattern:"solid",fgColor:{argb:"808080"}},d.getRow(9).fill={type:"pattern",pattern:"solid",fgColor:{argb:"808080"}},d.getRow(3).font={color:{argb:"FFFFFF"}},d.getRow(9).font={color:{argb:"FFFFFF"}},f.xlsx.writeBuffer().then(e=>{ae.exports.saveAs(new Blob([e],{type:"application/octet-stream"}),"bookings.xlsx")})}r.exports.useEffect(()=>{fetch("http://dev-rare.srp.ai/property").then(n=>n.json()).then(n=>{const m=n==null?void 0:n.map(c=>({label:c.unitnumber+" | "+c.communityname+" | "+c.projectname+" | "+c.buildingname,value:c._id}));R(m)})},[]),r.exports.useEffect(()=>{(async()=>{if(t!=null&&t.propertyid){const c=await(await fetch(`http://dev-rare.srp.ai/property/${t==null?void 0:t.propertyid}`)).json();c&&k(c)}})()},[t==null?void 0:t.propertyid]),r.exports.useEffect(()=>{(async()=>{const c=await(await fetch(`http://dev-rare.srp.ai/booking/api/reservationdate?propertyid=${t==null?void 0:t.propertyid}&checkindate=${newValue.startDate}&checkindate=${newValue.endDate}`)).json();O(c==null?void 0:c.data),P(c==null?void 0:c.data)})()},[]);const[G,I]=r.exports.useState({startDate:"",endDate:""}),z=r.exports.useRef(null);r.exports.useEffect(()=>{if(g!=null&&g.length&&(t==null?void 0:t.propertyid)&&(t==null?void 0:t.startDate)&&(t==null?void 0:t.endDate)){const n=g.filter(m=>{let c=!0;return t.propertyid&&m.propertyid!==t.propertyid&&(c=!1),(m==null?void 0:m.checkindate)<(t==null?void 0:t.startDate)&&(m==null?void 0:m.checkindate)>(t==null?void 0:t.endDate)&&(c=!1),c});F(n)}},[t==null?void 0:t.propertyid,t==null?void 0:t.startDate,t==null?void 0:t.endDate,g]),console.log(t,"setUserData"),console.log(y,"allBooking");const _=()=>{C(""),s({...t,filteredDates:[]}),I({startDate:null,endDate:null})},M=async n=>{if(T(!0),console.log("newValue",n),C(n),!n){s({...t,filteredDates:[]});return}const p=(await(await fetch(`http://dev-rare.srp.ai/booking/api/reservationdate?propertyid=${t==null?void 0:t.propertyid}&checkindate=${n.startDate}&checkoutdate=${n.endDate}`)).json()).filter(d=>d.propertyid===t.propertyid&&d.cancelled===!1),f={owner_name:u.owner_name,building_name:u.building_name,community_name:u.communityname,project_name:u.project_name,unitnumber:u.unitnumber};T(!1),s({...t,filteredDates:p}),F(p),O({filteredData:p,PropertyData:f})};return a(x,{children:o("div",{className:"xl:col-span-2 col-span-1",children:[console.log("aaaa",y),o(ee,{title:"Booking Report",children:[t&&((j=t.filteredDates)==null?void 0:j.length)?a(x,{children:a("div",{className:"flex flex-row-reverse",children:o("button",{className:"h-[34px] rounded-[10px] relative bg-white border1px flex items-center gap-x-[10px] justify-around px-[10px] py-[5px] cursor-pointer",onClick:()=>L(H),children:[a("img",{src:ie,alt:"Excel icon",className:"w-[20px] h-[20px] noselect"}),a("p",{className:"text-[14px] leading regular color-black",children:"Export in Excel"})]})})}):null,o("div",{children:[o("form",{className:"lg:grid-cols-3 grid gap-5 grid-cols-1 ",children:[a("div",{className:"w-[100%] col-span-3",children:a("h4",{className:"text-base text-slate-800 dark:text-slate-300 mb-[0.5rem] mt-[0.5rem]",children:"Select Property"})}),a("div",{className:"w-[100%] col-span-3",children:a(te,{label:"Basic Select",className:"react-select",classNamePrefix:"select",options:v,value:v&&b?v.filter(function(n){return n.value===(t==null?void 0:t.propertyid)}):v.filter(function(n){return n.value===(t==null?void 0:t.propertyid)}),onChange:n=>{b?_():s({...t,propertyid:n==null?void 0:n.value})},styles:re,id:"hh",placeholder:"Select and Search property"})})]}),t.propertyid&&a(x,{children:N===!0?null:o("div",{className:"flex justify-end mt-[25px]",children:[a("div",{className:"w-[150px]",children:a("div",{className:"date-range-custom relative",children:a(le,{value:G,inputClassName:"input-class",containerClassName:"container-class",onChange:M,placeholder:"SELECT DATE"})})}),b&&a("div",{className:"flex justify-end",children:a("div",{className:"w-[90px]",children:a("div",{className:"date-range-custom relative",children:a("button",{className:"btn btn-dark text-white  text-center",type:"button",onClick:_,children:"Reset"})})})})]})})]}),N===!0?a(x,{children:a("div",{className:"flex items-center justify-center h-[100%]",children:a("img",{src:se,width:150,height:150})})}):(A=t.filteredDates)!=null&&A.length?a(x,{children:a(ce,{loadingPropertyforData:N,allBooking:t.filteredDates,propertyData:u,ref:z})}):a(x,{children:a("h6",{className:"text-base text-slate-800 dark:text-slate-300 mb-[0.5rem] mt-[0.5rem]",children:"No Property Data Found"})})]})]})})};export{ge as default};
