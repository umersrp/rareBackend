import{R as pe,r as o,A as fe,b as _,j as a,F as N,c as p,C as Ne,aq as xe}from"./index.6dc3f541.js";import{D as be}from"./index.esm.ed5f2cd6.js";import"./jspdf.es.min.15a242ef.js";import"./html2canvas.esm.0eae2bf4.js";import{E as ge}from"./exceljs.min.45199970.js";import{E as ve}from"./excel.9601f4f9.js";const re=pe.forwardRef(({allBooking:e,propertyData:h,fetchDetails:c=!1},L)=>{console.log("propertyData",h);const x=[{Header:"Sr no",accessor:"id",Cell:({row:t,flatRows:n})=>a("span",{children:n.indexOf(t)+1})},{Header:"MONTH / PERIOD",accessor:"TimePerid",Cell:t=>{var n,d,s,i;return c?a("button",{onClick:()=>{var l,m;return V(h._id,(l=t==null?void 0:t.cell)!=null&&l.value?(m=t==null?void 0:t.cell)==null?void 0:m.value:"")},children:(n=t==null?void 0:t.cell)!=null&&n.value?(d=t==null?void 0:t.cell)==null?void 0:d.value:"Not Available"}):a("span",{children:(s=t==null?void 0:t.cell)!=null&&s.value?(i=t==null?void 0:t.cell)==null?void 0:i.value:"Not Available"})}},{Header:"TOTAL AVAILABLE NUMBER OF NIGHTS / MONTH",accessor:"TotalDaysinMonth",Cell:t=>{var n,d;return a("span",{children:(n=t==null?void 0:t.cell)!=null&&n.value?(d=t==null?void 0:t.cell)==null?void 0:d.value:"Not Available"})}},{Header:"NO OF NIGHTS BOOKED",accessor:"No_of_Booked_Nights",Cell:t=>{var n,d;return a("span",{children:(n=t==null?void 0:t.cell)!=null&&n.value?(d=t==null?void 0:t.cell)==null?void 0:d.value:"Not Available"})}},{Header:"AVERAGE RATE PER NIGHT",accessor:"AveragePerNight",Cell:t=>{var n,d;return a("span",{children:(n=t==null?void 0:t.cell)!=null&&n.value?Number((d=t==null?void 0:t.cell)==null?void 0:d.value).toFixed(2):"Not Available"})}},{Header:"OCCUPANCY RATE",accessor:"OccpancyRate",Cell:t=>{var n,d;return a("span",{children:(n=t==null?void 0:t.cell)!=null&&n.value?Math.round(Number((d=t==null?void 0:t.cell)==null?void 0:d.value).toFixed(2))+" %":"Not Available"})}},{Header:"REFUND /CANCELLATION",accessor:"refund",Cell:t=>{var n,d;return a("span",{children:(n=t==null?void 0:t.cell)!=null&&n.value?(d=t==null?void 0:t.cell)==null?void 0:d.value:"Not Available"})}},{Header:"TOTAL BOOKING AMOUNT",accessor:"TotalHostPayable",Cell:t=>{var n,d;return a("span",{children:(n=t==null?void 0:t.cell)!=null&&n.value?Number((d=t==null?void 0:t.cell)==null?void 0:d.value).toFixed(2):"Not Available"})}}],U=o.exports.useMemo(()=>x,[]),A=o.exports.useMemo(()=>e),M=fe(),g=_.exports.useTable({columns:U,data:A,initialState:{pageIndex:0,pageSize:50}},_.exports.useGlobalFilter,_.exports.useSortBy,_.exports.usePagination,_.exports.useRowSelect),{getTableProps:$,getTableBodyProps:T,headerGroups:E,footerGroups:de,page:y,nextPage:Y,previousPage:D,canNextPage:J,canPreviousPage:H,pageOptions:I,state:ie,gotoPage:oe,pageCount:K,setPageSize:he,setGlobalFilter:W,prepareRow:q}=g,[R,Q]=o.exports.useState(0),[F,X]=o.exports.useState(0),[P,Z]=o.exports.useState(0),[O,w]=o.exports.useState(0),[k,z]=o.exports.useState(0),[C,j]=o.exports.useState(0),[B,G]=o.exports.useState(0);o.exports.useEffect(()=>{if(e!=null&&e.length){const t=e.map(n=>{const{TotalDaysinMonth:d}=n;return d});Q(t.reduce((n,d)=>n+d,0))}},[e==null?void 0:e.length]),o.exports.useEffect(()=>{if(e!=null&&e.length){const t=e.map(n=>{const{No_of_Booked_Nights:d}=n;return d});X(t.reduce((n,d)=>n+d,0))}},[e==null?void 0:e.length]),o.exports.useEffect(()=>{if(e!=null&&e.length){const t=e.map(d=>{const{OccpancyRate:s}=d;return s});let n=Math.round(t.reduce((d,s)=>d+Number(s),0)/t.length);w(n)}},[e==null?void 0:e.length]),o.exports.useEffect(()=>{var t;if(e!=null&&e.length){let n=0;for(let d=0;d<(e==null?void 0:e.length);d++){let s=parseFloat((t=e[d])==null?void 0:t.totalNonight);n+=s}z(n||0)}},[e==null?void 0:e.length]),o.exports.useEffect(()=>{var t;if(e!=null&&e.length){let n=0;for(let d=0;d<(e==null?void 0:e.length);d++){let s=Number((t=e[d])==null?void 0:t.AveragePerNight);n+=s}j(n||0)}},[e==null?void 0:e.length]),o.exports.useEffect(()=>{var t;if(e!=null&&e.length){let n=0;for(let d=0;d<(e==null?void 0:e.length);d++){let s=Number((t=e[d])==null?void 0:t.TotalHostPayable);n+=s}Z(n||0)}},[e==null?void 0:e.length]),o.exports.useEffect(()=>{h._id&&G(h._id)},[h._id]);function V(t,n){let d=new Date(n);if(t){let s=new Date(d.getFullYear(),d.getMonth(),1).toJSON().split("T")[0],i=new Date(d.getFullYear(),d.getMonth()+1,0).toJSON().split("T")[0],l=`/booking-reports?startDate=${s}&endDate=${i}&propertyId=${t}`;M(l)}}return a(N,{children:e&&e.length>0?a(N,{children:p("div",{ref:L,children:[p("div",{className:"mt-[25px]",children:[p("div",{className:"flex gap-x-[10px]",children:[a("p",{className:"font-semibold",children:"Landlord Name: "}),a("p",{className:"capitalize",children:h!=null&&h.owner_name?h==null?void 0:h.owner_name:"Not Available"})]}),p("div",{className:"flex gap-x-[10px]",children:[a("p",{className:"font-semibold",children:"Community Name: "}),a("p",{className:"capitalize",children:h.community_name?h.community_name:h!=null&&h.communityname?h==null?void 0:h.communityname:"Not Available"})]}),p("div",{className:"flex gap-x-[10px]",children:[a("p",{className:"font-semibold",children:"Project Name: "}),a("p",{className:"capitalize",children:h!=null&&h.project_name?h==null?void 0:h.project_name:"Not Available"})]}),p("div",{className:"flex gap-x-[10px]",children:[a("p",{className:"font-semibold",children:"Apartment No: "}),a("p",{className:"capitalize",children:h!=null&&h.unitnumber?h==null?void 0:h.unitnumber:"Not Available"})]}),p("div",{className:"flex gap-x-[10px]",children:[a("p",{className:"font-semibold",children:"Building No: "}),a("p",{className:"capitalize",children:h!=null&&h.building_name?h==null?void 0:h.building_name:"Not Available"})]})]}),a("div",{className:"overflow-x-auto -mx-6 mt-6",children:a("div",{className:"inline-block min-w-full align-middle",children:a("div",{className:"",children:p("table",{className:"min-w-[100%] overflow-x-scroll divide-y divide-slate-100 table-fixed dark:divide-slate-700",...$,children:[a("thead",{className:"bg-slate-200 dark:bg-slate-700",children:E.map(t=>a("tr",{...t.getHeaderGroupProps(),children:t.headers.map(n=>p("th",{...n.getHeaderProps(n.getSortByToggleProps()),scope:"col",className:"table-th",children:[n.render("Header"),a("span",{children:n.isSorted?n.isSortedDesc?" \u{1F53D}":" \u{1F53C}":""})]}))}))}),p("tbody",{className:"bg-white divide-y divide-slate-100 dark:bg-slate-800 dark:divide-slate-700",...T,children:[y&&y.length>0&&y.map(t=>(q(t),a(N,{children:a("tr",{...t.getRowProps(),children:t.cells.map(n=>a("td",{...n.getCellProps(),className:"table-td",children:n.render("Cell")}))})}))),p("tr",{children:[a("td",{className:"font-semibold",children:"TOTAL"}),a("td",{}),p("td",{className:"table-td font-semibold",children:[R==null?void 0:R.toLocaleString()," Available Nights"]}),p("td",{className:"table-td font-semibold",children:[F==null?void 0:F.toLocaleString()," Booked Nights"]}),p("td",{className:"table-td font-semibold",children:[C==null?void 0:C.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})," AED"]}),p("td",{className:"table-td font-semibold",children:[O==null?void 0:O.toLocaleString()," %"]}),a("td",{}),p("td",{className:"table-td font-semibold",children:[P==null?void 0:P.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})," AED"]}),a("td",{})]})]})]})})})})]})}):a(N,{children:a("h6",{className:"text-base text-slate-800 dark:text-slate-300 mb-[0.5rem] mt-[0.5rem]",children:"No Property Data Found"})})})}),Se={option:(e,h)=>({...e,fontSize:"14px"})},Pe=()=>{var n,d;const[e,h]=o.exports.useState({propertyid:{},filteredDates:[]}),[c,L]=o.exports.useState([]),[x,U]=o.exports.useState(""),[A,M]=o.exports.useState(""),[g,$]=o.exports.useState([]),[T,E]=o.exports.useState(""),[de,y]=o.exports.useState(""),[Y,D]=o.exports.useState({}),[J,H]=o.exports.useState([]),[I,ie]=o.exports.useState([]),[oe,K]=o.exports.useState(""),[he,W]=o.exports.useState(0),[q,R]=o.exports.useState(0),[Q,F]=o.exports.useState(0),[X,P]=o.exports.useState(0),[Z,O]=o.exports.useState(0),[w,k]=o.exports.useState(0);o.exports.useEffect(()=>{if(c!=null&&c.length){const s=c.map(i=>{const{TotalDaysinMonth:l}=i;return l});console.log("days"),W(s.reduce((i,l)=>i+l,0))}},[c==null?void 0:c.length]),o.exports.useEffect(()=>{if(c!=null&&c.length){const s=c.map(i=>{const{No_of_Booked_Nights:l}=i;return l});R(s.reduce((i,l)=>i+l,0))}},[c==null?void 0:c.length]),o.exports.useEffect(()=>{if(c!=null&&c.length){const s=c.map(l=>{const{OccpancyRate:m}=l;return m});let i=Math.round(s.reduce((l,m)=>l+Number(m),0)/s.length);P(i)}},[c==null?void 0:c.length]),o.exports.useEffect(()=>{var s;if(c!=null&&c.length){let i=0;for(let l=0;l<(c==null?void 0:c.length);l++){let m=parseFloat((s=c[l])==null?void 0:s.totalNonight);i+=m}O(i||0)}},[c==null?void 0:c.length]),o.exports.useEffect(()=>{var s;if(c!=null&&c.length){let i=0;for(let l=0;l<(c==null?void 0:c.length);l++){let m=Number((s=c[l])==null?void 0:s.AveragePerNight);i+=m}k(i||0)}},[c==null?void 0:c.length]),o.exports.useEffect(()=>{var s;if(c!=null&&c.length){let i=0;for(let l=0;l<(c==null?void 0:c.length);l++){console.log("@@@@@3333",c);let m=Number((s=c[l])==null?void 0:s.TotalHostPayable);i+=m}console.log("totalbookednights",i),F(i||0)}},[c==null?void 0:c.length]),o.exports.useEffect(()=>{fetch("http://portals.rarehomesgroup.com/property").then(s=>s.json()).then(s=>{const i=s==null?void 0:s.map(l=>({label:l.unitnumber+" | "+l.communityname+" | "+l.projectname+" | "+l.buildingname,value:l._id}));$(i)})},[]),o.exports.useEffect(()=>{(async()=>{if(e!=null&&e.propertyid){K(e.propertyid);const l=await(await fetch(`http://portals.rarehomesgroup.com/property/${e==null?void 0:e.propertyid}`)).json();H(I==null?void 0:I.data),l&&E(l)}})()},[e==null?void 0:e.propertyid]),o.exports.useEffect(()=>{(async()=>{if(e!=null&&e.propertyid){let i=`http://portals.rarehomesgroup.com/booking/summarybyDates/${e==null?void 0:e.propertyid}`;newValue&&(newValue==null?void 0:newValue.startDate)&&(newValue==null?void 0:newValue.endDate)&&(i+=`?fromdate=${newValue.startDate}&todate=${newValue.endDate}`);const m=await(await fetch(i)).json();H(m==null?void 0:m.data),U(m==null?void 0:m.data)}})()},[]);const[z,C]=o.exports.useState({startDate:"",endDate:""}),j=o.exports.useRef(null),B=async()=>{if(e!=null&&e.propertyid){let s=new Date,i=new Date(s.getFullYear(),s.getMonth()+1,0).toJSON().split("T")[0];s.setMonth(s.getMonth()-6);let l=new Date(s.getFullYear(),s.getMonth(),1).toJSON().split("T")[0],m=`http://portals.rarehomesgroup.com/booking/summarybyDates/${e==null?void 0:e.propertyid}`;l&&i&&(m+=`?fromdate=${l}&todate=${i}`);const u=await(await fetch(m)).json();L(u.data?u.data:[])}};o.exports.useEffect(()=>{if(x!=null&&x.length&&(e==null?void 0:e.propertyid)&&(e==null?void 0:e.startDate)&&(e==null?void 0:e.endDate)){const s=x.filter(i=>{let l=!0;return e.propertyid&&i.propertyid!==e.propertyid&&(l=!1),(i==null?void 0:i.checkindate)<(e==null?void 0:e.startDate)&&(i==null?void 0:i.checkindate)>(e==null?void 0:e.endDate)&&(l=!1),l});L(s)}B()},[e==null?void 0:e.propertyid,e==null?void 0:e.startDate,e==null?void 0:e.endDate,x]);const G=()=>{M(""),h({...e,filteredDates:[]}),C({startDate:null,endDate:null})},V=async s=>{if(E(!0),M(s),!s){h({...e,filteredDates:[]});return}const l=await(await fetch(`http://portals.rarehomesgroup.com/booking/summarybyDates/${e==null?void 0:e.propertyid}?fromdate=${s.startDate}&todate=${s.endDate}`)).json();E(!1);let m=T;h({...e,filteredDates:l==null?void 0:l.data});const b={owner_name:m.owner_name,building_name:m.building_name,community_name:m.communityname,project_name:m.project_name,unitnumber:m.unitnumber};D(b),y(b),H({filteredData:l==null?void 0:l.data,PropertyData:b})};function t(s){var te,se,ae,ce,ne,le;const{filteredData:i,PropertyData:l}=s;let m=[];m.push(l),console.log("122222",m);const b=new ge.Workbook,u=b.addWorksheet("CombinedSheet");if(u.mergeCells("A1:W1"),u.addRow(["PROPERTY SUMMARY"]),u.columns=[{header:"Landlord Name",key:"owner_name",width:30},{header:"Community Name",key:"community_name",width:40},{header:"Project Name",key:"project_name",width:25},{header:"Apartment No",key:"unitnumber",width:25},{header:"Building No",key:"building_name",width:25},{header:"",key:"",width:20},{header:"",key:"",width:55},{header:"",key:"",width:55}],m){console.log("PropertyData",l),[["Landlord Name","Community Name","Project Name","Apartment No","Building No"],...m.map(r=>[r.owner_name,r.community_name,r.project_name,r.unitnumber,r.building_name])].forEach(r=>{u.addRow(r)}),u.addRow([]),u.addRow([]);const S=u.addRow(["MONTHWISE BOOKING SUMMARY"]);u.addRow([]),S.eachCell(r=>{r.font={size:11}})}const ee=u.addRow(["MONTH / PERIOD","TOTAL AVAILABLE NUMBER OF NIGHTS / MONTH","NO OF NIGHTS BOOKED","AVERAGE RATE PER NIGHT","OCCUPANCY RATE","REFUND /CANCELLATION","TOTAL BOOKING AMOUNT"]);if(i){i.forEach(r=>{u.addRow([r==null?void 0:r.TimePerid,r==null?void 0:r.TotalDaysinMonth,r==null?void 0:r.No_of_Booked_Nights,Number(r==null?void 0:r.AveragePerNight).toFixed(2),Math.round(Number(r==null?void 0:r.OccpancyRate).toFixed(0))+"%","NOT AVAILABLE",r==null?void 0:r.TotalHostPayable])}),u.addRow([]);const v=i.map(r=>Number(r.AveragePerNight)).reduce((r,f)=>r+f,0),S=u.addRow(["TOTAL",((te=i.map(r=>Number(r.TotalDaysinMonth)).reduce((r,f)=>r+f,0))==null?void 0:te.toLocaleString())+" Available Nights",((se=i.map(r=>Number(r.No_of_Booked_Nights)).reduce((r,f)=>r+f,0))==null?void 0:se.toLocaleString())+"  Booked Nights","AED"+(v==null?void 0:v.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})),((ce=(ae=i.map(r=>Number(r.OccpancyRate)).reduce((r,f)=>r+f,0))==null?void 0:ae.toLocaleString())==null?void 0:ce.toLocaleString())+"%","","AED "+((le=(ne=i.map(r=>Number(r.TotalHostPayable)).reduce((r,f)=>r+f,0))==null?void 0:ne.toLocaleString())==null?void 0:le.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))]);{const r={type:"pattern",pattern:"solid",fgColor:{argb:"808080"}};S.fill=r,ee.fill=r;const f={argb:"FFFFFF"};[S,ee].forEach(me=>{me.eachCell({includeEmpty:!0},ue=>{ue.font={color:f}})})}}u.getRow(2).font={bold:!0},u.getRow(2).fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},u.getRow(3).fill={type:"pattern",pattern:"solid",fgColor:{argb:"808080"}},u.getRow(7).fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},u.getRow(2).font={color:{argb:"FFFFFF"}},u.getRow(3).font={color:{argb:"FFFFFF"}},u.getRow(7).font={color:{argb:"FFFFFF"}},u.getRow(7).alignment={horizontal:"center"},b.xlsx.writeBuffer().then(v=>{const S=new Blob([v],{type:"application/octet-stream"}),r=URL.createObjectURL(S),f=document.createElement("a");f.href=r,f.download="booking-"+new Date+".xlsx",document.body.appendChild(f),f.click(),document.body.removeChild(f)})}return a(N,{children:a("div",{className:"xl:col-span-2 col-span-1",children:p(Ne,{title:"Booking Summary",children:[(e==null?void 0:e.filteredDates)&&((n=e==null?void 0:e.filteredDates)==null?void 0:n.length)?a(N,{children:a("div",{className:"flex flex-row-reverse",children:p("button",{className:"h-[34px] rounded-[10px] relative bg-white border1px flex items-center gap-x-[10px] justify-around px-[10px] py-[5px] cursor-pointer",onClick:()=>t(J),children:[a("img",{src:ve,alt:"Excel icon",className:"w-[20px] h-[20px] noselect"}),a("p",{className:"text-[14px] leading regular color-black",children:"Export in Excel"})]})})}):null,p("div",{children:[p("form",{className:"lg:grid-cols-3 grid gap-5 grid-cols-1 ",children:[a("div",{className:"w-[100%] col-span-3",children:a("h4",{className:"text-base text-slate-800 dark:text-slate-300 mb-[0.5rem] mt-[0.5rem]",children:"Select Property"})}),a("div",{className:"w-[100%] col-span-3",children:a(xe,{label:"Basic Select",className:"react-select",classNamePrefix:"select",options:g,value:g&&A?g.filter(function(s){return s.value===(e==null?void 0:e.propertyid)}):g.filter(function(s){return s.value===(e==null?void 0:e.propertyid)}),onChange:s=>{A?G():h({...e,propertyid:s==null?void 0:s.value})},styles:Se,id:"hh",placeholder:"Select and Search property"})})]}),e.propertyid&&a(N,{children:p("div",{className:"flex justify-end mt-[25px]",children:[a("div",{className:"w-[150px]",children:a("div",{className:"date-range-custom relative",children:a(be,{value:z,inputClassName:"input-class",containerClassName:"container-class",onChange:V,placeholder:"SELECT DATE"})})}),A&&a("div",{className:"flex justify-end",children:a("div",{className:"w-[90px]",children:a("div",{className:"date-range-custom relative",children:a("button",{className:"btn btn-dark text-white  text-center",type:"button",onClick:G,children:"Reset"})})})})]})})]}),(d=e.filteredDates)!=null&&d.length?a(N,{children:a(re,{allBooking:e.filteredDates,propertyData:Y,ref:j,fetchDetails:!0})}):a(N,{children:T?a(re,{allBooking:c,propertyData:T,ref:j,fetchDetails:!0}):""})]})})})};export{Pe as default};
