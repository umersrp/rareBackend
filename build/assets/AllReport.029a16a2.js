import{R as V,r as d,b as C,j as t,F as f,c as h,c5 as B,c6 as w,c9 as ee,C as te,aq as ae,b$ as le}from"./index.17c13ab6.js";import{D as se}from"./index.esm.f83e842c.js";import"./jspdf.es.min.ebf1a888.js";import"./html2canvas.esm.0eae2bf4.js";import{L as ne}from"./Rare logo New Gif Loading.02c4dc82.js";import{E as ie}from"./exceljs.min.3e32e57c.js";import{E as ce}from"./excel.9601f4f9.js";const re=V.forwardRef(({allBooking:c,propertyData:n,loadingPropertyforData:l},x)=>{const j=[{Header:"Sr no",accessor:"id",Cell:({row:e,flatRows:a})=>t("span",{children:a.indexOf(e)+1})},{Header:"Guest Name",accessor:"guestname",Cell:e=>{var a,s;return t("div",{children:t("span",{className:"inline-flex items-center",children:t("span",{className:"text-sm text-slate-600 dark:text-slate-300",children:(a=e==null?void 0:e.cell)!=null&&a.value?(s=e==null?void 0:e.cell)==null?void 0:s.value:"Not Available"})})})}},{Header:"Booking Date",accessor:"reservation_date",Cell:e=>{var a,s;return t("span",{children:(a=e==null?void 0:e.cell)!=null&&a.value?new Date((s=e==null?void 0:e.cell)==null?void 0:s.value).toDateString():"Not Available"})}},{Header:"Confirmation Code",accessor:"confirmationcode",Cell:e=>{var a,s;return t("span",{children:(a=e==null?void 0:e.cell)!=null&&a.value?(s=e==null?void 0:e.cell)==null?void 0:s.value:"Not Available"})}},{Header:"Check in Date",accessor:"checkindate",Cell:e=>{var a,s;return t("span",{children:(a=e==null?void 0:e.cell)!=null&&a.value?(s=e==null?void 0:e.cell)==null?void 0:s.value:"Not Available"})},sortType:(e,a,s,r)=>B(e,a,s,r)},{Header:"Check out Date",accessor:"checkoutdate",Cell:e=>{var a,s;return t("span",{children:(a=e==null?void 0:e.cell)!=null&&a.value?(s=e==null?void 0:e.cell)==null?void 0:s.value:"Not Available"})},sortType:(e,a,s,r)=>w(e,a,s,r)},{Header:"NO OF NIGHTS STAYED",accessor:"nonight",Cell:e=>{var a,s;return t("span",{children:(a=e==null?void 0:e.cell)!=null&&a.value?(s=e==null?void 0:e.cell)==null?void 0:s.value:"0.00"})}},{Header:"RATE PER NIGHT",accessor:"tourismfee",Cell:e=>{var T,D,K,U,$,q,W,Y,J,Q,X,Z;let a=(K=(D=(T=e==null?void 0:e.cell)==null?void 0:T.row)==null?void 0:D.original)!=null&&K.nonight?parseFloat((q=($=(U=e==null?void 0:e.cell)==null?void 0:U.row)==null?void 0:$.original)==null?void 0:q.nonight):0,r=((J=(Y=(W=e==null?void 0:e.cell)==null?void 0:W.row)==null?void 0:Y.original)!=null&&J.roomrenthostpayable?parseFloat((Z=(X=(Q=e==null?void 0:e.cell)==null?void 0:Q.row)==null?void 0:X.original)==null?void 0:Z.roomrenthostpayable):0)/a;return t("span",{children:r?parseFloat(r).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})+" AED":"0.00"})}},{Header:"BOOKING AMOUNT",accessor:"roomrenthostpayable",Cell:e=>{var a,s;return t("span",{children:(a=e==null?void 0:e.cell)!=null&&a.value?parseFloat((s=e==null?void 0:e.cell)==null?void 0:s.value).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})+" AED":"0.00"})}}],b=d.exports.useMemo(()=>j,[]),g=d.exports.useMemo(()=>c),H=C.exports.useTable({columns:b,data:g,initialState:{pageIndex:0,pageSize:50}},C.exports.useGlobalFilter,C.exports.useSortBy,C.exports.usePagination,C.exports.useRowSelect),{getTableProps:S,getTableBodyProps:A,headerGroups:N,footerGroups:k,page:p,nextPage:I,previousPage:E,canNextPage:P,canPreviousPage:L,pageOptions:O,state:F,gotoPage:G,pageCount:z,setPageSize:M,setGlobalFilter:_,prepareRow:y}=H,[u,R]=d.exports.useState(0),[i,m]=d.exports.useState(0),[o,v]=d.exports.useState(0);return d.exports.useEffect(()=>{var e;if(c!=null&&c.length){let a=0;for(let s=0;s<(c==null?void 0:c.length);s++){let r=parseFloat((e=c[s])==null?void 0:e.nonight);a+=r}R(a||0)}},[c==null?void 0:c.length]),d.exports.useEffect(()=>{if(c!=null&&c.length){let s=c.filter(r=>r.roomrenthostpayable!==void 0?r.roomrenthostpayable:null).map(r=>Number(r.roomrenthostpayable)).reduce((r,T)=>r+T,0);console.log("mmmmmmmmmmmm333",s),m(s.toFixed(2))}},[c==null?void 0:c.length]),d.exports.useEffect(()=>{if(u&&i){let e=i/u;v(e)}},[u,i]),t(f,{children:h("div",{ref:x,children:[h("div",{className:"mt-[25px]",children:[h("div",{className:"flex gap-x-[10px]",children:[t("p",{className:"font-semibold",children:"Landlord Name: "}),t("p",{className:"capitalize",children:n!=null&&n.owner_name?n==null?void 0:n.owner_name:"Not Available"})]}),h("div",{className:"flex gap-x-[10px]",children:[t("p",{className:"font-semibold",children:"Community Name: "}),t("p",{className:"capitalize",children:n!=null&&n.communityname?n==null?void 0:n.communityname:"Not Available"})]}),h("div",{className:"flex gap-x-[10px]",children:[t("p",{className:"font-semibold",children:"Project Name: "}),t("p",{className:"capitalize",children:n!=null&&n.project_name?n==null?void 0:n.project_name:"Not Available"})]}),h("div",{className:"flex gap-x-[10px]",children:[t("p",{className:"font-semibold",children:"Apartment No: "}),t("p",{className:"capitalize",children:n!=null&&n.unitnumber?n==null?void 0:n.unitnumber:"Not Available"})]}),h("div",{className:"flex gap-x-[10px]",children:[t("p",{className:"font-semibold",children:"Building No: "}),t("p",{className:"capitalize",children:n!=null&&n.building_name?n==null?void 0:n.building_name:"Not Available"})]})]}),t("div",{className:"overflow-x-auto -mx-6 mt-6",children:t("div",{className:"inline-block min-w-full align-middle",children:t("div",{className:"",children:h("table",{className:"min-w-[100%] overflow-x-scroll divide-y divide-slate-100 table-fixed dark:divide-slate-700",...S,children:[t("thead",{className:"bg-slate-200 dark:bg-slate-700",children:N.map(e=>t("tr",{...e.getHeaderGroupProps(),children:e.headers.map(a=>h("th",{...a.getHeaderProps(a.getSortByToggleProps()),scope:"col",className:"table-th",children:[a.render("Header"),t("span",{children:a.isSorted?a.isSortedDesc?" \u{1F53D}":" \u{1F53C}":""})]}))}))}),h("tbody",{className:"bg-white divide-y divide-slate-100 dark:bg-slate-800 dark:divide-slate-700",...A,children:[p&&p.length>0&&p.map(e=>(y(e),t(f,{children:t("tr",{...e.getRowProps(),children:e.cells.map(a=>t("td",{...a.getCellProps(),className:"table-td",children:a.render("Cell")}))})}))),h("tr",{children:[t("td",{}),t("td",{}),t("td",{}),t("td",{}),t("td",{}),t("td",{className:"font-semibold",children:"TOTAL"}),t("td",{className:"table-td font-semibold",children:(u==null?void 0:u.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))+" Nights"}),t("td",{className:"table-td font-semibold",children:(o==null?void 0:o.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))+" AED"}),t("td",{className:"table-td font-semibold",children:(i==null?void 0:i.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))+" AED"})]})]})]})})})})]})})}),de={option:(c,n)=>({...c,fontSize:"14px"})},ge=()=>{var u,R;const[c,n]=ee(),[l,x]=d.exports.useState({propertyid:c.get("propertyId")?c.get("propertyId"):"",filteredDates:[]}),[j,b]=d.exports.useState([]),[g,H]=d.exports.useState(""),[S,A]=d.exports.useState(""),[N,k]=d.exports.useState([]),[p,I]=d.exports.useState(""),[E,P]=d.exports.useState(!1),[L,O]=d.exports.useState({filteredData:[],PropertyData:{}}),[F,G]=d.exports.useState({startDate:c.get("startDate")?new Date(c.get("startDate")):"",endDate:c.get("endDate")?new Date(c.get("endDate")):""}),z=d.exports.useRef(null);function M(i){const{filteredData:m,PropertyData:o}=i;let v=[];v.push(o);const e=new ie.Workbook,a=e.addWorksheet("Sheet1");a.mergeCells("A1:F1"),a.addRow(["BOOKING REPORTS"]),a.columns=[{header:"Landlord Name",key:"",width:30},{header:"Community Name",key:"",width:40},{header:"Project Name",key:"",width:25},{header:"Apartment No",key:"",width:25},{header:"Building No",key:"",width:25},{header:"",key:"",width:25}],v&&([["Landlord Name","Community Name","Project Name","Apartment No","Building No"],...v.map(r=>[r.owner_name,r.community_name,r.project_name,r.unitnumber,r.building_name])].forEach(r=>{a.addRow(r)}),a.addRow([]),a.addRow([]),a.addRow([]),a.addRow([])),a.addRow(["GUEST NAME","BOOKING DATE","CONFIRMATION CODE","CHECK IN DATE","CHECK OUT DATE","NO OF NIGHTS STAYED","BOOKING AMOUNT"]),m.forEach(s=>{a.addRow([s.guestname,s.Created_At,s.confirmationcode,s.checkin_date,s.checkout_date,s.nonight,Number(s.roomrenthostpayable).toFixed(2)])}),a.getRow(2).font={color:{argb:"FFFFFF"}},a.getRow(2).fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},a.getRow(3).fill={type:"pattern",pattern:"solid",fgColor:{argb:"808080"}},a.getRow(9).fill={type:"pattern",pattern:"solid",fgColor:{argb:"808080"}},a.getRow(3).font={color:{argb:"FFFFFF"}},a.getRow(9).font={color:{argb:"FFFFFF"}},e.xlsx.writeBuffer().then(s=>{le.exports.saveAs(new Blob([s],{type:"application/octet-stream"}),"bookings.xlsx")})}d.exports.useEffect(()=>{fetch("http://dev-rare.srp.ai/property").then(i=>i.json()).then(i=>{const m=i==null?void 0:i.map(o=>({label:o.unitnumber+" | "+o.communityname+" | "+o.projectname+" | "+o.buildingname,value:o._id}));k(m)})},[]),d.exports.useEffect(()=>{(async()=>{if(l!=null&&l.propertyid){const o=await(await fetch(`http://dev-rare.srp.ai/property/${l==null?void 0:l.propertyid}`)).json();o&&I(o),F.startDate&&F.endDate&&y(F)}})()},[l==null?void 0:l.propertyid]),d.exports.useEffect(()=>{if(g!=null&&g.length&&(l==null?void 0:l.propertyid)&&(l==null?void 0:l.startDate)&&(l==null?void 0:l.endDate)){const i=g.filter(m=>{let o=!0;return l.propertyid&&m.propertyid!==l.propertyid&&(o=!1),(m==null?void 0:m.checkindate)<(l==null?void 0:l.startDate)&&(m==null?void 0:m.checkindate)>(l==null?void 0:l.endDate)&&(o=!1),o});b(i)}},[l==null?void 0:l.propertyid,l==null?void 0:l.startDate,l==null?void 0:l.endDate,g]);const _=()=>{A(""),x({...l,filteredDates:[]}),G({startDate:null,endDate:null})},y=async i=>{if(P(!0),A(i),!i){x({...l,filteredDates:[]});return}const m={owner_name:p.owner_name,building_name:p.building_name,community_name:p.communityname,project_name:p.project_name,unitnumber:p.unitnumber};try{const e=(await(await fetch(`http://dev-rare.srp.ai/booking/api/reservationdate?propertyid=${l==null?void 0:l.propertyid}&checkindate=${i.startDate}&checkoutdate=${i.endDate}`)).json()).filter(a=>a.propertyid===l.propertyid&&a.cancelled===!1);P(!1),x({...l,filteredDates:e}),b(e),O({filteredData:e,PropertyData:m})}catch{console.log("error"),P(!1),x({...l,filteredDates:[]}),b([]),O({filteredData:[],PropertyData:m})}};return t(f,{children:t("div",{className:"xl:col-span-2 col-span-1",children:h(te,{title:"Booking Report",children:[l&&((u=l.filteredDates)==null?void 0:u.length)?t(f,{children:t("div",{className:"flex flex-row-reverse",children:h("button",{className:"h-[34px] rounded-[10px] relative bg-white border1px flex items-center gap-x-[10px] justify-around px-[10px] py-[5px] cursor-pointer",onClick:()=>M(L),children:[t("img",{src:ce,alt:"Excel icon",className:"w-[20px] h-[20px] noselect"}),t("p",{className:"text-[14px] leading regular color-black",children:"Export in Excel"})]})})}):null,h("div",{children:[h("form",{className:"lg:grid-cols-3 grid gap-5 grid-cols-1 ",children:[t("div",{className:"w-[100%] col-span-3",children:t("h4",{className:"text-base text-slate-800 dark:text-slate-300 mb-[0.5rem] mt-[0.5rem]",children:"Select Property"})}),t("div",{className:"w-[100%] col-span-3",children:t(ae,{label:"Basic Select",className:"react-select",classNamePrefix:"select",options:N,value:N&&S?N.filter(function(i){return i.value===(l==null?void 0:l.propertyid)}):N.filter(function(i){return i.value===(l==null?void 0:l.propertyid)}),onChange:i=>{S?_():x({...l,propertyid:i==null?void 0:i.value})},styles:de,id:"hh",placeholder:"Select and Search property"})})]}),l.propertyid&&t(f,{children:E===!0?null:h("div",{className:"flex justify-end mt-[25px]",children:[t("div",{className:"w-[150px]",children:t("div",{className:"date-range-custom relative",children:t(se,{value:F,inputClassName:"input-class",containerClassName:"container-class",onChange:y,placeholder:"SELECT DATE"})})}),S&&t("div",{className:"flex justify-end",children:t("div",{className:"w-[90px]",children:t("div",{className:"date-range-custom relative",children:t("button",{className:"btn btn-dark text-white  text-center",type:"button",onClick:_,children:"Reset"})})})})]})})]}),E===!0?t(f,{children:t("div",{className:"flex items-center justify-center h-[100%]",children:t("img",{src:ne,width:150,height:150})})}):(R=l.filteredDates)!=null&&R.length?t(f,{children:t(re,{loadingPropertyforData:E,allBooking:l.filteredDates,propertyData:p,ref:z})}):p?t(f,{children:t("h6",{className:"text-base text-slate-800 dark:text-slate-300 mb-[0.5rem] mt-[0.5rem]",children:"No Property Data Found"})}):""]})})})};export{ge as default};
