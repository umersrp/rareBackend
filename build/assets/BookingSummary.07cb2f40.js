import{R as se,r as l,A as ae,b as y,j as c,F as N,c as u,C as ne,aq as ce,b$ as re,Q as ie}from"./index.15a860d8.js";import{D as oe}from"./index.esm.6952c29f.js";import"./jspdf.es.min.7d17c91d.js";import"./html2canvas.esm.0eae2bf4.js";import{u as J,w as le}from"./xlsx.2859d0e9.js";import{E as de}from"./exceljs.min.d6cd2861.js";import{E as me}from"./excel.9601f4f9.js";const ee=se.forwardRef(({allBooking:t,propertyData:d,fetchDetails:r=!1},D)=>{const g=[{Header:"Sr no",accessor:"id",Cell:({row:s,flatRows:a})=>c("span",{children:a.indexOf(s)+1})},{Header:"MONTH / PERIOD",accessor:"TimePerid",Cell:s=>{var a,e,h,f;return r?c("button",{onClick:()=>{var m,p;return n(d._id,(m=s==null?void 0:s.cell)!=null&&m.value?(p=s==null?void 0:s.cell)==null?void 0:p.value:"")},children:(a=s==null?void 0:s.cell)!=null&&a.value?(e=s==null?void 0:s.cell)==null?void 0:e.value:"Not Available"}):c("span",{children:(h=s==null?void 0:s.cell)!=null&&h.value?(f=s==null?void 0:s.cell)==null?void 0:f.value:"Not Available"})}},{Header:"TOTAL AVAILABLE NUMBER OF NIGHTS / MONTH",accessor:"TotalDaysinMonth",Cell:s=>{var a,e;return c("span",{children:(a=s==null?void 0:s.cell)!=null&&a.value?(e=s==null?void 0:s.cell)==null?void 0:e.value:"Not Available"})}},{Header:"NO OF NIGHTS BOOKED",accessor:"No_of_Booked_Nights",Cell:s=>{var a,e;return c("span",{children:(a=s==null?void 0:s.cell)!=null&&a.value?(e=s==null?void 0:s.cell)==null?void 0:e.value:"Not Available"})}},{Header:"AVERAGE RATE PER NIGHT",accessor:"AveragePerNight",Cell:s=>{var a,e;return c("span",{children:(a=s==null?void 0:s.cell)!=null&&a.value?Number((e=s==null?void 0:s.cell)==null?void 0:e.value).toFixed(2):"Not Available"})}},{Header:"OCCUPANCY RATE",accessor:"OccpancyRate",Cell:s=>{var a,e;return c("span",{children:(a=s==null?void 0:s.cell)!=null&&a.value?Math.round(Number((e=s==null?void 0:s.cell)==null?void 0:e.value).toFixed(2))+" %":"Not Available"})}},{Header:"REFUND /CANCELLATIONT",accessor:"refund",Cell:s=>{var a,e;return c("span",{children:(a=s==null?void 0:s.cell)!=null&&a.value?(e=s==null?void 0:s.cell)==null?void 0:e.value:"Not Available"})}},{Header:"TOTAL BOOKING AMOUNT",accessor:"TotalHostPayable",Cell:s=>{var a,e;return c("span",{children:(a=s==null?void 0:s.cell)!=null&&a.value?Number((e=s==null?void 0:s.cell)==null?void 0:e.value).toFixed(2):"Not Available"})}}],$=l.exports.useMemo(()=>g,[]),E=l.exports.useMemo(()=>t),P=ae(),v=y.exports.useTable({columns:$,data:E,initialState:{pageIndex:0,pageSize:50}},y.exports.useGlobalFilter,y.exports.useSortBy,y.exports.usePagination,y.exports.useRowSelect),{getTableProps:z,getTableBodyProps:_,headerGroups:T,footerGroups:W,page:A,nextPage:q,previousPage:K,canNextPage:I,canPreviousPage:Q,pageOptions:M,state:X,gotoPage:H,pageCount:Z,setPageSize:G,setGlobalFilter:w,prepareRow:k}=v,[F,S]=l.exports.useState(0),[O,Y]=l.exports.useState(0),[L,j]=l.exports.useState(0),[R,U]=l.exports.useState(0),[B,C]=l.exports.useState(0),[b,V]=l.exports.useState(0),[i,o]=l.exports.useState(0);l.exports.useEffect(()=>{if(t!=null&&t.length){const s=t.map(a=>{const{TotalDaysinMonth:e}=a;return e});S(s.reduce((a,e)=>a+e,0))}},[t==null?void 0:t.length]),l.exports.useEffect(()=>{if(t!=null&&t.length){const s=t.map(a=>{const{No_of_Booked_Nights:e}=a;return e});Y(s.reduce((a,e)=>a+e,0))}},[t==null?void 0:t.length]),l.exports.useEffect(()=>{if(t!=null&&t.length){const s=t.map(e=>{const{OccpancyRate:h}=e;return h});let a=Math.round(s.reduce((e,h)=>e+Number(h),0)/s.length);U(a)}},[t==null?void 0:t.length]),l.exports.useEffect(()=>{var s;if(t!=null&&t.length){let a=0;for(let e=0;e<(t==null?void 0:t.length);e++){let h=parseFloat((s=t[e])==null?void 0:s.totalNonight);a+=h}C(a||0)}},[t==null?void 0:t.length]),l.exports.useEffect(()=>{var s;if(t!=null&&t.length){let a=0;for(let e=0;e<(t==null?void 0:t.length);e++){let h=Number((s=t[e])==null?void 0:s.AveragePerNight);a+=h}V(a||0)}},[t==null?void 0:t.length]),l.exports.useEffect(()=>{var s;if(t!=null&&t.length){let a=0;for(let e=0;e<(t==null?void 0:t.length);e++){let h=Number((s=t[e])==null?void 0:s.TotalHostPayable);a+=h}j(a||0)}},[t==null?void 0:t.length]),l.exports.useEffect(()=>{d._id&&o(d._id)},[d._id]);function n(s,a){let e=new Date(a);if(s){let h=new Date(e.getFullYear(),e.getMonth(),1).toJSON().split("T")[0],f=new Date(e.getFullYear(),e.getMonth()+1,0).toJSON().split("T")[0],m=`/booking-reports?startDate=${h}&endDate=${f}&propertyId=${s}`;P(m)}}return c(N,{children:t&&t.length>0?c(N,{children:u("div",{ref:D,children:[u("div",{className:"mt-[25px]",children:[u("div",{className:"flex gap-x-[10px]",children:[c("p",{className:"font-semibold",children:"Landlord Name: "}),c("p",{className:"capitalize",children:d!=null&&d.owner_name?d==null?void 0:d.owner_name:"Not Available"})]}),u("div",{className:"flex gap-x-[10px]",children:[c("p",{className:"font-semibold",children:"Community Name: "}),c("p",{className:"capitalize",children:d!=null&&d.communityname?d==null?void 0:d.communityname:"Not Available"})]}),u("div",{className:"flex gap-x-[10px]",children:[c("p",{className:"font-semibold",children:"Project Name: "}),c("p",{className:"capitalize",children:d!=null&&d.project_name?d==null?void 0:d.project_name:"Not Available"})]}),u("div",{className:"flex gap-x-[10px]",children:[c("p",{className:"font-semibold",children:"Apartment No: "}),c("p",{className:"capitalize",children:d!=null&&d.unitnumber?d==null?void 0:d.unitnumber:"Not Available"})]}),u("div",{className:"flex gap-x-[10px]",children:[c("p",{className:"font-semibold",children:"Building No: "}),c("p",{className:"capitalize",children:d!=null&&d.building_name?d==null?void 0:d.building_name:"Not Available"})]})]}),c("div",{className:"overflow-x-auto -mx-6 mt-6",children:c("div",{className:"inline-block min-w-full align-middle",children:c("div",{className:"",children:u("table",{className:"min-w-[100%] overflow-x-scroll divide-y divide-slate-100 table-fixed dark:divide-slate-700",...z,children:[c("thead",{className:"bg-slate-200 dark:bg-slate-700",children:T.map(s=>c("tr",{...s.getHeaderGroupProps(),children:s.headers.map(a=>u("th",{...a.getHeaderProps(a.getSortByToggleProps()),scope:"col",className:"table-th",children:[a.render("Header"),c("span",{children:a.isSorted?a.isSortedDesc?" \u{1F53D}":" \u{1F53C}":""})]}))}))}),u("tbody",{className:"bg-white divide-y divide-slate-100 dark:bg-slate-800 dark:divide-slate-700",..._,children:[A&&A.length>0&&A.map(s=>(k(s),c(N,{children:c("tr",{...s.getRowProps(),children:s.cells.map(a=>c("td",{...a.getCellProps(),className:"table-td",children:a.render("Cell")}))})}))),u("tr",{children:[c("td",{className:"font-semibold",children:"TOTAL"}),c("td",{}),u("td",{className:"table-td font-semibold",children:[F==null?void 0:F.toLocaleString()," Available Nights"]}),u("td",{className:"table-td font-semibold",children:[O==null?void 0:O.toLocaleString()," Booked Nights"]}),u("td",{className:"table-td font-semibold",children:[b==null?void 0:b.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})," AED"]}),u("td",{className:"table-td font-semibold",children:[R==null?void 0:R.toLocaleString()," %"]}),c("td",{}),u("td",{className:"table-td font-semibold",children:[L==null?void 0:L.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})," AED"]}),c("td",{})]})]})]})})})})]})}):c(N,{children:c("h6",{className:"text-base text-slate-800 dark:text-slate-300 mb-[0.5rem] mt-[0.5rem]",children:"No Property Data Found"})})})}),ue={option:(t,d)=>({...t,fontSize:"14px"})},be=()=>{var b,V;const[t,d]=l.exports.useState({propertyid:"",filteredDates:[]}),[r,D]=l.exports.useState([]),[g,$]=l.exports.useState(""),[E,P]=l.exports.useState(""),[v,z]=l.exports.useState([]),[_,T]=l.exports.useState(""),[W,A]=l.exports.useState({}),[q,K]=l.exports.useState({filteredData:[],PropertyData:{}}),[I,Q]=l.exports.useState(0),[M,X]=l.exports.useState(0),[H,Z]=l.exports.useState(0),[G,w]=l.exports.useState(0),[k,F]=l.exports.useState(0),[S,O]=l.exports.useState(0);l.exports.useEffect(()=>{if(r!=null&&r.length){const i=r.map(o=>{const{TotalDaysinMonth:n}=o;return n});console.log("days"),Q(i.reduce((o,n)=>o+n,0))}},[r==null?void 0:r.length]),l.exports.useEffect(()=>{if(r!=null&&r.length){const i=r.map(o=>{const{No_of_Booked_Nights:n}=o;return n});X(i.reduce((o,n)=>o+n,0))}},[r==null?void 0:r.length]),l.exports.useEffect(()=>{if(r!=null&&r.length){const i=r.map(n=>{const{OccpancyRate:s}=n;return s});let o=Math.round(i.reduce((n,s)=>n+Number(s),0)/i.length);w(o)}},[r==null?void 0:r.length]),l.exports.useEffect(()=>{var i;if(r!=null&&r.length){let o=0;for(let n=0;n<(r==null?void 0:r.length);n++){let s=parseFloat((i=r[n])==null?void 0:i.totalNonight);o+=s}F(o||0)}},[r==null?void 0:r.length]),l.exports.useEffect(()=>{var i;if(r!=null&&r.length){let o=0;for(let n=0;n<(r==null?void 0:r.length);n++){let s=Number((i=r[n])==null?void 0:i.AveragePerNight);o+=s}O(o||0)}},[r==null?void 0:r.length]),l.exports.useEffect(()=>{var i;if(r!=null&&r.length){let o=0;for(let n=0;n<(r==null?void 0:r.length);n++){console.log("@@@@@3333",r);let s=Number((i=r[n])==null?void 0:i.TotalHostPayable);o+=s}console.log("totalbookednights",o),Z(o||0)}},[r==null?void 0:r.length]),l.exports.useEffect(()=>{fetch("http://dev-rare.srp.ai/property").then(i=>i.json()).then(i=>{const o=i==null?void 0:i.map(n=>({label:n.unitnumber+" | "+n.communityname+" | "+n.projectname+" | "+n.buildingname,value:n._id}));z(o)})},[]),l.exports.useEffect(()=>{(async()=>{if(t!=null&&t.propertyid){const n=await(await fetch(`http://dev-rare.srp.ai/property/${t==null?void 0:t.propertyid}`)).json();n&&T(n)}})()},[t==null?void 0:t.propertyid]),l.exports.useEffect(()=>{(async()=>{const n=await(await fetch(`http://dev-rare.srp.ai/booking/summarybyDates/${t==null?void 0:t.propertyid}?fromdate=${newValue.startDate}&todate=${newValue.endDate}`)).json();K(n==null?void 0:n.data),$(n==null?void 0:n.data)})()},[]);const[Y,L]=l.exports.useState({startDate:"",endDate:""}),j=l.exports.useRef(null),R=async()=>{const o=await(await fetch(`http://dev-rare.srp.ai/booking/summary/${t==null?void 0:t.propertyid}`)).json();D(o.data),console.log("=============>",o)};l.exports.useEffect(()=>{if(g!=null&&g.length&&(t==null?void 0:t.propertyid)&&(t==null?void 0:t.startDate)&&(t==null?void 0:t.endDate)){const i=g.filter(o=>{let n=!0;return t.propertyid&&o.propertyid!==t.propertyid&&(n=!1),(o==null?void 0:o.checkindate)<(t==null?void 0:t.startDate)&&(o==null?void 0:o.checkindate)>(t==null?void 0:t.endDate)&&(n=!1),n});D(i)}R()},[t==null?void 0:t.propertyid,t==null?void 0:t.startDate,t==null?void 0:t.endDate,g]);const U=()=>{P(""),d({...t,filteredDates:[]}),L({startDate:null,endDate:null})},B=async i=>{if(T(!0),console.log("newValue",i),P(i),!i){d({...t,filteredDates:[]});return}const n=await(await fetch(`http://dev-rare.srp.ai/booking/summarybyDates/${t==null?void 0:t.propertyid}?fromdate=${i.startDate}&todate=${i.endDate}`)).json();n.data.length==0&&ie.error("No Data Found against this Property",{position:"top-right",autoClose:1500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),T(!1);let s=_;d({...t,filteredDates:n==null?void 0:n.data});const a={owner_name:s.owner_name,building_name:s.building_name,community_name:s.communityname,project_name:s.project_name,unitnumber:s.unitnumber};A(a),K({filteredData:n==null?void 0:n.data,PropertyData:a})};function C(i){const{filteredData:o,PropertyData:n}=i;let s=[];s.push(n),console.log("122222",s);const a=new de.Workbook,e=a.addWorksheet("CombinedSheet");if(e.mergeCells("A1:W1"),e.addRow(["PROPERTY DETAIL"]),e.columns=[{header:"Landlord Name",key:"owner_name",width:30},{header:"Community Name",key:"community_name",width:40},{header:"Project Name",key:"project_name",width:25},{header:"Apartment No",key:"unitnumber",width:25},{header:"Building No",key:"building_name",width:25},{header:"",key:"",width:20},{header:"",key:"",width:55},{header:"",key:"",width:55}],s){console.log("PropertyData",n),[["Landlord Name","Community Name","Project Name","Apartment No","Building No"],...s.map(p=>[p.owner_name,p.community_name,p.project_name,p.unitnumber,p.building_name])].forEach(p=>{e.addRow(p)}),e.addRow([]),e.addRow([]);const m=e.addRow(["MONTHWISE BOOKING SUMMARY"]);e.addRow([]),m.eachCell(p=>{p.font={size:11}})}const h=e.addRow(["MONTH / PERIOD","TOTAL AVAILABLE NUMBER OF NIGHTS / MONTH","NO OF NIGHTS BOOKED","AVERAGE RATE PER NIGHT","OCCUPANCY RATE","REFUND /CANCELLATIONT","TOTAL BOOKING AMOUNT"]);if(o){o.forEach(m=>{e.addRow([m==null?void 0:m.TimePerid,m==null?void 0:m.TotalDaysinMonth,m==null?void 0:m.No_of_Booked_Nights,Number(m==null?void 0:m.AveragePerNight).toFixed(2),m==null?void 0:m.OccpancyRate,"NOT AVAILABLE",m==null?void 0:m.TotalHostPayable])}),e.addRow([]);const f=e.addRow(["TOTAL",(I==null?void 0:I.toLocaleString())+" Available Nights",(M==null?void 0:M.toLocaleString())+" Booked Nights",(S==null?void 0:S.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))+" AED",(G==null?void 0:G.toLocaleString())+"%","",(H==null?void 0:H.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))+" AED"]);{const m={type:"pattern",pattern:"solid",fgColor:{argb:"808080"}};f.fill=m,h.fill=m;const p={argb:"FFFFFF"};[f,h].forEach(x=>{x.eachCell({includeEmpty:!0},te=>{te.font={color:p}})})}}e.getRow(2).font={bold:!0},e.getRow(2).fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},e.getRow(3).fill={type:"pattern",pattern:"solid",fgColor:{argb:"808080"}},e.getRow(7).fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},e.getRow(2).font={color:{argb:"FFFFFF"}},e.getRow(3).font={color:{argb:"FFFFFF"}},e.getRow(7).font={color:{argb:"FFFFFF"}},e.getRow(7).alignment={horizontal:"center"},a.xlsx.writeBuffer().then(f=>{const m=new Blob([f],{type:"application/octet-stream"}),p=URL.createObjectURL(m),x=document.createElement("a");x.href=p,x.download="booking-"+new Date+".xlsx",document.body.appendChild(x),x.click(),document.body.removeChild(x)})}return c(N,{children:c("div",{className:"xl:col-span-2 col-span-1",children:u(ne,{title:"Booking Summary",children:[(t==null?void 0:t.filteredDates)&&((b=t==null?void 0:t.filteredDates)==null?void 0:b.length)&&c(N,{children:c("div",{className:"flex flex-row-reverse",children:u("button",{className:"h-[34px] rounded-[10px] relative bg-white border1px flex items-center gap-x-[10px] justify-around px-[10px] py-[5px] cursor-pointer",onClick:()=>C(q),children:[c("img",{src:me,alt:"Excel icon",className:"w-[20px] h-[20px] noselect"}),c("p",{className:"text-[14px] leading regular color-black",children:"Export in Excel"})]})})}),u("div",{children:[u("form",{className:"lg:grid-cols-3 grid gap-5 grid-cols-1 ",children:[c("div",{className:"w-[100%] col-span-3",children:c("h4",{className:"text-base text-slate-800 dark:text-slate-300 mb-[0.5rem] mt-[0.5rem]",children:"Select Property"})}),c("div",{className:"w-[100%] col-span-3",children:c(ce,{label:"Basic Select",className:"react-select",classNamePrefix:"select",options:v,value:v&&E?v.filter(function(i){return i.value===(t==null?void 0:t.propertyid)}):v.filter(function(i){return i.value===(t==null?void 0:t.propertyid)}),onChange:i=>{E?U():d({...t,propertyid:i==null?void 0:i.value})},styles:ue,id:"hh",placeholder:"Select and Search property"})})]}),console.log("userData222=========HJKL=====>",t),t.propertyid&&c(N,{children:u("div",{className:"flex justify-end mt-[25px]",children:[c("div",{className:"w-[150px]",children:c("div",{className:"date-range-custom relative",children:c(oe,{value:Y,inputClassName:"input-class",containerClassName:"container-class",onChange:B,placeholder:"SELECT DATE"})})}),E&&c("div",{className:"flex justify-end",children:c("div",{className:"w-[90px]",children:c("div",{className:"date-range-custom relative",children:c("button",{className:"btn btn-dark text-white  text-center",type:"button",onClick:U,children:"Reset"})})})})]})})]}),(V=t.filteredDates)!=null&&V.length?c(N,{children:c(ee,{allBooking:t.filteredDates,propertyData:W,ref:j})}):c(N,{children:c(ee,{allBooking:r,propertyData:_,ref:j})})]})})})};export{be as default};
