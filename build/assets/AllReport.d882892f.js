import{R as D,r as c,b as F,j as a,F as p,c as d,c5 as B,c6 as w,C as ee,aq as te,b$ as le}from"./index.9c545f0d.js";import{D as ae}from"./index.esm.4d6f4c98.js";import"./jspdf.es.min.f8217811.js";import"./html2canvas.esm.0eae2bf4.js";import{E as se}from"./exceljs.min.808389a6.js";import{E as ie}from"./excel.9601f4f9.js";const ne=D.forwardRef(({allBooking:t,propertyData:n,loadingPropertyforData:o},S)=>{const u=[{Header:"Sr no",accessor:"id",Cell:({row:e,flatRows:s})=>a("span",{children:s.indexOf(e)+1})},{Header:"Guest Name",accessor:"guestname",Cell:e=>{var s,l;return a("div",{children:a("span",{className:"inline-flex items-center",children:a("span",{className:"text-sm text-slate-600 dark:text-slate-300",children:(s=e==null?void 0:e.cell)!=null&&s.value?(l=e==null?void 0:e.cell)==null?void 0:l.value:"Not Available"})})})}},{Header:"Booking Date",accessor:"reservation_date",Cell:e=>{var s,l;return a("span",{children:(s=e==null?void 0:e.cell)!=null&&s.value?new Date((l=e==null?void 0:e.cell)==null?void 0:l.value).toDateString():"Not Available"})}},{Header:"Confirmation Code",accessor:"confirmationcode",Cell:e=>{var s,l;return a("span",{children:(s=e==null?void 0:e.cell)!=null&&s.value?(l=e==null?void 0:e.cell)==null?void 0:l.value:"Not Available"})}},{Header:"Check in Date",accessor:"checkindate",Cell:e=>{var s,l;return a("span",{children:(s=e==null?void 0:e.cell)!=null&&s.value?(l=e==null?void 0:e.cell)==null?void 0:l.value:"Not Available"})},sortType:(e,s,l,i)=>B(e,s,l,i)},{Header:"Check out Date",accessor:"checkoutdate",Cell:e=>{var s,l;return a("span",{children:(s=e==null?void 0:e.cell)!=null&&s.value?(l=e==null?void 0:e.cell)==null?void 0:l.value:"Not Available"})},sortType:(e,s,l,i)=>w(e,s,l,i)},{Header:"NO OF NIGHTS STAYED",accessor:"nonight",Cell:e=>{var s,l;return a("span",{children:(s=e==null?void 0:e.cell)!=null&&s.value?(l=e==null?void 0:e.cell)==null?void 0:l.value:"0.00"})}},{Header:"RATE PER NIGHT",accessor:"tourismfee",Cell:e=>{var r,E,T,R,K,q,W,V,Y,J,Q,X;let s=(T=(E=(r=e==null?void 0:e.cell)==null?void 0:r.row)==null?void 0:E.original)!=null&&T.nonight?parseFloat((q=(K=(R=e==null?void 0:e.cell)==null?void 0:R.row)==null?void 0:K.original)==null?void 0:q.nonight):0,i=((Y=(V=(W=e==null?void 0:e.cell)==null?void 0:W.row)==null?void 0:V.original)!=null&&Y.roomrenthostpayable?parseFloat((X=(Q=(J=e==null?void 0:e.cell)==null?void 0:J.row)==null?void 0:Q.original)==null?void 0:X.roomrenthostpayable):0)/s;return a("span",{children:i?parseFloat(i).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})+" AED":"0.00"})}},{Header:"BOOKING AMOUNT",accessor:"roomrenthostpayable",Cell:e=>{var s,l;return a("span",{children:(s=e==null?void 0:e.cell)!=null&&s.value?parseFloat((l=e==null?void 0:e.cell)==null?void 0:l.value).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})+" AED":"0.00"})}}],y=c.exports.useMemo(()=>u,[]),v=c.exports.useMemo(()=>t),C=F.exports.useTable({columns:y,data:v,initialState:{pageIndex:0,pageSize:50}},F.exports.useGlobalFilter,F.exports.useSortBy,F.exports.usePagination,F.exports.useRowSelect),{getTableProps:f,getTableBodyProps:P,headerGroups:O,footerGroups:k,page:x,nextPage:H,previousPage:Z,canNextPage:j,canPreviousPage:b,pageOptions:z,state:g,gotoPage:M,pageCount:L,setPageSize:$,setGlobalFilter:U,prepareRow:_}=C,[h,G]=c.exports.useState(0),[m,I]=c.exports.useState(0),[N,A]=c.exports.useState(0);return c.exports.useEffect(()=>{var e;if(t!=null&&t.length){let s=0;for(let l=0;l<(t==null?void 0:t.length);l++){let i=parseFloat((e=t[l])==null?void 0:e.nonight);s+=i}G(s||0)}},[t==null?void 0:t.length]),c.exports.useEffect(()=>{if(t!=null&&t.length){let l=t.filter(i=>i.roomrenthostpayable!==void 0?i.roomrenthostpayable:null).map(i=>Number(i.roomrenthostpayable)).reduce((i,r)=>i+r,0);console.log("mmmmmmmmmmmm333",l),I(l.toFixed(2))}},[t==null?void 0:t.length]),c.exports.useEffect(()=>{if(h&&m){let e=m/h;A(e)}},[h,m]),a(p,{children:d("div",{ref:S,children:[d("div",{className:"mt-[25px]",children:[d("div",{className:"flex gap-x-[10px]",children:[a("p",{className:"font-semibold",children:"Landlord Name: "}),a("p",{className:"capitalize",children:n!=null&&n.owner_name?n==null?void 0:n.owner_name:"Not Available"})]}),d("div",{className:"flex gap-x-[10px]",children:[a("p",{className:"font-semibold",children:"Community Name: "}),a("p",{className:"capitalize",children:n!=null&&n.communityname?n==null?void 0:n.communityname:"Not Available"})]}),d("div",{className:"flex gap-x-[10px]",children:[a("p",{className:"font-semibold",children:"Project Name: "}),a("p",{className:"capitalize",children:n!=null&&n.project_name?n==null?void 0:n.project_name:"Not Available"})]}),d("div",{className:"flex gap-x-[10px]",children:[a("p",{className:"font-semibold",children:"Apartment No: "}),a("p",{className:"capitalize",children:n!=null&&n.unitnumber?n==null?void 0:n.unitnumber:"Not Available"})]}),d("div",{className:"flex gap-x-[10px]",children:[a("p",{className:"font-semibold",children:"Building No: "}),a("p",{className:"capitalize",children:n!=null&&n.building_name?n==null?void 0:n.building_name:"Not Available"})]})]}),a("div",{className:"overflow-x-auto -mx-6 mt-6",children:a("div",{className:"inline-block min-w-full align-middle",children:a("div",{className:"",children:d("table",{className:"min-w-[100%] overflow-x-scroll divide-y divide-slate-100 table-fixed dark:divide-slate-700",...f,children:[a("thead",{className:"bg-slate-200 dark:bg-slate-700",children:O.map(e=>a("tr",{...e.getHeaderGroupProps(),children:e.headers.map(s=>d("th",{...s.getHeaderProps(s.getSortByToggleProps()),scope:"col",className:"table-th",children:[s.render("Header"),a("span",{children:s.isSorted?s.isSortedDesc?" \u{1F53D}":" \u{1F53C}":""})]}))}))}),d("tbody",{className:"bg-white divide-y divide-slate-100 dark:bg-slate-800 dark:divide-slate-700",...P,children:[x&&x.length>0&&x.map(e=>(_(e),a(p,{children:a("tr",{...e.getRowProps(),children:e.cells.map(s=>a("td",{...s.getCellProps(),className:"table-td",children:s.render("Cell")}))})}))),d("tr",{children:[a("td",{}),a("td",{}),a("td",{}),a("td",{}),a("td",{}),a("td",{className:"font-semibold",children:"TOTAL"}),a("td",{className:"table-td font-semibold",children:(h==null?void 0:h.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))+" Nights"}),a("td",{className:"table-td font-semibold",children:(N==null?void 0:N.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))+" AED"}),a("td",{className:"table-td font-semibold",children:(m==null?void 0:m.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))+" AED"})]})]})]})})})})]})})}),ce={option:(t,n)=>({...t,fontSize:"14px"})},ue=()=>{var N,A;const[t,n]=c.exports.useState({propertyid:"",filteredDates:[]}),[o,S]=c.exports.useState([]),[u,y]=c.exports.useState(""),[v,C]=c.exports.useState(""),[f,P]=c.exports.useState([]),[O,k]=c.exports.useState(""),[x,H]=c.exports.useState(!1),[Z,j]=c.exports.useState([]),[b,z]=c.exports.useState(0),[g,M]=c.exports.useState(0),[L,$]=c.exports.useState(0);c.exports.useEffect(()=>{var e;if(o!=null&&o.length){let s=0;for(let l=0;l<(o==null?void 0:o.length);l++){let i=parseFloat((e=o[l])==null?void 0:e.nonight);s+=i}z(s||0)}},[o==null?void 0:o.length]),c.exports.useEffect(()=>{if(o!=null&&o.length){let l=o.filter(i=>i.roomrenthostpayable!==void 0?i.roomrenthostpayable:null).map(i=>Number(i.roomrenthostpayable)).reduce((i,r)=>i+r,0);console.log("mmmmmmmmmmmm333",l),M(l.toFixed(2))}},[o==null?void 0:o.length]),c.exports.useEffect(()=>{if(b&&g){let e=g/b;$(e)}},[b,g]);function U(e){const s=new se.Workbook,l=s.addWorksheet("Sheet1");if(l.mergeCells("A1:F1"),l.addRow(["BOOKING REPORTS"]),l.addRow(["Landlord Name","Community Name","Project Name","Apartment No","Building No"]),l.columns=[{header:"Landlord Name",key:"",width:30},{header:"Community Name",key:"",width:40},{header:"Project Name",key:"",width:25},{header:"Apartment No",key:"",width:25},{header:"Building No",key:"",width:25},{header:"",key:"nonight",width:20},{header:"",key:"roomrenthostpayable",width:55}],e.forEach(i=>{l.addRow([i.owner_name,i.community_name,i.project_name,i.unitnumber,i.building_name])}),l.addRow([]),l.addRow([]),l.addRow([]),l.addRow(["GUEST NAME","BOOKING DATE","CONFIRMATION CODE","CHECK IN DATE","CHECK OUT DATE","NO OF NIGHTS STAYED","RATE PER NIGHTS","BOOKING AMOUNT"]),e){e.forEach(r=>{l.addRow([r.guestname,r.Created_At,r.confirmationcode,r.checkin_date,r.checkout_date,r.nonight,Number(L).toFixed(2),Number(g).toFixed(2)])}),l.addRow([]);const i=l.addRow(["","","","TOTAL","",b.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})+" Nights",L.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})+" AED",g.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})+" AED"]);{const r={type:"pattern",pattern:"solid",fgColor:{argb:"808080"}};i.fill=r;const E={argb:"FFFFFF"};[i].forEach(T=>{T.eachCell({includeEmpty:!0},R=>{R.font={color:E}})})}}l.getRow(2).font={color:{argb:"FFFFFF"}},l.getRow(2).fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},l.getRow(3).fill={type:"pattern",pattern:"solid",fgColor:{argb:"808080"}},l.getRow(12).fill={type:"pattern",pattern:"solid",fgColor:{argb:"808080"}},l.getRow(3).font={color:{argb:"FFFFFF"}},l.getRow(12).font={color:{argb:"FFFFFF"}},s.xlsx.writeBuffer().then(i=>{le.exports.saveAs(new Blob([i],{type:"application/octet-stream"}),"bookings.xlsx")})}c.exports.useEffect(()=>{fetch("http://dev-rare.srp.ai/property").then(e=>e.json()).then(e=>{const s=e==null?void 0:e.map(l=>({label:l.unitnumber+" | "+l.communityname+" | "+l.projectname+" | "+l.buildingname,value:l._id}));P(s)})},[]),c.exports.useEffect(()=>{(async()=>{if(t!=null&&t.propertyid){const l=await(await fetch(`http://dev-rare.srp.ai/property/${t==null?void 0:t.propertyid}`)).json();l&&k(l)}})()},[t==null?void 0:t.propertyid]),c.exports.useEffect(()=>{(async()=>{const l=await(await fetch(`http://dev-rare.srp.ai/booking/api/reservationdate?propertyid=${t==null?void 0:t.propertyid}&checkindate=${newValue.startDate}&checkindate=${newValue.endDate}`)).json();j(l==null?void 0:l.data),y(l==null?void 0:l.data)})()},[]);const[_,h]=c.exports.useState({startDate:"",endDate:""}),G=c.exports.useRef(null);c.exports.useEffect(()=>{if(u!=null&&u.length&&(t==null?void 0:t.propertyid)&&(t==null?void 0:t.startDate)&&(t==null?void 0:t.endDate)){const e=u.filter(s=>{let l=!0;return t.propertyid&&s.propertyid!==t.propertyid&&(l=!1),(s==null?void 0:s.checkindate)<(t==null?void 0:t.startDate)&&(s==null?void 0:s.checkindate)>(t==null?void 0:t.endDate)&&(l=!1),l});S(e)}},[t==null?void 0:t.propertyid,t==null?void 0:t.startDate,t==null?void 0:t.endDate,u]),console.log(t,"setUserData"),console.log(o,"allBooking");const m=()=>{C(""),n({}),h({startDate:null,endDate:null})},I=async e=>{if(H(!0),console.log("newValue",e),C(e),!e){n({...t,filteredDates:[]});return}const i=(await(await fetch(`http://dev-rare.srp.ai/booking/api/reservationdate?propertyid=${t==null?void 0:t.propertyid}&checkindate=${e.startDate}&checkoutdate=${e.endDate}`)).json()).filter(r=>r.propertyid===t.propertyid&&r.cancelled===!1);H(!1),n({...t,filteredDates:i}),S(i),j(i)};return a(p,{children:d("div",{className:"xl:col-span-2 col-span-1",children:[console.log("aaaa",o),d(ee,{title:"Booking Report",children:[(t==null?void 0:t.filteredDates)&&((N=t==null?void 0:t.filteredDates)==null?void 0:N.length)&&a(p,{children:a("div",{className:"flex flex-row-reverse",children:d("button",{className:"h-[34px] rounded-[10px] relative bg-white border1px flex items-center gap-x-[10px] justify-around px-[10px] py-[5px] cursor-pointer",onClick:()=>U(o),children:[a("img",{src:ie,alt:"Excel icon",className:"w-[20px] h-[20px] noselect"}),a("p",{className:"text-[14px] leading regular color-black",children:"Export in Excel"})]})})}),d("div",{children:[d("form",{className:"lg:grid-cols-3 grid gap-5 grid-cols-1 ",children:[a("div",{className:"w-[100%] col-span-3",children:a("h4",{className:"text-base text-slate-800 dark:text-slate-300 mb-[0.5rem] mt-[0.5rem]",children:"Select Property"})}),a("div",{className:"w-[100%] col-span-3",children:a(te,{label:"Basic Select",className:"react-select",classNamePrefix:"select",options:f,value:f&&v?f.filter(function(e){return e.value===(t==null?void 0:t.propertyid)}):f.filter(function(e){return e.value===(t==null?void 0:t.propertyid)}),onChange:e=>{v?m():n({...t,propertyid:e==null?void 0:e.value})},styles:ce,id:"hh",placeholder:"Select and Search property"})})]}),t.propertyid&&a(p,{children:d("div",{className:"flex justify-end mt-[25px]",children:[a("div",{className:"w-[150px]",children:a("div",{className:"date-range-custom relative",children:a(ae,{value:_,inputClassName:"input-class",containerClassName:"container-class",onChange:I,placeholder:"SELECT DATE"})})}),v&&a("div",{className:"flex justify-end",children:a("div",{className:"w-[90px]",children:a("div",{className:"date-range-custom relative",children:a("button",{className:"btn btn-dark text-white  text-center",type:"button",onClick:m,children:"Reset"})})})})]})})]}),x===!0?a(p,{children:a("div",{className:"flex items-center justify-center h-[100%]",children:d("svg",{className:"animate-spin ltr:-ml-1 ltr:mr-3 rtl:-mr-1 rtl:ml-3 h-6 w-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[a("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),a("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})})}):(A=t.filteredDates)!=null&&A.length?a(p,{children:a(ne,{loadingPropertyforData:x,allBooking:t.filteredDates,propertyData:O,ref:G})}):a(p,{children:a("h6",{className:"text-base text-slate-800 dark:text-slate-300 mb-[0.5rem] mt-[0.5rem]",children:"No Property Data Found"})})]})]})})};export{ue as default};
