import{R as oe,r as i,A as Ne,b as H,j as s,F as g,c as u,f as xe,aq as be}from"./index.89e71075.js";import{D as ge}from"./index.esm.6c2bbf03.js";import"./jspdf.es.min.6d9b0c0a.js";import"./html2canvas.esm.0eae2bf4.js";import{E as ve}from"./exceljs.min.7957c725.js";import{E as de}from"./excel.9601f4f9.js";const ie=oe.forwardRef(({allBooking:e,propertyData:m,fetchDetails:a=!1},j)=>{const A=[{Header:"Sr no",accessor:"id",Cell:({row:t,flatRows:c})=>s("span",{children:c.indexOf(t)+1})},{Header:"MONTH / PERIOD",accessor:"TimePerid",Cell:t=>{var c,n,N,E;return a?s("button",{onClick:()=>{var l,r;return K(m._id,(l=t==null?void 0:t.cell)!=null&&l.value?(r=t==null?void 0:t.cell)==null?void 0:r.value:"")},children:(c=t==null?void 0:t.cell)!=null&&c.value?(n=t==null?void 0:t.cell)==null?void 0:n.value:"Not Available"}):s("span",{children:(N=t==null?void 0:t.cell)!=null&&N.value?(E=t==null?void 0:t.cell)==null?void 0:E.value:"Not Available"})}},{Header:"TOTAL AVAILABLE NUMBER OF NIGHTS / MONTH",accessor:"TotalDaysinMonth",Cell:t=>{var c,n;return s("span",{children:(c=t==null?void 0:t.cell)!=null&&c.value?(n=t==null?void 0:t.cell)==null?void 0:n.value:"Not Available"})}},{Header:"NO OF NIGHTS BOOKED",accessor:"No_of_Booked_Nights",Cell:t=>{var c,n;return s("span",{children:(c=t==null?void 0:t.cell)!=null&&c.value?(n=t==null?void 0:t.cell)==null?void 0:n.value:"Not Available"})}},{Header:"AVERAGE RATE PER NIGHT",accessor:"AveragePerNight",Cell:t=>{var c,n;return u("span",{className:"text-[12px]",children:[s("strong",{children:"AED"})," ",(c=t==null?void 0:t.cell)!=null&&c.value?Number((n=t==null?void 0:t.cell)==null?void 0:n.value).toFixed(2):"Not Available"]})}},{Header:"OCCUPANCY RATE",accessor:"OccpancyRate",Cell:t=>{var c,n;return s("span",{children:(c=t==null?void 0:t.cell)!=null&&c.value?Math.round(Number((n=t==null?void 0:t.cell)==null?void 0:n.value).toFixed(2))+" %":"Not Available"})}},{Header:"REFUND /CANCELLATION",accessor:"refund",Cell:t=>{var c,n;return s("span",{children:(c=t==null?void 0:t.cell)!=null&&c.value?(n=t==null?void 0:t.cell)==null?void 0:n.value:"Not Available"})}},{Header:"TOTAL BOOKING AMOUNT",accessor:"TotalHostPayable",Cell:t=>{var c,n;return u("span",{className:"text-[12px]",children:[s("strong",{children:"AED"})," ",(c=t==null?void 0:t.cell)!=null&&c.value?Number((n=t==null?void 0:t.cell)==null?void 0:n.value).toFixed(2):"Not Available"]})}}],z=i.exports.useMemo(()=>A,[]),F=i.exports.useMemo(()=>e),I=Ne(),T=H.exports.useTable({columns:z,data:F,initialState:{pageIndex:0,pageSize:50}},H.exports.useGlobalFilter,H.exports.useSortBy,H.exports.usePagination,H.exports.useRowSelect),{getTableProps:V,getTableBodyProps:f,headerGroups:R,footerGroups:me,page:P,nextPage:W,previousPage:Q,canNextPage:Y,canPreviousPage:G,pageOptions:X,state:Z,gotoPage:$,pageCount:he,setPageSize:ue,setGlobalFilter:w,prepareRow:k}=T,[_,B]=i.exports.useState(0),[C,ee]=i.exports.useState(0),[O,te]=i.exports.useState(0),[L,se]=i.exports.useState(0),[ae,ce]=i.exports.useState(0),[M,J]=i.exports.useState(0),[ne,U]=i.exports.useState(0);i.exports.useEffect(()=>{if(e!=null&&e.length){const t=e.map(c=>{const{TotalDaysinMonth:n}=c;return n});B(t.reduce((c,n)=>c+n,0))}},[e==null?void 0:e.length]),i.exports.useEffect(()=>{if(e!=null&&e.length){const t=e.map(c=>{const{No_of_Booked_Nights:n}=c;return n});ee(t.reduce((c,n)=>c+n,0))}},[e==null?void 0:e.length]),i.exports.useEffect(()=>{if(e!=null&&e.length){const t=e.map(n=>{const{OccpancyRate:N}=n;return N});let c=Math.round(t.reduce((n,N)=>n+Number(N),0)/t.length);se(c)}},[e==null?void 0:e.length]),i.exports.useEffect(()=>{var t;if(e!=null&&e.length){let c=0;for(let n=0;n<(e==null?void 0:e.length);n++){let N=parseFloat((t=e[n])==null?void 0:t.totalNonight);c+=N}ce(c||0)}},[e==null?void 0:e.length]),i.exports.useEffect(()=>{var t;if(e!=null&&e.length){let c=0;for(let n=0;n<(e==null?void 0:e.length);n++){let N=Number((t=e[n])==null?void 0:t.AveragePerNight);c+=N}J(c||0)}},[e==null?void 0:e.length]),i.exports.useEffect(()=>{var t;if(e!=null&&e.length){let c=0;for(let n=0;n<(e==null?void 0:e.length);n++){let N=Number((t=e[n])==null?void 0:t.TotalHostPayable);c+=N}te(c||0)}},[e==null?void 0:e.length]),i.exports.useEffect(()=>{m._id&&U(m._id)},[m._id]);function K(t,c){let n=new Date(c);if(t){let N=new Date(n.getFullYear(),n.getMonth(),1).toJSON().split("T")[0],E=new Date(n.getFullYear(),n.getMonth()+1,0).toJSON().split("T")[0],l=`/booking-reports?startDate=${N}&endDate=${E}&propertyId=${t}`;I(l)}}return s(g,{children:e&&e.length>0?s(g,{children:u("div",{ref:j,children:[u("div",{className:"mt-[25px]",children:[u("div",{className:"flex gap-x-[10px]",children:[s("p",{className:"font-semibold",children:"Landlord Name: "}),s("p",{className:"capitalize",children:m!=null&&m.owner_name?m==null?void 0:m.owner_name:"Not Available"})]}),u("div",{className:"flex gap-x-[10px]",children:[s("p",{className:"font-semibold",children:"Community Name: "}),s("p",{className:"capitalize",children:m.community_name?m.community_name:m!=null&&m.communityname?m==null?void 0:m.communityname:"Not Available"})]}),u("div",{className:"flex gap-x-[10px]",children:[s("p",{className:"font-semibold",children:"Project Name: "}),s("p",{className:"capitalize",children:m!=null&&m.project_name?m==null?void 0:m.project_name:"Not Available"})]}),u("div",{className:"flex gap-x-[10px]",children:[s("p",{className:"font-semibold",children:"Apartment No: "}),s("p",{className:"capitalize",children:m!=null&&m.unitnumber?m==null?void 0:m.unitnumber:"Not Available"})]}),u("div",{className:"flex gap-x-[10px]",children:[s("p",{className:"font-semibold",children:"Building No: "}),s("p",{className:"capitalize",children:m!=null&&m.building_name?m==null?void 0:m.building_name:"Not Available"})]})]}),s("div",{className:"overflow-x-auto -mx-6 mt-6",children:s("div",{className:"inline-block min-w-full align-middle",children:s("div",{className:"",children:u("table",{className:"min-w-[100%] overflow-x-scroll divide-y divide-slate-100 table-fixed dark:divide-slate-700",...V,children:[s("thead",{className:"bg-slate-200 dark:bg-slate-700",children:R.map(t=>s("tr",{...t.getHeaderGroupProps(),children:t.headers.map(c=>u("th",{...c.getHeaderProps(c.getSortByToggleProps()),scope:"col",className:"table-th",children:[c.render("Header"),s("span",{children:c.isSorted?c.isSortedDesc?" \u{1F53D}":" \u{1F53C}":""})]}))}))}),u("tbody",{className:"bg-white divide-y divide-slate-100 dark:bg-slate-800 dark:divide-slate-700",...f,children:[P&&P.length>0&&P.map(t=>(k(t),s(g,{children:s("tr",{...t.getRowProps(),children:t.cells.map(c=>s("td",{...c.getCellProps(),className:"table-td",children:c.render("Cell")}))})}))),u("tr",{children:[s("td",{}),s("td",{className:"font-semibold",children:"TOTAL"}),u("td",{className:"table-td font-semibold",children:[_==null?void 0:_.toLocaleString()," Available Nights"]}),u("td",{className:"table-td font-semibold",children:[C==null?void 0:C.toLocaleString()," Booked Nights"]}),u("td",{className:"table-td font-semibold",children:["AED ",M==null?void 0:M.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),u("td",{className:"table-td font-semibold",children:[L==null?void 0:L.toLocaleString()," %"]}),s("td",{}),u("td",{className:"table-td font-semibold",children:["AED ",O==null?void 0:O.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),s("td",{})]})]})]})})})})]})}):s(g,{children:s("h6",{className:"text-base text-slate-800 dark:text-slate-300 mb-[0.5rem] mt-[0.5rem]",children:"No Property Data Found"})})})}),Se={option:(e,m)=>({...e,fontSize:"14px"})},Ae=()=>{var N,E;const[e,m]=i.exports.useState({propertyid:"",filteredDates:[]}),[a,j]=i.exports.useState([]),[A,z]=i.exports.useState(""),[F,I]=i.exports.useState(""),[T,V]=i.exports.useState([]),[f,R]=i.exports.useState(""),[me,P]=i.exports.useState(""),[W,Q]=i.exports.useState({}),[Y,G]=i.exports.useState({PropertyData:{},filteredData:[]}),[X,Z]=i.exports.useState({PropertyData:{},filteredData:[]}),[$,he]=i.exports.useState([]),[ue,w]=i.exports.useState(""),[k,_]=i.exports.useState(0),[B,C]=i.exports.useState(0),[ee,O]=i.exports.useState(0),[te,L]=i.exports.useState(0),[se,ae]=i.exports.useState(0),[ce,M]=i.exports.useState(0);i.exports.useEffect(()=>{if(a!=null&&a.length){const l=a.map(r=>{const{TotalDaysinMonth:d}=r;return d});console.log("days"),_(l.reduce((r,d)=>r+d,0))}},[a==null?void 0:a.length]),i.exports.useEffect(()=>{if(a!=null&&a.length){const l=a.map(r=>{const{No_of_Booked_Nights:d}=r;return d});C(l.reduce((r,d)=>r+d,0))}},[a==null?void 0:a.length]),i.exports.useEffect(()=>{if(a!=null&&a.length){const l=a.map(d=>{const{OccpancyRate:h}=d;return h});let r=Math.round(l.reduce((d,h)=>d+Number(h),0)/l.length);L(r)}},[a==null?void 0:a.length]),i.exports.useEffect(()=>{var l;if(a!=null&&a.length){let r=0;for(let d=0;d<(a==null?void 0:a.length);d++){let h=parseFloat((l=a[d])==null?void 0:l.totalNonight);r+=h}ae(r||0)}},[a==null?void 0:a.length]),i.exports.useEffect(()=>{var l;if(a!=null&&a.length){let r=0;for(let d=0;d<(a==null?void 0:a.length);d++){let h=Number((l=a[d])==null?void 0:l.AveragePerNight);r+=h}M(r||0)}},[a==null?void 0:a.length]),i.exports.useEffect(()=>{var l;if(a!=null&&a.length){let r=0;for(let d=0;d<(a==null?void 0:a.length);d++){let h=Number((l=a[d])==null?void 0:l.TotalHostPayable);r+=h}console.log("totalbookednights",r),O(r||0)}},[a==null?void 0:a.length]),i.exports.useEffect(()=>{fetch("http://portals.rarehomesgroup.com/property").then(l=>l.json()).then(l=>{const r=l==null?void 0:l.map(d=>({label:d.unitnumber+" | "+d.communityname+" | "+d.projectname+" | "+d.buildingname,value:d._id}));V(r)})},[]),i.exports.useEffect(()=>{(async()=>{if(e!=null&&e.propertyid){w(e.propertyid);const d=await(await fetch(`http://portals.rarehomesgroup.com/property/${e==null?void 0:e.propertyid}`)).json();G($==null?void 0:$.data),d&&R(d)}})()},[e==null?void 0:e.propertyid]),i.exports.useEffect(()=>{(async()=>{if(e!=null&&e.propertyid){let r=`http://portals.rarehomesgroup.com/booking/summarybyDates/${e==null?void 0:e.propertyid}`;newValue&&(newValue==null?void 0:newValue.startDate)&&(newValue==null?void 0:newValue.endDate)&&(r+=`?fromdate=${newValue.startDate}&todate=${newValue.endDate}`);const h=await(await fetch(r)).json();G(h==null?void 0:h.data),z(h==null?void 0:h.data)}})()},[]);const[J,ne]=i.exports.useState({startDate:"",endDate:""}),U=i.exports.useRef(null),K=async()=>{if(e!=null&&e.propertyid){let l=new Date().toISOString(),r=new Date(l).getFullYear(),d=new Date(l).getMonth(),h=new Date(r,d+1,0).toJSON().split("T")[0],v=new Date(r,new Date(l).getMonth()-5,1).toJSON().split("T")[0],p=`http://portals.rarehomesgroup.com/booking/summarybyDates/${e==null?void 0:e.propertyid}`;v&&h&&(p+=`?fromdate=${v}&todate=${h}`);const S=await(await fetch(p)).json();j(S.data?S.data:[]);const D={owner_name:f==null?void 0:f.owner_name,building_name:f==null?void 0:f.building_name,community_name:f==null?void 0:f.communityname,project_name:f==null?void 0:f.project_name,unitnumber:f==null?void 0:f.unitnumber};G({filteredData:S==null?void 0:S.data,PropertyData:D})}};i.exports.useEffect(()=>{if(A!=null&&A.length&&(e==null?void 0:e.propertyid)&&(e==null?void 0:e.startDate)&&(e==null?void 0:e.endDate)){const l=A.filter(r=>{let d=!0;return e.propertyid&&r.propertyid!==e.propertyid&&(d=!1),(r==null?void 0:r.checkindate)<(e==null?void 0:e.startDate)&&(r==null?void 0:r.checkindate)>(e==null?void 0:e.endDate)&&(d=!1),d});j(l)}K()},[e==null?void 0:e.propertyid,e==null?void 0:e.startDate,e==null?void 0:e.endDate,A,Y]);const t=()=>{I(""),m({...e,filteredDates:[]}),ne({startDate:null,endDate:null})},c=async l=>{if(R(!0),I(l),!l){m({...e,filteredDates:[]});return}const d=await(await fetch(`http://portals.rarehomesgroup.com/booking/summarybyDates/${e==null?void 0:e.propertyid}?fromdate=${l.startDate}&todate=${l.endDate}`)).json();R(!1);let h=f;m({...e,filteredDates:d==null?void 0:d.data});const v={owner_name:h.owner_name,building_name:h.building_name,community_name:h.communityname,project_name:h.project_name,unitnumber:h.unitnumber};Q(v),P(v),Z({filteredData:d==null?void 0:d.data,PropertyData:v})};function n(l){var S,D,re,le;const{filteredData:r,PropertyData:d}=l;let h=[];h.push(d),console.log("122222",h,r);const v=new ve.Workbook,p=v.addWorksheet("CombinedSheet");p.mergeCells("A1:W1"),p.addRow(["PROPERTY SUMMARY"]),p.columns=[{header:"Landlord Name",key:"owner_name",width:30},{header:"Community Name",key:"community_name",width:40},{header:"Project Name",key:"project_name",width:25},{header:"Apartment No",key:"unitnumber",width:25},{header:"Building No",key:"building_name",width:25},{header:"",key:"",width:20},{header:"",key:"",width:55},{header:"",key:"",width:55}],h&&(console.log("PropertyData",d),[["Landlord Name","Community Name","Project Name","Apartment No","Building No"],...h.map(b=>[b.owner_name,b.community_name,b.project_name,b.unitnumber,b.building_name])].forEach(b=>{p.addRow(b)}),p.addRow([]),p.addRow([]));const q=p.addRow(["MONTH / PERIOD","TOTAL AVAILABLE NUMBER OF NIGHTS / MONTH","NO OF NIGHTS BOOKED","AVERAGE RATE PER NIGHT","OCCUPANCY RATE","REFUND /CANCELLATION","TOTAL BOOKING AMOUNT"]);if(r){r.forEach(o=>{p.addRow([o==null?void 0:o.TimePerid,o==null?void 0:o.TotalDaysinMonth,o==null?void 0:o.No_of_Booked_Nights,Number(o==null?void 0:o.AveragePerNight).toFixed(2),Math.round(Number(o==null?void 0:o.OccpancyRate).toFixed(0))+"%","NOT AVAILABLE",o==null?void 0:o.TotalHostPayable])}),p.addRow([]);const y=r.map(o=>Number(o.AveragePerNight)).reduce((o,x)=>o+x,0),b=p.addRow(["TOTAL",((S=r.map(o=>Number(o.TotalDaysinMonth)).reduce((o,x)=>o+x,0))==null?void 0:S.toLocaleString())+" Available Nights",((D=r.map(o=>Number(o.No_of_Booked_Nights)).reduce((o,x)=>o+x,0))==null?void 0:D.toLocaleString())+"  Booked Nights","AED "+(y==null?void 0:y.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})),Math.round(Number(r.map(o=>Number(o.OccpancyRate)).reduce((o,x)=>o+x,0)/r.length).toFixed(0))+"%","","AED "+((le=(re=r.map(o=>Number(o.TotalHostPayable)).reduce((o,x)=>o+x,0))==null?void 0:re.toLocaleString())==null?void 0:le.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))]);{const o={type:"pattern",pattern:"solid",fgColor:{argb:"808080"}};b.fill=o,q.fill=o;const x={argb:"FFFFFF"};[b,q].forEach(pe=>{pe.eachCell({includeEmpty:!0},fe=>{fe.font={color:x}})})}}p.getRow(2).font={bold:!0},p.getRow(2).fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},p.getRow(3).fill={type:"pattern",pattern:"solid",fgColor:{argb:"808080"}},p.getRow(7).fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},p.getRow(2).font={color:{argb:"FFFFFF"}},p.getRow(3).font={color:{argb:"FFFFFF"}},p.getRow(7).font={color:{argb:"FFFFFF"}},p.getRow(7).alignment={horizontal:"center"},v.xlsx.writeBuffer().then(y=>{const b=new Blob([y],{type:"application/octet-stream"}),o=URL.createObjectURL(b),x=document.createElement("a");x.href=o,x.download="booking-"+new Date+".xlsx",document.body.appendChild(x),x.click(),document.body.removeChild(x)})}return s(g,{children:s("div",{className:"xl:col-span-2 col-span-1",children:u(xe,{title:"Booking Summary",children:[e.propertyid?(e==null?void 0:e.filteredDates)&&((N=e==null?void 0:e.filteredDates)==null?void 0:N.length)?s(g,{children:s("div",{className:"flex flex-row-reverse",children:u("button",{className:"h-[34px] rounded-[10px] relative bg-white border1px flex items-center gap-x-[10px] justify-around px-[10px] py-[5px] cursor-pointer",onClick:()=>n(X),children:[s("img",{src:de,alt:"Excel icon",className:"w-[20px] h-[20px] noselect"}),s("p",{className:"text-[14px] leading regular color-black",children:"Export in Excel"})]})})}):s(g,{children:s("div",{className:"flex flex-row-reverse",children:u("button",{className:"h-[34px] rounded-[10px] relative bg-white border1px flex items-center gap-x-[10px] justify-around px-[10px] py-[5px] cursor-pointer",onClick:()=>n(Y),children:[s("img",{src:de,alt:"Excel icon",className:"w-[20px] h-[20px] noselect"}),s("p",{className:"text-[14px] leading regular color-black",children:"Export in Excel"})]})})}):null,u("div",{children:[u("form",{className:"lg:grid-cols-3 grid gap-5 grid-cols-1 ",children:[s("div",{className:"w-[100%] col-span-3",children:s("h4",{className:"text-base text-slate-800 dark:text-slate-300 mb-[0.5rem] mt-[0.5rem]",children:"Select Property"})}),s("div",{className:"w-[100%] col-span-3",children:s(be,{label:"Basic Select",className:"react-select",classNamePrefix:"select",options:T,value:T&&F?T.filter(function(l){return l.value===(e==null?void 0:e.propertyid)}):T.filter(function(l){return l.value===(e==null?void 0:e.propertyid)}),onChange:l=>{F?t():m({...e,propertyid:l==null?void 0:l.value})},styles:Se,id:"hh",placeholder:"Select and Search property"})})]}),e.propertyid&&s(g,{children:u("div",{className:"flex justify-end mt-[25px]",children:[s("div",{className:"w-[150px]",children:s("div",{className:"date-range-custom relative",children:s(ge,{value:J,inputClassName:"input-class",containerClassName:"container-class",onChange:c,placeholder:"SELECT DATE"})})}),F&&s("div",{className:"flex justify-end",children:s("div",{className:"w-[90px]",children:s("div",{className:"date-range-custom relative",children:s("button",{className:"btn btn-dark text-white  text-center",type:"button",onClick:t,children:"Reset"})})})})]})})]}),(E=e.filteredDates)!=null&&E.length?s(g,{children:s(ie,{allBooking:e.filteredDates,propertyData:W,ref:U,fetchDetails:!0})}):s(g,{children:f?s(ie,{allBooking:a,propertyData:f,ref:U,fetchDetails:!0}):""})]})})})},_e=oe.memo(Ae);export{_e as default};
