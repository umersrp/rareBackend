import{R as D,r as c,b as F,j as s,F as p,c as d,c5 as B,c6 as w,C as ee,aq as te,b$ as le}from"./index.6fb0040c.js";import{D as se}from"./index.esm.76ae1f68.js";import"./jspdf.es.min.93e5cc49.js";import"./html2canvas.esm.0eae2bf4.js";import{E as ae}from"./exceljs.min.bca574b5.js";import{E as ie}from"./excel.9601f4f9.js";const ne=D.forwardRef(({allBooking:t,propertyData:n,loadingPropertyforData:r},S)=>{const u=[{Header:"Sr no",accessor:"id",Cell:({row:e,flatRows:a})=>s("span",{children:a.indexOf(e)+1})},{Header:"Guest Name",accessor:"guestname",Cell:e=>{var a,l;return s("div",{children:s("span",{className:"inline-flex items-center",children:s("span",{className:"text-sm text-slate-600 dark:text-slate-300",children:(a=e==null?void 0:e.cell)!=null&&a.value?(l=e==null?void 0:e.cell)==null?void 0:l.value:"Not Available"})})})}},{Header:"Booking Date",accessor:"reservation_date",Cell:e=>{var a,l;return s("span",{children:(a=e==null?void 0:e.cell)!=null&&a.value?new Date((l=e==null?void 0:e.cell)==null?void 0:l.value).toDateString():"Not Available"})}},{Header:"Confirmation Code",accessor:"confirmationcode",Cell:e=>{var a,l;return s("span",{children:(a=e==null?void 0:e.cell)!=null&&a.value?(l=e==null?void 0:e.cell)==null?void 0:l.value:"Not Available"})}},{Header:"Check in Date",accessor:"checkindate",Cell:e=>{var a,l;return s("span",{children:(a=e==null?void 0:e.cell)!=null&&a.value?(l=e==null?void 0:e.cell)==null?void 0:l.value:"Not Available"})},sortType:(e,a,l,i)=>B(e,a,l,i)},{Header:"Check out Date",accessor:"checkoutdate",Cell:e=>{var a,l;return s("span",{children:(a=e==null?void 0:e.cell)!=null&&a.value?(l=e==null?void 0:e.cell)==null?void 0:l.value:"Not Available"})},sortType:(e,a,l,i)=>w(e,a,l,i)},{Header:"NO OF NIGHTS STAYED",accessor:"nonight",Cell:e=>{var a,l;return s("span",{children:(a=e==null?void 0:e.cell)!=null&&a.value?(l=e==null?void 0:e.cell)==null?void 0:l.value:"0.00"})}},{Header:"RATE PER NIGHT",accessor:"tourismfee",Cell:e=>{var o,E,T,R,K,q,W,V,Y,J,Q,X;let a=(T=(E=(o=e==null?void 0:e.cell)==null?void 0:o.row)==null?void 0:E.original)!=null&&T.nonight?parseFloat((q=(K=(R=e==null?void 0:e.cell)==null?void 0:R.row)==null?void 0:K.original)==null?void 0:q.nonight):0,i=((Y=(V=(W=e==null?void 0:e.cell)==null?void 0:W.row)==null?void 0:V.original)!=null&&Y.roomrenthostpayable?parseFloat((X=(Q=(J=e==null?void 0:e.cell)==null?void 0:J.row)==null?void 0:Q.original)==null?void 0:X.roomrenthostpayable):0)/a;return s("span",{children:i?parseFloat(i).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})+" AED":"0.00"})}},{Header:"BOOKING AMOUNT",accessor:"roomrenthostpayable",Cell:e=>{var a,l;return s("span",{children:(a=e==null?void 0:e.cell)!=null&&a.value?parseFloat((l=e==null?void 0:e.cell)==null?void 0:l.value).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})+" AED":"0.00"})}}],y=c.exports.useMemo(()=>u,[]),v=c.exports.useMemo(()=>t),C=F.exports.useTable({columns:y,data:v,initialState:{pageIndex:0,pageSize:50}},F.exports.useGlobalFilter,F.exports.useSortBy,F.exports.usePagination,F.exports.useRowSelect),{getTableProps:f,getTableBodyProps:P,headerGroups:O,footerGroups:k,page:x,nextPage:H,previousPage:Z,canNextPage:j,canPreviousPage:b,pageOptions:z,state:g,gotoPage:M,pageCount:L,setPageSize:$,setGlobalFilter:U,prepareRow:_}=C,[h,G]=c.exports.useState(0),[m,I]=c.exports.useState(0),[N,A]=c.exports.useState(0);return c.exports.useEffect(()=>{var e;if(t!=null&&t.length){let a=0;for(let l=0;l<(t==null?void 0:t.length);l++){let i=parseFloat((e=t[l])==null?void 0:e.nonight);a+=i}G(a||0)}},[t==null?void 0:t.length]),c.exports.useEffect(()=>{if(t!=null&&t.length){let l=t.filter(i=>i.roomrenthostpayable!==void 0?i.roomrenthostpayable:null).map(i=>Number(i.roomrenthostpayable)).reduce((i,o)=>i+o,0);console.log("mmmmmmmmmmmm333",l),I(l.toFixed(2))}},[t==null?void 0:t.length]),c.exports.useEffect(()=>{if(h&&m){let e=m/h;A(e)}},[h,m]),s(p,{children:d("div",{ref:S,children:[d("div",{className:"mt-[25px]",children:[d("div",{className:"flex gap-x-[10px]",children:[s("p",{className:"font-semibold",children:"Landlord Name: "}),s("p",{className:"capitalize",children:n!=null&&n.owner_name?n==null?void 0:n.owner_name:"Not Available"})]}),d("div",{className:"flex gap-x-[10px]",children:[s("p",{className:"font-semibold",children:"Community Name: "}),s("p",{className:"capitalize",children:n!=null&&n.communityname?n==null?void 0:n.communityname:"Not Available"})]}),d("div",{className:"flex gap-x-[10px]",children:[s("p",{className:"font-semibold",children:"Project Name: "}),s("p",{className:"capitalize",children:n!=null&&n.project_name?n==null?void 0:n.project_name:"Not Available"})]}),d("div",{className:"flex gap-x-[10px]",children:[s("p",{className:"font-semibold",children:"Apartment No: "}),s("p",{className:"capitalize",children:n!=null&&n.unitnumber?n==null?void 0:n.unitnumber:"Not Available"})]}),d("div",{className:"flex gap-x-[10px]",children:[s("p",{className:"font-semibold",children:"Building No: "}),s("p",{className:"capitalize",children:n!=null&&n.building_name?n==null?void 0:n.building_name:"Not Available"})]})]}),s("div",{className:"overflow-x-auto -mx-6 mt-6",children:s("div",{className:"inline-block min-w-full align-middle",children:s("div",{className:"",children:d("table",{className:"min-w-[100%] overflow-x-scroll divide-y divide-slate-100 table-fixed dark:divide-slate-700",...f,children:[s("thead",{className:"bg-slate-200 dark:bg-slate-700",children:O.map(e=>s("tr",{...e.getHeaderGroupProps(),children:e.headers.map(a=>d("th",{...a.getHeaderProps(a.getSortByToggleProps()),scope:"col",className:"table-th",children:[a.render("Header"),s("span",{children:a.isSorted?a.isSortedDesc?" \u{1F53D}":" \u{1F53C}":""})]}))}))}),d("tbody",{className:"bg-white divide-y divide-slate-100 dark:bg-slate-800 dark:divide-slate-700",...P,children:[x&&x.length>0&&x.map(e=>(_(e),s(p,{children:s("tr",{...e.getRowProps(),children:e.cells.map(a=>s("td",{...a.getCellProps(),className:"table-td",children:a.render("Cell")}))})}))),d("tr",{children:[s("td",{}),s("td",{}),s("td",{}),s("td",{}),s("td",{}),s("td",{className:"font-semibold",children:"TOTAL"}),s("td",{className:"table-td font-semibold",children:(h==null?void 0:h.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))+" Nights"}),s("td",{className:"table-td font-semibold",children:(N==null?void 0:N.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))+" AED"}),s("td",{className:"table-td font-semibold",children:(m==null?void 0:m.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))+" AED"})]})]})]})})})})]})})}),ce={option:(t,n)=>({...t,fontSize:"14px"})},ue=()=>{var N,A;const[t,n]=c.exports.useState({propertyid:"",filteredDates:[]}),[r,S]=c.exports.useState([]),[u,y]=c.exports.useState(""),[v,C]=c.exports.useState(""),[f,P]=c.exports.useState([]),[O,k]=c.exports.useState(""),[x,H]=c.exports.useState(!1),[Z,j]=c.exports.useState([]),[b,z]=c.exports.useState(0),[g,M]=c.exports.useState(0),[L,$]=c.exports.useState(0);c.exports.useEffect(()=>{var e;if(r!=null&&r.length){let a=0;for(let l=0;l<(r==null?void 0:r.length);l++){let i=parseFloat((e=r[l])==null?void 0:e.nonight);a+=i}z(a||0)}},[r==null?void 0:r.length]),c.exports.useEffect(()=>{if(r!=null&&r.length){let l=r.filter(i=>i.roomrenthostpayable!==void 0?i.roomrenthostpayable:null).map(i=>Number(i.roomrenthostpayable)).reduce((i,o)=>i+o,0);console.log("mmmmmmmmmmmm333",l),M(l.toFixed(2))}},[r==null?void 0:r.length]),c.exports.useEffect(()=>{if(b&&g){let e=g/b;$(e)}},[b,g]);function U(e){const a=new ae.Workbook,l=a.addWorksheet("Sheet1");if(l.mergeCells("A1:F1"),l.addRow(["BOOKING REPORTS"]),l.addRow(["Landlord Name","Community Name","Project Name","Apartment No","Building No"]),l.columns=[{header:"Landlord Name",key:"",width:30},{header:"Community Name",key:"",width:40},{header:"Project Name",key:"",width:25},{header:"Apartment No",key:"",width:25},{header:"Building No",key:"",width:25},{header:"",key:"nonight",width:20},{header:"",key:"roomrenthostpayable",width:55}],e.forEach(i=>{l.addRow([i.owner_name,i.community_name,i.project_name,i.unitnumber,i.building_name])}),l.addRow([]),l.addRow([]),l.addRow([]),l.addRow(["GUEST NAME","BOOKING DATE","CONFIRMATION CODE","CHECK IN DATE","CHECK OUT DATE","NO OF NIGHTS STAYED","RATE PER NIGHTS","BOOKING AMOUNT"]),e){e.forEach(o=>{l.addRow([o.guestname,o.Created_At,o.confirmationcode,o.checkin_date,o.checkout_date,o.nonight,Number(L).toFixed(2),Number(g).toFixed(2)])}),l.addRow([]);const i=l.addRow(["","","","TOTAL","",b.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})+" Nights",L.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})+" AED",g.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})+" AED"]);{const o={type:"pattern",pattern:"solid",fgColor:{argb:"808080"}};i.fill=o;const E={argb:"FFFFFF"};[i].forEach(T=>{T.eachCell({includeEmpty:!0},R=>{R.font={color:E}})})}}l.getRow(2).font={color:{argb:"FFFFFF"}},l.getRow(2).fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},l.getRow(3).fill={type:"pattern",pattern:"solid",fgColor:{argb:"808080"}},l.getRow(12).fill={type:"pattern",pattern:"solid",fgColor:{argb:"808080"}},l.getRow(3).font={color:{argb:"FFFFFF"}},l.getRow(12).font={color:{argb:"FFFFFF"}},a.xlsx.writeBuffer().then(i=>{le.exports.saveAs(new Blob([i],{type:"application/octet-stream"}),"bookings.xlsx")})}c.exports.useEffect(()=>{fetch("http://dev-rare.srp.ai/property").then(e=>e.json()).then(e=>{const a=e==null?void 0:e.map(l=>({label:l.unitnumber+" | "+l.communityname+" | "+l.projectname+" | "+l.buildingname,value:l._id}));P(a)})},[]),c.exports.useEffect(()=>{(async()=>{if(t!=null&&t.propertyid){const l=await(await fetch(`http://dev-rare.srp.ai/property/${t==null?void 0:t.propertyid}`)).json();l&&k(l)}})()},[t==null?void 0:t.propertyid]),c.exports.useEffect(()=>{(async()=>{const l=await(await fetch(`http://dev-rare.srp.ai/booking/api/reservationdate?propertyid=${t==null?void 0:t.propertyid}&checkindate=${newValue.startDate}&checkindate=${newValue.endDate}`)).json();j(l==null?void 0:l.data),y(l==null?void 0:l.data)})()},[]);const[_,h]=c.exports.useState({startDate:"",endDate:""}),G=c.exports.useRef(null);c.exports.useEffect(()=>{if(u!=null&&u.length&&(t==null?void 0:t.propertyid)&&(t==null?void 0:t.startDate)&&(t==null?void 0:t.endDate)){const e=u.filter(a=>{let l=!0;return t.propertyid&&a.propertyid!==t.propertyid&&(l=!1),(a==null?void 0:a.checkindate)<(t==null?void 0:t.startDate)&&(a==null?void 0:a.checkindate)>(t==null?void 0:t.endDate)&&(l=!1),l});S(e)}},[t==null?void 0:t.propertyid,t==null?void 0:t.startDate,t==null?void 0:t.endDate,u]),console.log(t,"setUserData"),console.log(r,"allBooking");const m=()=>{C(""),n({}),h({startDate:null,endDate:null})},I=async e=>{if(H(!0),console.log("newValue",e),C(e),!e){n({...t,filteredDates:[]});return}const i=(await(await fetch(`http://dev-rare.srp.ai/booking/api/reservationdate?propertyid=${t==null?void 0:t.propertyid}&checkindate=${e.startDate}&checkoutdate=${e.endDate}`)).json()).filter(o=>o.propertyid===t.propertyid&&o.cancelled===!1);H(!1),n({...t,filteredDates:i}),S(i),j(i)};return s(p,{children:s("div",{className:"xl:col-span-2 col-span-1",children:d(ee,{title:"Complete Booking Details",children:[(t==null?void 0:t.filteredDates)&&((N=t==null?void 0:t.filteredDates)==null?void 0:N.length)?s(p,{children:s("div",{className:"flex flex-row-reverse",children:d("button",{className:"h-[34px] rounded-[10px] relative bg-white border1px flex items-center gap-x-[10px] justify-around px-[10px] py-[5px] cursor-pointer",onClick:()=>U(r),children:[s("img",{src:ie,alt:"Excel icon",className:"w-[20px] h-[20px] noselect"}),s("p",{className:"text-[14px] leading regular color-black",children:"Export in Excel"})]})})}):null,d("div",{children:[d("form",{className:"lg:grid-cols-3 grid gap-5 grid-cols-1 ",children:[s("div",{className:"w-[100%] col-span-3",children:s("h4",{className:"text-base text-slate-800 dark:text-slate-300 mb-[0.5rem] mt-[0.5rem]",children:"Select Property"})}),s("div",{className:"w-[100%] col-span-3",children:s(te,{label:"Basic Select",className:"react-select",classNamePrefix:"select",options:f,value:f&&v?f.filter(function(e){return e.value===(t==null?void 0:t.propertyid)}):f.filter(function(e){return e.value===(t==null?void 0:t.propertyid)}),onChange:e=>{v?m():n({...t,propertyid:e==null?void 0:e.value})},styles:ce,id:"hh",placeholder:"Select and Search property"})})]}),t.propertyid&&s(p,{children:d("div",{className:"flex justify-end mt-[25px]",children:[s("div",{className:"w-[150px]",children:s("div",{className:"date-range-custom relative",children:s(se,{value:_,inputClassName:"input-class",containerClassName:"container-class",onChange:I,placeholder:"SELECT DATE"})})}),v&&s("div",{className:"flex justify-end",children:s("div",{className:"w-[90px]",children:s("div",{className:"date-range-custom relative",children:s("button",{className:"btn btn-dark text-white  text-center",type:"button",onClick:m,children:"Reset"})})})})]})})]}),x===!0?s(p,{children:s("div",{className:"flex items-center justify-center h-[100%]",children:d("svg",{className:"animate-spin ltr:-ml-1 ltr:mr-3 rtl:-mr-1 rtl:ml-3 h-6 w-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[s("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})})}):(A=t.filteredDates)!=null&&A.length?s(p,{children:s(ne,{loadingPropertyforData:x,allBooking:t.filteredDates,propertyData:O,ref:G})}):s(p,{children:s("h6",{className:"text-base text-slate-800 dark:text-slate-300 mb-[0.5rem] mt-[0.5rem]",children:"No Property Data Found"})})]})})})};export{ue as default};
