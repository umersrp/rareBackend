import{R as ee,r,A as te,b as y,j as s,F as b,c as p,C as se,aq as ae,Q as ne}from"./index.4d3efcf7.js";import{D as ce}from"./index.esm.e0979674.js";import"./jspdf.es.min.73f0fece.js";import"./html2canvas.esm.0eae2bf4.js";import{E as Q}from"./exceljs.min.2271767a.js";import{E as le}from"./excel.9601f4f9.js";const w=ee.forwardRef(({allBooking:e,propertyData:c,fetchDetails:$=!1},P)=>{console.log("report table",c);const v=[{Header:"Sr no",accessor:"id",Cell:({row:t,flatRows:a})=>s("span",{children:a.indexOf(t)+1})},{Header:"MONTH / PERIOD",accessor:"TimePerid",Cell:t=>{var a,n,N,G;return $?s("button",{onClick:()=>{var U,J;return x(c._id,(U=t==null?void 0:t.cell)!=null&&U.value?(J=t==null?void 0:t.cell)==null?void 0:J.value:"")},children:(a=t==null?void 0:t.cell)!=null&&a.value?(n=t==null?void 0:t.cell)==null?void 0:n.value:"Not Available"}):s("span",{children:(N=t==null?void 0:t.cell)!=null&&N.value?(G=t==null?void 0:t.cell)==null?void 0:G.value:"Not Available"})}},{Header:"TOTAL AVAILABLE NUMBER OF NIGHTS / MONTH",accessor:"TotalDaysinMonth",Cell:t=>{var a,n;return s("span",{children:(a=t==null?void 0:t.cell)!=null&&a.value?(n=t==null?void 0:t.cell)==null?void 0:n.value:"Not Available"})}},{Header:"NO OF NIGHTS BOOKED",accessor:"No_of_Booked_Nights",Cell:t=>{var a,n;return s("span",{children:(a=t==null?void 0:t.cell)!=null&&a.value?(n=t==null?void 0:t.cell)==null?void 0:n.value:"Not Available"})}},{Header:"AVERAGE RATE PER NIGHT",accessor:"AveragePerNight",Cell:t=>{var a,n;return s("span",{children:(a=t==null?void 0:t.cell)!=null&&a.value?Number((n=t==null?void 0:t.cell)==null?void 0:n.value).toFixed(2):"Not Available"})}},{Header:"OCCUPANCY RATE",accessor:"OccpancyRate",Cell:t=>{var a,n;return s("span",{children:(a=t==null?void 0:t.cell)!=null&&a.value?((n=t==null?void 0:t.cell)==null?void 0:n.value)+" %":"Not Available"})}},{Header:"REFUND /CANCELLATIONT",accessor:"refund",Cell:t=>{var a,n;return s("span",{children:(a=t==null?void 0:t.cell)!=null&&a.value?(n=t==null?void 0:t.cell)==null?void 0:n.value:"Not Available"})}},{Header:"TOTAL BOOKING AMOUNT",accessor:"TotalHostPayable",Cell:t=>{var a,n;return s("span",{children:(a=t==null?void 0:t.cell)!=null&&a.value?Number((n=t==null?void 0:t.cell)==null?void 0:n.value).toFixed(2):"Not Available"})}}],V=r.exports.useMemo(()=>v,[]),E=r.exports.useMemo(()=>e),L=te(),g=y.exports.useTable({columns:V,data:E,initialState:{pageIndex:0,pageSize:50}},y.exports.useGlobalFilter,y.exports.useSortBy,y.exports.usePagination,y.exports.useRowSelect),{getTableProps:z,getTableBodyProps:T,headerGroups:R,footerGroups:X,page:O,nextPage:D,previousPage:Z,canNextPage:Y,canPreviousPage:F,pageOptions:_,state:k,gotoPage:B,pageCount:K,setPageSize:W,setGlobalFilter:q,prepareRow:I}=g,[S,H]=r.exports.useState(0),[C,j]=r.exports.useState(0),[A,M]=r.exports.useState(0),[i,o]=r.exports.useState(0),[h,u]=r.exports.useState(0),[m,l]=r.exports.useState(0),[d,f]=r.exports.useState(0);r.exports.useEffect(()=>{if(e!=null&&e.length){const t=e.map(a=>{const{TotalDaysinMonth:n}=a;return n});H(t.reduce((a,n)=>a+n,0))}},[e==null?void 0:e.length]),r.exports.useEffect(()=>{if(e!=null&&e.length){const t=e.map(a=>{const{No_of_Booked_Nights:n}=a;return n});j(t.reduce((a,n)=>a+n,0))}},[e==null?void 0:e.length]),r.exports.useEffect(()=>{if(e!=null&&e.length){const t=e.map(n=>{const{OccpancyRate:N}=n;return N});let a=Math.round(t.reduce((n,N)=>n+Number(N),0)/t.length);o(a)}},[e==null?void 0:e.length]),r.exports.useEffect(()=>{var t;if(e!=null&&e.length){let a=0;for(let n=0;n<(e==null?void 0:e.length);n++){let N=parseFloat((t=e[n])==null?void 0:t.totalNonight);a+=N}u(a||0)}},[e==null?void 0:e.length]),r.exports.useEffect(()=>{var t;if(e!=null&&e.length){let a=0;for(let n=0;n<(e==null?void 0:e.length);n++){let N=Number((t=e[n])==null?void 0:t.AveragePerNight);a+=N}l(a||0)}},[e==null?void 0:e.length]),r.exports.useEffect(()=>{var t;if(e!=null&&e.length){let a=0;for(let n=0;n<(e==null?void 0:e.length);n++){let N=Number((t=e[n])==null?void 0:t.TotalHostPayable);a+=N}M(a||0)}},[e==null?void 0:e.length]),r.exports.useEffect(()=>{c._id&&f(c._id)},[c._id]);function x(t,a){let n=new Date(a);if(t){let N=new Date(n.getFullYear(),n.getMonth(),1).toJSON().split("T")[0],G=new Date(n.getFullYear(),n.getMonth()+1,0).toJSON().split("T")[0],U=`/booking-reports?startDate=${N}&endDate=${G}&propertyId=${t}`;L(U)}}return s(b,{children:e&&e.length>0?s(b,{children:p("div",{ref:P,children:[p("div",{className:"mt-[25px]",children:[p("div",{className:"flex gap-x-[10px]",children:[s("p",{className:"font-semibold",children:"Landlord Name: "}),s("p",{className:"capitalize",children:c!=null&&c.owner_name?c==null?void 0:c.owner_name:"Not Available"})]}),p("div",{className:"flex gap-x-[10px]",children:[s("p",{className:"font-semibold",children:"Community Name: "}),s("p",{className:"capitalize",children:c!=null&&c.communityname?c==null?void 0:c.communityname:"Not Available"})]}),p("div",{className:"flex gap-x-[10px]",children:[s("p",{className:"font-semibold",children:"Project Name: "}),s("p",{className:"capitalize",children:c!=null&&c.project_name?c==null?void 0:c.project_name:"Not Available"})]}),p("div",{className:"flex gap-x-[10px]",children:[s("p",{className:"font-semibold",children:"Apartment No: "}),s("p",{className:"capitalize",children:c!=null&&c.unitnumber?c==null?void 0:c.unitnumber:"Not Available"})]}),p("div",{className:"flex gap-x-[10px]",children:[s("p",{className:"font-semibold",children:"Building No: "}),s("p",{className:"capitalize",children:c!=null&&c.building_name?c==null?void 0:c.building_name:"Not Available"})]})]}),s("div",{className:"overflow-x-auto -mx-6 mt-6",children:s("div",{className:"inline-block min-w-full align-middle",children:s("div",{className:"",children:p("table",{className:"min-w-[100%] overflow-x-scroll divide-y divide-slate-100 table-fixed dark:divide-slate-700",...z,children:[s("thead",{className:"bg-slate-200 dark:bg-slate-700",children:R.map(t=>s("tr",{...t.getHeaderGroupProps(),children:t.headers.map(a=>p("th",{...a.getHeaderProps(a.getSortByToggleProps()),scope:"col",className:"table-th",children:[a.render("Header"),s("span",{children:a.isSorted?a.isSortedDesc?" \u{1F53D}":" \u{1F53C}":""})]}))}))}),p("tbody",{className:"bg-white divide-y divide-slate-100 dark:bg-slate-800 dark:divide-slate-700",...T,children:[O&&O.length>0&&O.map(t=>(I(t),s(b,{children:s("tr",{...t.getRowProps(),children:t.cells.map(a=>s("td",{...a.getCellProps(),className:"table-td",children:a.render("Cell")}))})}))),p("tr",{children:[s("td",{className:"font-semibold",children:"TOTAL"}),s("td",{}),p("td",{className:"table-td font-semibold",children:[S==null?void 0:S.toLocaleString()," Available Nights"]}),p("td",{className:"table-td font-semibold",children:[C==null?void 0:C.toLocaleString()," Booked Nights"]}),p("td",{className:"table-td font-semibold",children:[m==null?void 0:m.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})," AED"]}),p("td",{className:"table-td font-semibold",children:[i==null?void 0:i.toLocaleString()," %"]}),s("td",{}),p("td",{className:"table-td font-semibold",children:[A==null?void 0:A.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})," AED"]}),s("td",{})]})]})]})})})})]})}):s(b,{children:s("h6",{className:"text-base text-slate-800 dark:text-slate-300 mb-[0.5rem] mt-[0.5rem]",children:"No Property Data Found"})})})}),de={option:(e,c)=>({...e,fontSize:"14px"})},pe=()=>{var A,M;const[e,c]=r.exports.useState({propertyid:"",filteredDates:[]}),[$,P]=r.exports.useState([]),[v,V]=r.exports.useState(""),[E,L]=r.exports.useState(""),[g,z]=r.exports.useState([]),[T,R]=r.exports.useState(""),[X,O]=r.exports.useState(""),[D,Z]=r.exports.useState({}),[Y,F]=r.exports.useState([]),[_,k]=r.exports.useState([]),[B,K]=r.exports.useState("");r.exports.useEffect(()=>{fetch("http://dev-rare.srp.ai/property").then(i=>i.json()).then(i=>{const o=i==null?void 0:i.map(h=>({label:h.unitnumber+" | "+h.communityname+" | "+h.projectname+" | "+h.buildingname,value:h._id}));z(o)})},[]),r.exports.useEffect(()=>{(async()=>{if(e!=null&&e.propertyid){K(e.propertyid);const h=await(await fetch(`http://dev-rare.srp.ai/property/${e==null?void 0:e.propertyid}`)).json();F(_==null?void 0:_.data),h&&R(h)}})()},[e==null?void 0:e.propertyid]),r.exports.useEffect(()=>{(async()=>{if(e!=null&&e.propertyid){let o=`http://dev-rare.srp.ai/booking/summarybyDates/${e==null?void 0:e.propertyid}`;newValue&&(newValue==null?void 0:newValue.startDate)&&(newValue==null?void 0:newValue.endDate)&&(o+=`?fromdate=${newValue.startDate}&todate=${newValue.endDate}`);const u=await(await fetch(o)).json();F(u==null?void 0:u.data),V(u==null?void 0:u.data)}})()},[]);const[W,q]=r.exports.useState({startDate:"",endDate:""}),I=r.exports.useRef(null),S=async()=>{if(e!=null&&e.propertyid){const o=await(await fetch(`http://dev-rare.srp.ai/booking/summary/${e==null?void 0:e.propertyid}`)).json();P(o.data?o.data:[])}};r.exports.useEffect(()=>{if(v!=null&&v.length&&(e==null?void 0:e.propertyid)&&(e==null?void 0:e.startDate)&&(e==null?void 0:e.endDate)){const i=v.filter(o=>{let h=!0;return e.propertyid&&o.propertyid!==e.propertyid&&(h=!1),(o==null?void 0:o.checkindate)<(e==null?void 0:e.startDate)&&(o==null?void 0:o.checkindate)>(e==null?void 0:e.endDate)&&(h=!1),h});P(i)}S()},[e==null?void 0:e.propertyid,e==null?void 0:e.startDate,e==null?void 0:e.endDate,v]);const H=()=>{L(""),c({...e,filteredDates:[]}),q({startDate:null,endDate:null})},C=async i=>{if(R(!0),L(i),!i){c({...e,filteredDates:[]});return}const h=await(await fetch(`http://dev-rare.srp.ai/booking/summarybyDates/${e==null?void 0:e.propertyid}?fromdate=${i.startDate}&todate=${i.endDate}`)).json();h.data.length==0&&ne.error("No Data Found against this Property",{position:"top-right",autoClose:1500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),R(!1);let u=T;c({...e,filteredDates:h==null?void 0:h.data});const m={owner_name:u.owner_name,building_name:u.building_name,community_name:u.communityname,project_name:u.project_name,unitnumber:u.unitnumber};O(m),F({filteredData:h==null?void 0:h.data,PropertyData:m})};function j(i){const{filteredData:o,PropertyData:h}=i;let u=[];u.push(h);const m=new Q.Workbook,l=m.addWorksheet("CombinedSheet");if(l.mergeCells("A1:E1"),l.addRow(["PROPERTY DETAIL"]),l.columns=[{header:"Landlord Name",key:"owner_name",width:40,fgColor:{argb:"008000"}},{header:"Community Name",key:"community_name",width:40,fgColor:{argb:"008000"}},{header:"Project Name",key:"project_name",width:40},{header:"Apartment No",key:"unitnumber",width:35},{header:"Building No",key:"building_name",width:55}],u){const d=[["Landlord Name","Community Name","Project Name","Apartment No","Building No"],...u==null?void 0:u.map(f=>[f.owner_name,f.community_name,f.project_name,f.unitnumber,f.building_name])];d==null||d.forEach(f=>{l.addRow(f)}),l.addRow([])}l.addRow(["MONTH / PERIOD","TOTAL AVAILABLE NUMBER OF NIGHTS / MONTH","NO OF NIGHTS BOOKED","AVERAGE RATE PER NIGHT","OCCUPANCY RATE","REFUND /CANCELLATIONT","TOTAL BOOKING AMOUNT"]),o&&(o==null||o.forEach(d=>{l.addRow([d==null?void 0:d.TimePerid,d==null?void 0:d.TotalDaysinMonth,d==null?void 0:d.No_of_Booked_Nights,d==null?void 0:d.AveragePerNight,d==null?void 0:d.OccpancyRate,d.Occp,d==null?void 0:d.TotalHostPayable])})),l.getRow(2).font={bold:!0},l.getRow(2).fill={type:"pattern",pattern:"solid",fgColor:{argb:"008000"}},l.getRow(8).fill={type:"pattern",pattern:"solid",fgColor:{argb:"008000"}},m.xlsx.writeBuffer().then(d=>{const f=new Blob([d],{type:"application/octet-stream"}),x=URL.createObjectURL(f),t=document.createElement("a");t.href=x,t.download="booking-"+new Date+".xlsx",document.body.appendChild(t),t.click(),document.body.removeChild(t)})}return s(b,{children:s("div",{className:"xl:col-span-2 col-span-1",children:p(se,{title:"Booking Summary",children:[(e==null?void 0:e.filteredDates)&&((A=e==null?void 0:e.filteredDates)==null?void 0:A.length)?s(b,{children:s("div",{className:"flex flex-row-reverse",children:p("button",{className:"h-[34px] rounded-[10px] relative bg-white border1px flex items-center gap-x-[10px] justify-around px-[10px] py-[5px] cursor-pointer",onClick:()=>j(Y),children:[s("img",{src:le,alt:"Excel icon",className:"w-[20px] h-[20px] noselect"}),s("p",{className:"text-[14px] leading regular color-black",children:"Export in Excel"})]})})}):null,p("div",{children:[p("form",{className:"lg:grid-cols-3 grid gap-5 grid-cols-1 ",children:[s("div",{className:"w-[100%] col-span-3",children:s("h4",{className:"text-base text-slate-800 dark:text-slate-300 mb-[0.5rem] mt-[0.5rem]",children:"Select Property"})}),s("div",{className:"w-[100%] col-span-3",children:s(ae,{label:"Basic Select",className:"react-select",classNamePrefix:"select",options:g,value:g&&E?g.filter(function(i){return i.value===(e==null?void 0:e.propertyid)}):g.filter(function(i){return i.value===(e==null?void 0:e.propertyid)}),onChange:i=>{E?H():c({...e,propertyid:i==null?void 0:i.value})},styles:de,id:"hh",placeholder:"Select and Search property"})})]}),e.propertyid&&s(b,{children:p("div",{className:"flex justify-end mt-[25px]",children:[s("div",{className:"w-[150px]",children:s("div",{className:"date-range-custom relative",children:s(ce,{value:W,inputClassName:"input-class",containerClassName:"container-class",onChange:C,placeholder:"SELECT DATE"})})}),E&&s("div",{className:"flex justify-end",children:s("div",{className:"w-[90px]",children:s("div",{className:"date-range-custom relative",children:s("button",{className:"btn btn-dark text-white  text-center",type:"button",onClick:H,children:"Reset"})})})})]})})]}),(M=e.filteredDates)!=null&&M.length?s(b,{children:s(w,{allBooking:e.filteredDates,propertyData:D,ref:I,fetchDetails:!0})}):s(b,{children:T?s(w,{allBooking:$,propertyData:T,ref:I,fetchDetails:!0}):""})]})})})};export{pe as default};
