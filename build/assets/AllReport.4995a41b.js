import{R as w,r as d,j as l,F as N,b as c,I as X,C as ee,an as te}from"./index.5e55c1ba.js";import{D as le}from"./index.esm.c068ea99.js";import"./jspdf.es.min.085956f0.js";import"./html2canvas.esm.0eae2bf4.js";import{r as S}from"./index.c89ffb9d.js";const se=w.forwardRef(({allBooking:t,propertyData:a},T)=>{const j=[{Header:"Sr no",accessor:"id",Cell:({row:e,flatRows:s})=>l("span",{children:s.indexOf(e)+1})},{Header:"Guest Name",accessor:"guestname",Cell:e=>{var s,n;return l("div",{children:l("span",{className:"inline-flex items-center",children:l("span",{className:"text-sm text-slate-600 dark:text-slate-300",children:(s=e==null?void 0:e.cell)!=null&&s.value?(n=e==null?void 0:e.cell)==null?void 0:n.value:"Not Available"})})})}},{Header:"Booking Date",accessor:"reservation_date",Cell:e=>{var s,n;return l("span",{children:(s=e==null?void 0:e.cell)!=null&&s.value?new Date((n=e==null?void 0:e.cell)==null?void 0:n.value).toDateString():"Not Available"})}},{Header:"Confirmation Code",accessor:"confirmationcode",Cell:e=>{var s,n;return l("span",{children:(s=e==null?void 0:e.cell)!=null&&s.value?(n=e==null?void 0:e.cell)==null?void 0:n.value:"Not Available"})}},{Header:"Check in Date",accessor:"checkindate",Cell:e=>{var s,n;return l("span",{children:(s=e==null?void 0:e.cell)!=null&&s.value?new Date((n=e==null?void 0:e.cell)==null?void 0:n.value).toDateString():"Not Available"})}},{Header:"Check out Date",accessor:"checkoutdate",Cell:e=>{var s,n;return l("span",{children:(s=e==null?void 0:e.cell)!=null&&s.value?new Date((n=e==null?void 0:e.cell)==null?void 0:n.value).toDateString():"Not Available"})}},{Header:"NO OF NIGHTS STAYED",accessor:"nonight",Cell:e=>{var s,n;return l("span",{children:(s=e==null?void 0:e.cell)!=null&&s.value?(n=e==null?void 0:e.cell)==null?void 0:n.value:"0.00"})}},{Header:"RATE PER DAY",accessor:"tourismfee",Cell:e=>{var E,z,G,I,M,U,q,Y,K,J,Q,W;let s=(G=(z=(E=e==null?void 0:e.cell)==null?void 0:E.row)==null?void 0:z.original)!=null&&G.nonight?parseFloat((U=(M=(I=e==null?void 0:e.cell)==null?void 0:I.row)==null?void 0:M.original)==null?void 0:U.nonight):0,m=((K=(Y=(q=e==null?void 0:e.cell)==null?void 0:q.row)==null?void 0:Y.original)!=null&&K.roomrenthostpayable?parseFloat((W=(Q=(J=e==null?void 0:e.cell)==null?void 0:J.row)==null?void 0:Q.original)==null?void 0:W.roomrenthostpayable):0)/s;return l("span",{children:m?parseFloat(m).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})+" AED":"0.00"})}},{Header:"BOOKING AMOUNT",accessor:"roomrenthostpayable",Cell:e=>{var s,n;return l("span",{children:(s=e==null?void 0:e.cell)!=null&&s.value?parseFloat((n=e==null?void 0:e.cell)==null?void 0:n.value).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})+" AED":"0.00"})}}],h=d.exports.useMemo(()=>j,[]),H=d.exports.useMemo(()=>t),g=S.exports.useTable({columns:h,data:H,initialState:{pageIndex:0,pageSize:50}},S.exports.useGlobalFilter,S.exports.useSortBy,S.exports.usePagination,S.exports.useRowSelect),{getTableProps:C,getTableBodyProps:x,headerGroups:R,footerGroups:k,page:b,nextPage:y,previousPage:$,canNextPage:p,canPreviousPage:u,pageOptions:A,state:F,gotoPage:i,pageCount:o,setPageSize:r,setGlobalFilter:L,prepareRow:P}=g,{globalFilter:ie,pageIndex:O,pageSize:Z}=F,[f,V]=d.exports.useState(0),[v,B]=d.exports.useState(0),[_,D]=d.exports.useState(0);return d.exports.useEffect(()=>{var e;if(t!=null&&t.length){let s=0;for(let n=0;n<(t==null?void 0:t.length);n++){let m=parseFloat((e=t[n])==null?void 0:e.nonight);s+=m}V(s||0)}},[t==null?void 0:t.length]),d.exports.useEffect(()=>{if(t!=null&&t.length){let n=t.filter(m=>m.roomrenthostpayable!==void 0?m.roomrenthostpayable:null).map(m=>Number(m.roomrenthostpayable)).reduce((m,E)=>m+E,0);B(n.toFixed(2))}},[t==null?void 0:t.length]),d.exports.useEffect(()=>{if(f&&v){let e=v/f;D(e)}},[f,v]),l(N,{children:c("div",{ref:T,children:[c("div",{className:"mt-[25px]",children:[c("div",{className:"flex gap-x-[10px]",children:[l("p",{className:"font-semibold",children:"Landlord Name: "}),l("p",{className:"capitalize",children:a!=null&&a.owner_name?a==null?void 0:a.owner_name:"Not Avaiable"})]}),c("div",{className:"flex gap-x-[10px]",children:[l("p",{className:"font-semibold",children:"Community Name: "}),l("p",{className:"capitalize",children:a!=null&&a.communityname?a==null?void 0:a.communityname:"Not Avaiable"})]}),c("div",{className:"flex gap-x-[10px]",children:[l("p",{className:"font-semibold",children:"Project Name: "}),l("p",{className:"capitalize",children:a!=null&&a.project_name?a==null?void 0:a.project_name:"Not Avaiable"})]}),c("div",{className:"flex gap-x-[10px]",children:[l("p",{className:"font-semibold",children:"Apartment No: "}),l("p",{className:"capitalize",children:a!=null&&a.unitnumber?a==null?void 0:a.unitnumber:"Not Avaiable"})]}),c("div",{className:"flex gap-x-[10px]",children:[l("p",{className:"font-semibold",children:"Building No: "}),l("p",{className:"capitalize",children:a!=null&&a.building_name?a==null?void 0:a.building_name:"Not Avaiable"})]})]}),l("div",{className:"overflow-x-auto -mx-6 mt-6",children:l("div",{className:"inline-block min-w-full align-middle",children:l("div",{className:"",children:c("table",{className:"min-w-[100%] overflow-x-scroll divide-y divide-slate-100 table-fixed dark:divide-slate-700",...C,children:[l("thead",{className:"bg-slate-200 dark:bg-slate-700",children:R.map(e=>l("tr",{...e.getHeaderGroupProps(),children:e.headers.map(s=>c("th",{...s.getHeaderProps(s.getSortByToggleProps()),scope:"col",className:"table-th",children:[s.render("Header"),l("span",{children:s.isSorted?s.isSortedDesc?" \u{1F53D}":" \u{1F53C}":""})]}))}))}),c("tbody",{className:"bg-white divide-y divide-slate-100 dark:bg-slate-800 dark:divide-slate-700",...x,children:[b&&b.length>0&&b.map(e=>(P(e),l(N,{children:l("tr",{...e.getRowProps(),children:e.cells.map(s=>l("td",{...s.getCellProps(),className:"table-td",children:s.render("Cell")}))})}))),c("tr",{children:[l("td",{}),l("td",{}),l("td",{}),l("td",{}),l("td",{}),l("td",{}),l("td",{className:"table-td",children:(f==null?void 0:f.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))+" Nights"}),l("td",{className:"table-td",children:(_==null?void 0:_.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))+" AED"}),l("td",{className:"table-td",children:(v==null?void 0:v.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))+" AED"})]})]})]})})})}),c("div",{className:"md:flex md:space-y-0 space-y-5 justify-between mt-6 items-center",children:[c("div",{className:" flex items-center space-x-3 rtl:space-x-reverse",children:[l("select",{className:"form-control py-2 w-max",value:Z,onChange:e=>r(Number(e.target.value)),children:[50,100,200].map(e=>c("option",{value:e,children:["Show ",e]},e))}),c("span",{className:"text-sm font-medium text-slate-600 dark:text-slate-300",children:["Page"," ",c("span",{children:[O+1," of ",A.length]})]})]}),c("ul",{className:"flex items-center  space-x-3  rtl:space-x-reverse",children:[l("li",{className:"text-xl leading-4 text-slate-900 dark:text-white rtl:rotate-180",children:l("button",{className:` ${u?"":"opacity-50 cursor-not-allowed"}`,onClick:()=>i(0),disabled:!u,children:l(X,{icon:"heroicons:chevron-double-left-solid"})})}),l("li",{className:"text-sm leading-4 text-slate-900 dark:text-white rtl:rotate-180",children:l("button",{className:` ${u?"":"opacity-50 cursor-not-allowed"}`,onClick:()=>$(),disabled:!u,children:"Prev"})}),A.map((e,s)=>l("li",{children:l("button",{href:"#","aria-current":"page",className:` ${s===O?"bg-slate-900 dark:bg-slate-600  dark:text-slate-200 text-white font-medium ":"bg-slate-100 dark:bg-slate-700 dark:text-slate-400 text-slate-900  font-normal  "}    text-sm rounded leading-[16px] flex h-6 w-6 items-center justify-center transition-all duration-150`,onClick:()=>i(s),children:e+1})},s)),l("li",{className:"text-sm leading-4 text-slate-900 dark:text-white rtl:rotate-180",children:l("button",{className:` ${p?"":"opacity-50 cursor-not-allowed"}`,onClick:()=>y(),disabled:!p,children:"Next"})}),l("li",{className:"text-xl leading-4 text-slate-900 dark:text-white rtl:rotate-180",children:l("button",{onClick:()=>i(o-1),disabled:!p,className:` ${p?"":"opacity-50 cursor-not-allowed"}`,children:l(X,{icon:"heroicons:chevron-double-right-solid"})})})]})]})]})})}),ae={option:(t,a)=>({...t,fontSize:"14px"})},me=()=>{var F;const[t,a]=d.exports.useState({propertyid:"",filteredDates:[]}),[T,j]=d.exports.useState([]),[h,H]=d.exports.useState(""),[g,C]=d.exports.useState(""),[x,R]=d.exports.useState([]),[k,b]=d.exports.useState("");d.exports.useEffect(()=>{fetch("http://dev-rare.srp.ai/property").then(i=>i.json()).then(i=>{const o=i==null?void 0:i.map(r=>({label:r.unitnumber+" | "+r.communityname+" | "+r.projectname+" | "+r.buildingname,value:r._id}));R(o)})},[]),d.exports.useEffect(()=>{(async()=>{if(t!=null&&t.propertyid){const r=await(await fetch(`http://dev-rare.srp.ai/property/${t==null?void 0:t.propertyid}`)).json();r&&b(r)}})()},[t==null?void 0:t.propertyid]),d.exports.useEffect(()=>{(async()=>{const r=await(await fetch("http://dev-rare.srp.ai/booking")).json();H(r)})()},[]);const[y,$]=d.exports.useState({startDate:"",endDate:""}),p=d.exports.useRef(null);d.exports.useEffect(()=>{if(h!=null&&h.length&&(t==null?void 0:t.propertyid)&&(t==null?void 0:t.startDate)&&(t==null?void 0:t.endDate)){const i=h.filter(o=>{let r=!0;return t.propertyid&&o.propertyid!==t.propertyid&&(r=!1),(o==null?void 0:o.checkindate)<(t==null?void 0:t.startDate)&&(o==null?void 0:o.checkindate)>(t==null?void 0:t.endDate)&&(r=!1),r});j(i)}},[t==null?void 0:t.propertyid,t==null?void 0:t.startDate,t==null?void 0:t.endDate,h]),console.log(t,"setUserData"),console.log(T,"allBooking");const u=()=>{C(""),a({...t,filteredDates:[]}),$({startDate:null,endDate:null})},A=async i=>{if(console.log("newValue",i),C(i),!i){a({...t,filteredDates:[]});return}const L=(await(await fetch(`http://dev-rare.srp.ai/booking/api/reservationdate?ownerid=${t==null?void 0:t._id}&${t!=null&&t.propertyid?"propertyid="+(t==null?void 0:t.propertyid)+"&":""}checkindate=${i.startDate}&checkindate=${i.endDate}`)).json()).filter(P=>P.propertyid===t.propertyid&&P.cancelled===!1);a({...t,filteredDates:L})};return l(N,{children:l("div",{className:"xl:col-span-2 col-span-1",children:c(ee,{title:"Booking Report",children:[l("div",{className:"flex flex-row-reverse"}),c("div",{children:[c("form",{className:"lg:grid-cols-3 grid gap-5 grid-cols-1 ",children:[l("div",{className:"w-[100%] col-span-3",children:l("h4",{className:"text-base text-slate-800 dark:text-slate-300 mb-[0.5rem] mt-[0.5rem]",children:"Select Property"})}),l("div",{className:"w-[100%] col-span-3",children:l(te,{label:"Basic Select",className:"react-select",classNamePrefix:"select",options:x,value:x&&g?x.filter(function(i){return i.value===(t==null?void 0:t.propertyid)}):x.filter(function(i){return i.value===(t==null?void 0:t.propertyid)}),onChange:i=>{g?u():a({...t,propertyid:i==null?void 0:i.value})},styles:ae,id:"hh",placeholder:"Select and Search property"})})]}),t.propertyid&&l(N,{children:c("div",{className:"flex justify-end mt-[25px]",children:[l("div",{className:"w-[150px]",children:l("div",{className:"date-range-custom relative",children:l(le,{value:y,inputClassName:"input-class",containerClassName:"container-class",onChange:A,placeholder:"SELECT DATE"})})}),g&&l("div",{className:"flex justify-end",children:l("div",{className:"w-[90px]",children:l("div",{className:"date-range-custom relative",children:l("button",{className:"btn btn-dark text-white  text-center",type:"button",onClick:u,children:"Reset"})})})})]})})]}),(F=t.filteredDates)!=null&&F.length?l(N,{children:l(se,{allBooking:t.filteredDates,propertyData:k,ref:p})}):l(N,{children:l("h6",{className:"text-base text-slate-800 dark:text-slate-300 mb-[0.5rem] mt-[0.5rem]",children:"No Property Data Found"})})]})})})};export{me as default};
