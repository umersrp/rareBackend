import{R as B,r as d,A as ee,b as O,j as s,F as x,c as m,C as te,aq as se}from"./index.68b11098.js";import{D as ce}from"./index.esm.a94653c2.js";import"./jspdf.es.min.399ee22d.js";import"./html2canvas.esm.0eae2bf4.js";import{E as ae}from"./exceljs.min.cc4feaf4.js";import{E as ne}from"./excel.9601f4f9.js";const X=B.forwardRef(({allBooking:e,propertyData:n,fetchDetails:G=!1},R)=>{const b=[{Header:"Sr no",accessor:"id",Cell:({row:t,flatRows:c})=>s("span",{children:c.indexOf(t)+1})},{Header:"MONTH / PERIOD",accessor:"TimePerid",Cell:t=>{var c,a,p,j;return G?s("button",{onClick:()=>{var I,Q;return V(n._id,(I=t==null?void 0:t.cell)!=null&&I.value?(Q=t==null?void 0:t.cell)==null?void 0:Q.value:"")},children:(c=t==null?void 0:t.cell)!=null&&c.value?(a=t==null?void 0:t.cell)==null?void 0:a.value:"Not Available"}):s("span",{children:(p=t==null?void 0:t.cell)!=null&&p.value?(j=t==null?void 0:t.cell)==null?void 0:j.value:"Not Available"})}},{Header:"TOTAL AVAILABLE NUMBER OF NIGHTS / MONTH",accessor:"TotalDaysinMonth",Cell:t=>{var c,a;return s("span",{children:(c=t==null?void 0:t.cell)!=null&&c.value?(a=t==null?void 0:t.cell)==null?void 0:a.value:"Not Available"})}},{Header:"NO OF NIGHTS BOOKED",accessor:"No_of_Booked_Nights",Cell:t=>{var c,a;return s("span",{children:(c=t==null?void 0:t.cell)!=null&&c.value?(a=t==null?void 0:t.cell)==null?void 0:a.value:"Not Available"})}},{Header:"AVERAGE RATE PER NIGHT",accessor:"AveragePerNight",Cell:t=>{var c,a;return s("span",{children:(c=t==null?void 0:t.cell)!=null&&c.value?Number((a=t==null?void 0:t.cell)==null?void 0:a.value).toFixed(2):"Not Available"})}},{Header:"OCCUPANCY RATE",accessor:"OccpancyRate",Cell:t=>{var c,a;return s("span",{children:(c=t==null?void 0:t.cell)!=null&&c.value?Math.round(Number((a=t==null?void 0:t.cell)==null?void 0:a.value).toFixed(2))+" %":"Not Available"})}},{Header:"REFUND /CANCELLATIONT",accessor:"refund",Cell:t=>{var c,a;return s("span",{children:(c=t==null?void 0:t.cell)!=null&&c.value?(a=t==null?void 0:t.cell)==null?void 0:a.value:"Not Available"})}},{Header:"TOTAL BOOKING AMOUNT",accessor:"TotalHostPayable",Cell:t=>{var c,a;return s("span",{children:(c=t==null?void 0:t.cell)!=null&&c.value?Number((a=t==null?void 0:t.cell)==null?void 0:a.value).toFixed(2):"Not Available"})}}],$=d.exports.useMemo(()=>b,[]),A=d.exports.useMemo(()=>e),y=ee(),v=O.exports.useTable({columns:$,data:A,initialState:{pageIndex:0,pageSize:50}},O.exports.useGlobalFilter,O.exports.useSortBy,O.exports.usePagination,O.exports.useRowSelect),{getTableProps:U,getTableBodyProps:T,headerGroups:g,footerGroups:Z,page:E,nextPage:Y,previousPage:D,canNextPage:J,canPreviousPage:_,pageOptions:F,state:w,gotoPage:k,pageCount:K,setPageSize:q,setGlobalFilter:W,prepareRow:L}=v,[P,M]=d.exports.useState(0),[C,z]=d.exports.useState(0),[S,H]=d.exports.useState(0),[l,h]=d.exports.useState(0),[r,o]=d.exports.useState(0),[N,u]=d.exports.useState(0),[i,f]=d.exports.useState(0);d.exports.useEffect(()=>{if(e!=null&&e.length){const t=e.map(c=>{const{TotalDaysinMonth:a}=c;return a});M(t.reduce((c,a)=>c+a,0))}},[e==null?void 0:e.length]),d.exports.useEffect(()=>{if(e!=null&&e.length){const t=e.map(c=>{const{No_of_Booked_Nights:a}=c;return a});z(t.reduce((c,a)=>c+a,0))}},[e==null?void 0:e.length]),d.exports.useEffect(()=>{if(e!=null&&e.length){const t=e.map(a=>{const{OccpancyRate:p}=a;return p});let c=Math.round(t.reduce((a,p)=>a+Number(p),0)/t.length);h(c)}},[e==null?void 0:e.length]),d.exports.useEffect(()=>{var t;if(e!=null&&e.length){let c=0;for(let a=0;a<(e==null?void 0:e.length);a++){let p=parseFloat((t=e[a])==null?void 0:t.totalNonight);c+=p}o(c||0)}},[e==null?void 0:e.length]),d.exports.useEffect(()=>{var t;if(e!=null&&e.length){let c=0;for(let a=0;a<(e==null?void 0:e.length);a++){let p=Number((t=e[a])==null?void 0:t.AveragePerNight);c+=p}u(c||0)}},[e==null?void 0:e.length]),d.exports.useEffect(()=>{var t;if(e!=null&&e.length){let c=0;for(let a=0;a<(e==null?void 0:e.length);a++){let p=Number((t=e[a])==null?void 0:t.TotalHostPayable);c+=p}H(c||0)}},[e==null?void 0:e.length]),d.exports.useEffect(()=>{n._id&&f(n._id)},[n._id]);function V(t,c){let a=new Date(c);if(t){let p=new Date(a.getFullYear(),a.getMonth(),1).toJSON().split("T")[0],j=new Date(a.getFullYear(),a.getMonth()+1,0).toJSON().split("T")[0],I=`/booking-reports?startDate=${p}&endDate=${j}&propertyId=${t}`;y(I)}}return s(x,{children:e&&e.length>0?s(x,{children:m("div",{ref:R,children:[m("div",{className:"mt-[25px]",children:[m("div",{className:"flex gap-x-[10px]",children:[s("p",{className:"font-semibold",children:"Landlord Name: "}),s("p",{className:"capitalize",children:n!=null&&n.owner_name?n==null?void 0:n.owner_name:"Not Available"})]}),m("div",{className:"flex gap-x-[10px]",children:[s("p",{className:"font-semibold",children:"Community Name: "}),s("p",{className:"capitalize",children:n!=null&&n.communityname?n==null?void 0:n.communityname:"Not Available"})]}),m("div",{className:"flex gap-x-[10px]",children:[s("p",{className:"font-semibold",children:"Project Name: "}),s("p",{className:"capitalize",children:n!=null&&n.project_name?n==null?void 0:n.project_name:"Not Available"})]}),m("div",{className:"flex gap-x-[10px]",children:[s("p",{className:"font-semibold",children:"Apartment No: "}),s("p",{className:"capitalize",children:n!=null&&n.unitnumber?n==null?void 0:n.unitnumber:"Not Available"})]}),m("div",{className:"flex gap-x-[10px]",children:[s("p",{className:"font-semibold",children:"Building No: "}),s("p",{className:"capitalize",children:n!=null&&n.building_name?n==null?void 0:n.building_name:"Not Available"})]})]}),s("div",{className:"overflow-x-auto -mx-6 mt-6",children:s("div",{className:"inline-block min-w-full align-middle",children:s("div",{className:"",children:m("table",{className:"min-w-[100%] overflow-x-scroll divide-y divide-slate-100 table-fixed dark:divide-slate-700",...U,children:[s("thead",{className:"bg-slate-200 dark:bg-slate-700",children:g.map(t=>s("tr",{...t.getHeaderGroupProps(),children:t.headers.map(c=>m("th",{...c.getHeaderProps(c.getSortByToggleProps()),scope:"col",className:"table-th",children:[c.render("Header"),s("span",{children:c.isSorted?c.isSortedDesc?" \u{1F53D}":" \u{1F53C}":""})]}))}))}),m("tbody",{className:"bg-white divide-y divide-slate-100 dark:bg-slate-800 dark:divide-slate-700",...T,children:[E&&E.length>0&&E.map(t=>(L(t),s(x,{children:s("tr",{...t.getRowProps(),children:t.cells.map(c=>s("td",{...c.getCellProps(),className:"table-td",children:c.render("Cell")}))})}))),m("tr",{children:[s("td",{className:"font-semibold",children:"TOTAL"}),s("td",{}),m("td",{className:"table-td font-semibold",children:[P==null?void 0:P.toLocaleString()," Available Nights"]}),m("td",{className:"table-td font-semibold",children:[C==null?void 0:C.toLocaleString()," Booked Nights"]}),m("td",{className:"table-td font-semibold",children:[N==null?void 0:N.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})," AED"]}),m("td",{className:"table-td font-semibold",children:[l==null?void 0:l.toLocaleString()," %"]}),s("td",{}),m("td",{className:"table-td font-semibold",children:[S==null?void 0:S.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})," AED"]}),s("td",{})]})]})]})})})})]})}):s(x,{children:s("h6",{className:"text-base text-slate-800 dark:text-slate-300 mb-[0.5rem] mt-[0.5rem]",children:"No Property Data Found"})})})}),le={option:(e,n)=>({...e,fontSize:"14px"})},ue=()=>{var S,H;const[e,n]=d.exports.useState({propertyid:"",filteredDates:[]}),[G,R]=d.exports.useState([]),[b,$]=d.exports.useState(""),[A,y]=d.exports.useState(""),[v,U]=d.exports.useState([]),[T,g]=d.exports.useState(""),[Z,E]=d.exports.useState(""),[Y,D]=d.exports.useState({}),[J,_]=d.exports.useState([]),[F,w]=d.exports.useState([]),[k,K]=d.exports.useState("");d.exports.useEffect(()=>{fetch("http://dev-rare.srp.ai/property").then(l=>l.json()).then(l=>{const h=l==null?void 0:l.map(r=>({label:r.unitnumber+" | "+r.communityname+" | "+r.projectname+" | "+r.buildingname,value:r._id}));U(h)})},[]),d.exports.useEffect(()=>{(async()=>{if(e!=null&&e.propertyid){K(e.propertyid);const r=await(await fetch(`http://dev-rare.srp.ai/property/${e==null?void 0:e.propertyid}`)).json();_(F==null?void 0:F.data),r&&g(r)}})()},[e==null?void 0:e.propertyid]),d.exports.useEffect(()=>{(async()=>{if(e!=null&&e.propertyid){let h=`http://dev-rare.srp.ai/booking/summarybyDates/${e==null?void 0:e.propertyid}`;newValue&&(newValue==null?void 0:newValue.startDate)&&(newValue==null?void 0:newValue.endDate)&&(h+=`?fromdate=${newValue.startDate}&todate=${newValue.endDate}`);const o=await(await fetch(h)).json();_(o==null?void 0:o.data),$(o==null?void 0:o.data)}})()},[]);const[q,W]=d.exports.useState({startDate:"",endDate:""}),L=d.exports.useRef(null),P=async()=>{if(e!=null&&e.propertyid){let l=new Date,h=new Date(l.getFullYear(),l.getMonth()+1,0).toJSON().split("T")[0];l.setMonth(l.getMonth()-6);let r=new Date(l.getFullYear(),l.getMonth(),1).toJSON().split("T")[0],o=`http://dev-rare.srp.ai/booking/summarybyDates/${e==null?void 0:e.propertyid}`;r&&h&&(o+=`?fromdate=${r}&todate=${h}`);const u=await(await fetch(o)).json();R(u.data?u.data:[])}};d.exports.useEffect(()=>{if(b!=null&&b.length&&(e==null?void 0:e.propertyid)&&(e==null?void 0:e.startDate)&&(e==null?void 0:e.endDate)){const l=b.filter(h=>{let r=!0;return e.propertyid&&h.propertyid!==e.propertyid&&(r=!1),(h==null?void 0:h.checkindate)<(e==null?void 0:e.startDate)&&(h==null?void 0:h.checkindate)>(e==null?void 0:e.endDate)&&(r=!1),r});R(l)}P()},[e==null?void 0:e.propertyid,e==null?void 0:e.startDate,e==null?void 0:e.endDate,b]);const M=()=>{y(""),n({...e,filteredDates:[]}),W({startDate:null,endDate:null})},C=async l=>{if(g(!0),y(l),!l){n({...e,filteredDates:[]});return}const r=await(await fetch(`http://dev-rare.srp.ai/booking/summarybyDates/${e==null?void 0:e.propertyid}?fromdate=${l.startDate}&todate=${l.endDate}`)).json();g(!1);let o=T;n({...e,filteredDates:r==null?void 0:r.data});const N={owner_name:o.owner_name,building_name:o.building_name,community_name:o.communityname,project_name:o.project_name,unitnumber:o.unitnumber};E(N),_({filteredData:r==null?void 0:r.data,PropertyData:N})};function z(l){const{filteredData:h,PropertyData:r}=l;let o=[];o.push(r);const N=new ae.Workbook,u=N.addWorksheet("CombinedSheet");if(u.mergeCells("A1:E1"),u.addRow(["PROPERTY DETAIL"]),u.columns=[{header:"Landlord Name",key:"owner_name",width:40,fgColor:{argb:"008000"}},{header:"Community Name",key:"community_name",width:40,fgColor:{argb:"008000"}},{header:"Project Name",key:"project_name",width:40},{header:"Apartment No",key:"unitnumber",width:35},{header:"Building No",key:"building_name",width:55}],o){const i=[["Landlord Name","Community Name","Project Name","Apartment No","Building No"],...o==null?void 0:o.map(f=>[f.owner_name,f.community_name,f.project_name,f.unitnumber,f.building_name])];i==null||i.forEach(f=>{u.addRow(f)}),u.addRow([])}u.addRow(["MONTH / PERIOD","TOTAL AVAILABLE NUMBER OF NIGHTS / MONTH","NO OF NIGHTS BOOKED","AVERAGE RATE PER NIGHT","OCCUPANCY RATE","REFUND /CANCELLATIONT","TOTAL BOOKING AMOUNT"]),h&&(h==null||h.forEach(i=>{u.addRow([i==null?void 0:i.TimePerid,i==null?void 0:i.TotalDaysinMonth,i==null?void 0:i.No_of_Booked_Nights,i==null?void 0:i.AveragePerNight,Math.round(Number(i==null?void 0:i.OccpancyRate).toFixed(2)),i.Occp,i==null?void 0:i.TotalHostPayable])})),u.getRow(2).font={bold:!0},u.getRow(2).fill={type:"pattern",pattern:"solid",fgColor:{argb:"008000"}},u.getRow(8).fill={type:"pattern",pattern:"solid",fgColor:{argb:"008000"}},N.xlsx.writeBuffer().then(i=>{const f=new Blob([i],{type:"application/octet-stream"}),V=URL.createObjectURL(f),t=document.createElement("a");t.href=V,t.download="booking-"+new Date+".xlsx",document.body.appendChild(t),t.click(),document.body.removeChild(t)})}return s(x,{children:s("div",{className:"xl:col-span-2 col-span-1",children:m(te,{title:"Booking Summary",children:[(e==null?void 0:e.filteredDates)&&((S=e==null?void 0:e.filteredDates)==null?void 0:S.length)?s(x,{children:s("div",{className:"flex flex-row-reverse",children:m("button",{className:"h-[34px] rounded-[10px] relative bg-white border1px flex items-center gap-x-[10px] justify-around px-[10px] py-[5px] cursor-pointer",onClick:()=>z(J),children:[s("img",{src:ne,alt:"Excel icon",className:"w-[20px] h-[20px] noselect"}),s("p",{className:"text-[14px] leading regular color-black",children:"Export in Excel"})]})})}):null,m("div",{children:[m("form",{className:"lg:grid-cols-3 grid gap-5 grid-cols-1 ",children:[s("div",{className:"w-[100%] col-span-3",children:s("h4",{className:"text-base text-slate-800 dark:text-slate-300 mb-[0.5rem] mt-[0.5rem]",children:"Select Property"})}),s("div",{className:"w-[100%] col-span-3",children:s(se,{label:"Basic Select",className:"react-select",classNamePrefix:"select",options:v,value:v&&A?v.filter(function(l){return l.value===(e==null?void 0:e.propertyid)}):v.filter(function(l){return l.value===(e==null?void 0:e.propertyid)}),onChange:l=>{A?M():n({...e,propertyid:l==null?void 0:l.value})},styles:le,id:"hh",placeholder:"Select and Search property"})})]}),e.propertyid&&s(x,{children:m("div",{className:"flex justify-end mt-[25px]",children:[s("div",{className:"w-[150px]",children:s("div",{className:"date-range-custom relative",children:s(ce,{value:q,inputClassName:"input-class",containerClassName:"container-class",onChange:C,placeholder:"SELECT DATE"})})}),A&&s("div",{className:"flex justify-end",children:s("div",{className:"w-[90px]",children:s("div",{className:"date-range-custom relative",children:s("button",{className:"btn btn-dark text-white  text-center",type:"button",onClick:M,children:"Reset"})})})})]})})]}),(H=e.filteredDates)!=null&&H.length?s(x,{children:s(X,{allBooking:e.filteredDates,propertyData:Y,ref:L,fetchDetails:!0})}):s(x,{children:T?s(X,{allBooking:G,propertyData:T,ref:L,fetchDetails:!0}):""})]})})})};export{ue as default};
