import{R as Y,r,b as N,j as s,F as u,c as h,C as J,aq as K}from"./index.7a9ec31b.js";import{D as Q}from"./index.esm.b43912ad.js";import"./jspdf.es.min.372240d0.js";import"./html2canvas.esm.0eae2bf4.js";const y=Y.forwardRef(({allBooking:e,propertyData:n},g)=>{const v=t=>{const{contractstartdate:c,contractenddate:a}=t;let m=new Date(c),$=new Date(a);return($.getFullYear()-m.getFullYear())*12+($.getMonth()-m.getMonth())+" Months"},p=[{Header:"Sr no",accessor:"id",Cell:({row:t,flatRows:c})=>s("span",{children:c.indexOf(t)+1})},{Header:"Tenancy contract No",accessor:"tenantcontractno",Cell:t=>{var c,a;return s("span",{children:(c=t==null?void 0:t.cell)!=null&&c.value?(a=t==null?void 0:t.cell)==null?void 0:a.value:"Not Available"})}},{Header:"Status",accessor:t=>`${t.contractenddate}`,Cell:t=>{var c,a;return s("span",{className:"block w-full",children:s("span",{className:` inline-block px-3 min-w-[90px] text-center mx-auto py-1 rounded-[999px] bg-opacity-25 ${new Date((c=t==null?void 0:t.cell)==null?void 0:c.value)>new Date?"text-success-500 bg-success-500":"text-danger-500 bg-danger-500"} `,children:new Date((a=t==null?void 0:t.cell)==null?void 0:a.value)>new Date?"Active":"Expired"})})}},{Header:"Tenancy Start Date",accessor:"contractstartdate",Cell:t=>{var c,a;return s("span",{children:(c=t==null?void 0:t.cell)!=null&&c.value?new Date((a=t==null?void 0:t.cell)==null?void 0:a.value).toDateString():"Not Available"})}},{Header:"Tenancy Expiry Date",accessor:"contractenddate",Cell:t=>{var c,a;return s("span",{children:(c=t==null?void 0:t.cell)!=null&&c.value?new Date((a=t==null?void 0:t.cell)==null?void 0:a.value).toDateString():"Not Available"})}},{Header:"Tenancy Period",accessor:"refund",Cell:t=>{const{original:c}=t.row;return console.log("original",c),s("span",{children:c?v(c):"Not Available"})}},{Header:"Rental Amount",accessor:"rentalamount",Cell:t=>{var c,a,m;return s("span",{children:(c=t==null?void 0:t.cell)!=null&&c.value?((m=Number((a=t==null?void 0:t.cell)==null?void 0:a.value))==null?void 0:m.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0}))+" AED":"Not Available"})}}],A=r.exports.useMemo(()=>p,[]),x=r.exports.useMemo(()=>e),b=N.exports.useTable({columns:A,data:x,initialState:{pageIndex:0,pageSize:50}},N.exports.useGlobalFilter,N.exports.useSortBy,N.exports.usePagination,N.exports.useRowSelect),{getTableProps:C,getTableBodyProps:S,headerGroups:o,footerGroups:F,page:f,nextPage:j,previousPage:H,canNextPage:M,canPreviousPage:P,pageOptions:z,state:E,gotoPage:L,pageCount:T,setPageSize:d,setGlobalFilter:i,prepareRow:l}=b,[R,_]=r.exports.useState(0),[Z,O]=r.exports.useState(0),[V,G]=r.exports.useState(0),[w,q]=r.exports.useState(0),[D,I]=r.exports.useState(0),[k,U]=r.exports.useState(0);return r.exports.useEffect(()=>{if(e!=null&&e.length){const t=e.map(c=>{const{rentalamount:a}=c;return Number(a)});_(t.reduce((c,a)=>c+a,0))}},[e==null?void 0:e.length]),r.exports.useEffect(()=>{if(e!=null&&e.length){const t=e.map(c=>{const{totalNonight:a}=c;return a});O(t.reduce((c,a)=>c+a,0))}},[e==null?void 0:e.length]),r.exports.useEffect(()=>{if(e!=null&&e.length){const t=e.map(a=>{const{Occupancy:m}=a;return m});let c=Math.round(t.reduce((a,m)=>a+m,0)/t.length);q(c)}},[e==null?void 0:e.length]),r.exports.useEffect(()=>{var t;if(e!=null&&e.length){let c=0;for(let a=0;a<(e==null?void 0:e.length);a++){let m=parseFloat((t=e[a])==null?void 0:t.totalNonight);c+=m}I(c||0)}},[e==null?void 0:e.length]),r.exports.useEffect(()=>{var t;if(e!=null&&e.length){let c=0;for(let a=0;a<(e==null?void 0:e.length);a++){let m=parseFloat((t=e[a])==null?void 0:t.averageCost);c+=m}U(c||0)}},[e==null?void 0:e.length]),r.exports.useEffect(()=>{var t;if(e!=null&&e.length){let c=0;for(let a=0;a<(e==null?void 0:e.length);a++){let m=parseFloat((t=e[a])==null?void 0:t.totalhostpayble);c+=m}G(c||0)}},[e==null?void 0:e.length]),s(u,{children:e&&(e==null?void 0:e.length)>0?s(u,{children:h("div",{ref:g,children:[h("div",{className:"mt-[25px]",children:[h("div",{className:"flex gap-x-[10px]",children:[s("p",{className:"font-semibold",children:"Landlord Name: "}),s("p",{className:"capitalize",children:n!=null&&n.owner_name?n==null?void 0:n.owner_name:"Not Available"})]}),h("div",{className:"flex gap-x-[10px]",children:[s("p",{className:"font-semibold",children:"Community Name: "}),s("p",{className:"capitalize",children:n!=null&&n.communityname?n==null?void 0:n.communityname:"Not Available"})]}),h("div",{className:"flex gap-x-[10px]",children:[s("p",{className:"font-semibold",children:"Project Name: "}),s("p",{className:"capitalize",children:n!=null&&n.project_name?n==null?void 0:n.project_name:"Not Available"})]}),h("div",{className:"flex gap-x-[10px]",children:[s("p",{className:"font-semibold",children:"Apartment No: "}),s("p",{className:"capitalize",children:n!=null&&n.unitnumber?n==null?void 0:n.unitnumber:"Not Available"})]}),h("div",{className:"flex gap-x-[10px]",children:[s("p",{className:"font-semibold",children:"Building No: "}),s("p",{className:"capitalize",children:n!=null&&n.building_name?n==null?void 0:n.building_name:"Not Available"})]})]}),s("div",{className:"overflow-x-auto -mx-6 mt-6",children:s("div",{className:"inline-block min-w-full align-middle",children:s("div",{className:"",children:h("table",{className:"min-w-[100%] overflow-x-scroll divide-y divide-slate-100 table-fixed dark:divide-slate-700",...C,children:[s("thead",{className:"bg-slate-200 dark:bg-slate-700",children:o.map(t=>s("tr",{...t.getHeaderGroupProps(),children:t.headers.map(c=>h("th",{...c.getHeaderProps(c.getSortByToggleProps()),scope:"col",className:"table-th",children:[c.render("Header"),s("span",{children:c.isSorted?c.isSortedDesc?" \u{1F53D}":" \u{1F53C}":""})]}))}))}),h("tbody",{className:"bg-white divide-y divide-slate-100 dark:bg-slate-800 dark:divide-slate-700",...S,children:[f&&f.length>0&&f.map(t=>(l(t),s(u,{children:s("tr",{...t.getRowProps(),children:t.cells.map(c=>s("td",{...c.getCellProps(),className:"table-td",children:c.render("Cell")}))})}))),h("tr",{className:"borderBottom",children:[s("td",{}),s("td",{}),s("td",{}),s("td",{}),s("td",{}),s("td",{className:"font-semibold",children:"GROSS RENT INCOME"}),s("td",{className:"table-td font-semibold",children:(R==null?void 0:R.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0}))+" AED"})]})]})]})})})})]})}):s("div",{className:"pl-2",children:s("h6",{className:" text-base text-slate-800 dark:text-slate-300 mb-[0.5rem] mt-[0.5rem]",children:"No Property Data Found"})})})}),W="/assets/RARE-Logo-animate.7e47c055.gif",X={option:(e,n)=>({...e,fontSize:"14px"})},ae=()=>{var T;const[e,n]=r.exports.useState({propertyid:"",filteredDates:[]}),[g,v]=r.exports.useState([]),[p,A]=r.exports.useState(""),[x,b]=r.exports.useState(""),[C,S]=r.exports.useState(!1),[o,F]=r.exports.useState([]),[f,j]=r.exports.useState("");r.exports.useEffect(()=>{fetch("http://portals.rarehomesgroup.com/property").then(d=>d.json()).then(d=>{const i=d==null?void 0:d.map(l=>({label:l.unitnumber+" | "+l.communityname+" | "+l.projectname+" | "+l.buildingname,value:l._id}));F(i)})},[]),r.exports.useEffect(()=>{(async()=>{if(e!=null&&e.propertyid){const l=await(await fetch(`http://portals.rarehomesgroup.com/property/${e==null?void 0:e.propertyid}`)).json();l&&j(l)}})()},[e==null?void 0:e.propertyid]),r.exports.useEffect(()=>{(async()=>{const l=await(await fetch("http://portals.rarehomesgroup.com/booking")).json();A(l)})()},[]);const[H,M]=r.exports.useState({startDate:"",endDate:""}),P=r.exports.useRef(null),z=async()=>{const i=await(await fetch(`http://portals.rarehomesgroup.com/tenantcontract/tenantsummaryreport/${e.propertyid}`)).json();v(i.data),console.log("=============>",i)};r.exports.useEffect(()=>{if(p!=null&&p.length&&(e==null?void 0:e.propertyid)&&(e==null?void 0:e.startDate)&&(e==null?void 0:e.endDate)){const d=p.filter(i=>{let l=!0;return e.propertyid&&i.propertyid!==e.propertyid&&(l=!1),(i==null?void 0:i.checkindate)<(e==null?void 0:e.startDate)&&(i==null?void 0:i.checkindate)>(e==null?void 0:e.endDate)&&(l=!1),l});v(d)}z()},[e==null?void 0:e.propertyid,e==null?void 0:e.startDate,e==null?void 0:e.endDate,p]);const E=()=>{b(""),n({...e,filteredDates:[]}),M({startDate:null,endDate:null})},L=async d=>{if(console.log("newValue",d),S(!0),b(d),!d){n({...e,filteredDates:[]});return}const l=await(await fetch(`http://portals.rarehomesgroup.com/tenantcontract/report/${e.propertyid}?contractstartdate=${d.startDate}&contractenddate=${d.endDate}`)).json();S(!1),n({...e,filteredDates:l==null?void 0:l.data})};return s(u,{children:s("div",{className:"xl:col-span-2 col-span-1",children:h(J,{title:"Tenancy Summary",children:[s("div",{className:"flex flex-row-reverse"}),h("div",{children:[h("form",{className:"lg:grid-cols-3 grid gap-5 grid-cols-1 ",children:[s("div",{className:"w-[100%] col-span-3",children:s("h4",{className:"text-base text-slate-800 dark:text-slate-300 mb-[0.5rem] mt-[0.5rem]",children:"Select Property"})}),s("div",{className:"w-[100%] col-span-3",children:s(K,{label:"Basic Select",className:"react-select",classNamePrefix:"select",options:o,value:o&&x?o.filter(function(d){return d.value===(e==null?void 0:e.propertyid)}):o.filter(function(d){return d.value===(e==null?void 0:e.propertyid)}),onChange:d=>{x?E():n({...e,propertyid:d==null?void 0:d.value})},styles:X,id:"hh",placeholder:"Select and Search property"})})]}),console.log("userData222=========HJKL=====>",e),e.propertyid&&s(u,{children:h("div",{className:"flex justify-end mt-[25px]",children:[s("div",{className:"w-[150px]",children:s("div",{className:"date-range-custom relative",children:s(Q,{value:H,inputClassName:"input-class",containerClassName:"container-class",onChange:L,placeholder:"SELECT DATE"})})}),x&&s("div",{className:"flex justify-end",children:s("div",{className:"w-[90px]",children:s("div",{className:"date-range-custom relative",children:s("button",{className:"btn btn-dark text-white  text-center",type:"button",onClick:E,children:"Reset"})})})})]})})]}),C===!0?s(u,{children:s("div",{className:"flex items-center justify-center h-[100%]",children:s("img",{src:W,width:150,height:150})})}):(T=e==null?void 0:e.filteredDates)!=null&&T.length?s(u,{children:s(y,{allBooking:e.filteredDates,propertyData:f,ref:P})}):s(u,{children:s(y,{allBooking:g,propertyData:f,ref:P})})]})})})};export{ae as default};
