import{R as ue,r as i,A as pe,b as M,j as s,F as b,c as u,f as fe,aq as Ne}from"./index.189aac50.js";import{D as xe}from"./index.esm.4ef30ca2.js";import"./jspdf.es.min.13ae81e9.js";import"./html2canvas.esm.0eae2bf4.js";import{E as be}from"./exceljs.min.f2c90405.js";import{E as ne}from"./excel.9601f4f9.js";const le=ue.forwardRef(({allBooking:e,propertyData:h,fetchDetails:n=!1},H)=>{const S=[{Header:"Sr no",accessor:"id",Cell:({row:t,flatRows:a})=>s("span",{children:a.indexOf(t)+1})},{Header:"MONTH / PERIOD",accessor:"TimePerid",Cell:t=>{var a,r,c,d;return n?s("button",{onClick:()=>{var l,m;return D(h._id,(l=t==null?void 0:t.cell)!=null&&l.value?(m=t==null?void 0:t.cell)==null?void 0:m.value:"")},children:(a=t==null?void 0:t.cell)!=null&&a.value?(r=t==null?void 0:t.cell)==null?void 0:r.value:"Not Available"}):s("span",{children:(c=t==null?void 0:t.cell)!=null&&c.value?(d=t==null?void 0:t.cell)==null?void 0:d.value:"Not Available"})}},{Header:"TOTAL AVAILABLE NUMBER OF NIGHTS / MONTH",accessor:"TotalDaysinMonth",Cell:t=>{var a,r;return s("span",{children:(a=t==null?void 0:t.cell)!=null&&a.value?(r=t==null?void 0:t.cell)==null?void 0:r.value:"Not Available"})}},{Header:"NO OF NIGHTS BOOKED",accessor:"No_of_Booked_Nights",Cell:t=>{var a,r;return s("span",{children:(a=t==null?void 0:t.cell)!=null&&a.value?(r=t==null?void 0:t.cell)==null?void 0:r.value:"Not Available"})}},{Header:"AVERAGE RATE PER NIGHT",accessor:"AveragePerNight",Cell:t=>{var a,r;return s("span",{children:(a=t==null?void 0:t.cell)!=null&&a.value?Number((r=t==null?void 0:t.cell)==null?void 0:r.value).toFixed(2):"Not Available"})}},{Header:"OCCUPANCY RATE",accessor:"OccpancyRate",Cell:t=>{var a,r;return s("span",{children:(a=t==null?void 0:t.cell)!=null&&a.value?Math.round(Number((r=t==null?void 0:t.cell)==null?void 0:r.value).toFixed(2))+" %":"Not Available"})}},{Header:"REFUND /CANCELLATION",accessor:"refund",Cell:t=>{var a,r;return s("span",{children:(a=t==null?void 0:t.cell)!=null&&a.value?(r=t==null?void 0:t.cell)==null?void 0:r.value:"Not Available"})}},{Header:"TOTAL BOOKING AMOUNT",accessor:"TotalHostPayable",Cell:t=>{var a,r;return s("span",{children:(a=t==null?void 0:t.cell)!=null&&a.value?Number((r=t==null?void 0:t.cell)==null?void 0:r.value).toFixed(2):"Not Available"})}}],V=i.exports.useMemo(()=>S,[]),T=i.exports.useMemo(()=>e),j=pe(),A=M.exports.useTable({columns:V,data:T,initialState:{pageIndex:0,pageSize:50}},M.exports.useGlobalFilter,M.exports.useSortBy,M.exports.usePagination,M.exports.useRowSelect),{getTableProps:Y,getTableBodyProps:f,headerGroups:y,footerGroups:re,page:F,nextPage:q,previousPage:W,canNextPage:I,canPreviousPage:P,pageOptions:G,state:de,gotoPage:ie,pageCount:Q,setPageSize:oe,setGlobalFilter:X,prepareRow:Z}=A,[R,w]=i.exports.useState(0),[_,k]=i.exports.useState(0),[C,B]=i.exports.useState(0),[O,ee]=i.exports.useState(0),[te,J]=i.exports.useState(0),[L,$]=i.exports.useState(0),[se,U]=i.exports.useState(0);i.exports.useEffect(()=>{if(e!=null&&e.length){const t=e.map(a=>{const{TotalDaysinMonth:r}=a;return r});w(t.reduce((a,r)=>a+r,0))}},[e==null?void 0:e.length]),i.exports.useEffect(()=>{if(e!=null&&e.length){const t=e.map(a=>{const{No_of_Booked_Nights:r}=a;return r});k(t.reduce((a,r)=>a+r,0))}},[e==null?void 0:e.length]),i.exports.useEffect(()=>{if(e!=null&&e.length){const t=e.map(r=>{const{OccpancyRate:c}=r;return c});let a=Math.round(t.reduce((r,c)=>r+Number(c),0)/t.length);ee(a)}},[e==null?void 0:e.length]),i.exports.useEffect(()=>{var t;if(e!=null&&e.length){let a=0;for(let r=0;r<(e==null?void 0:e.length);r++){let c=parseFloat((t=e[r])==null?void 0:t.totalNonight);a+=c}J(a||0)}},[e==null?void 0:e.length]),i.exports.useEffect(()=>{var t;if(e!=null&&e.length){let a=0;for(let r=0;r<(e==null?void 0:e.length);r++){let c=Number((t=e[r])==null?void 0:t.AveragePerNight);a+=c}$(a||0)}},[e==null?void 0:e.length]),i.exports.useEffect(()=>{var t;if(e!=null&&e.length){let a=0;for(let r=0;r<(e==null?void 0:e.length);r++){let c=Number((t=e[r])==null?void 0:t.TotalHostPayable);a+=c}B(a||0)}},[e==null?void 0:e.length]),i.exports.useEffect(()=>{h._id&&U(h._id)},[h._id]);function D(t,a){let r=new Date(a);if(t){let c=new Date(r.getFullYear(),r.getMonth(),1).toJSON().split("T")[0],d=new Date(r.getFullYear(),r.getMonth()+1,0).toJSON().split("T")[0],l=`/booking-reports?startDate=${c}&endDate=${d}&propertyId=${t}`;j(l)}}return s(b,{children:e&&e.length>0?s(b,{children:u("div",{ref:H,children:[u("div",{className:"mt-[25px]",children:[u("div",{className:"flex gap-x-[10px]",children:[s("p",{className:"font-semibold",children:"Landlord Name: "}),s("p",{className:"capitalize",children:h!=null&&h.owner_name?h==null?void 0:h.owner_name:"Not Available"})]}),u("div",{className:"flex gap-x-[10px]",children:[s("p",{className:"font-semibold",children:"Community Name: "}),s("p",{className:"capitalize",children:h.community_name?h.community_name:h!=null&&h.communityname?h==null?void 0:h.communityname:"Not Available"})]}),u("div",{className:"flex gap-x-[10px]",children:[s("p",{className:"font-semibold",children:"Project Name: "}),s("p",{className:"capitalize",children:h!=null&&h.project_name?h==null?void 0:h.project_name:"Not Available"})]}),u("div",{className:"flex gap-x-[10px]",children:[s("p",{className:"font-semibold",children:"Apartment No: "}),s("p",{className:"capitalize",children:h!=null&&h.unitnumber?h==null?void 0:h.unitnumber:"Not Available"})]}),u("div",{className:"flex gap-x-[10px]",children:[s("p",{className:"font-semibold",children:"Building No: "}),s("p",{className:"capitalize",children:h!=null&&h.building_name?h==null?void 0:h.building_name:"Not Available"})]})]}),s("div",{className:"overflow-x-auto -mx-6 mt-6",children:s("div",{className:"inline-block min-w-full align-middle",children:s("div",{className:"",children:u("table",{className:"min-w-[100%] overflow-x-scroll divide-y divide-slate-100 table-fixed dark:divide-slate-700",...Y,children:[s("thead",{className:"bg-slate-200 dark:bg-slate-700",children:y.map(t=>s("tr",{...t.getHeaderGroupProps(),children:t.headers.map(a=>u("th",{...a.getHeaderProps(a.getSortByToggleProps()),scope:"col",className:"table-th",children:[a.render("Header"),s("span",{children:a.isSorted?a.isSortedDesc?" \u{1F53D}":" \u{1F53C}":""})]}))}))}),u("tbody",{className:"bg-white divide-y divide-slate-100 dark:bg-slate-800 dark:divide-slate-700",...f,children:[F&&F.length>0&&F.map(t=>(Z(t),s(b,{children:s("tr",{...t.getRowProps(),children:t.cells.map(a=>s("td",{...a.getCellProps(),className:"table-td",children:a.render("Cell")}))})}))),u("tr",{children:[s("td",{className:"font-semibold",children:"TOTAL"}),s("td",{}),u("td",{className:"table-td font-semibold",children:[R==null?void 0:R.toLocaleString()," Available Nights"]}),u("td",{className:"table-td font-semibold",children:[_==null?void 0:_.toLocaleString()," Booked Nights"]}),u("td",{className:"table-td font-semibold",children:[L==null?void 0:L.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})," AED"]}),u("td",{className:"table-td font-semibold",children:[O==null?void 0:O.toLocaleString()," %"]}),s("td",{}),u("td",{className:"table-td font-semibold",children:[C==null?void 0:C.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})," AED"]}),s("td",{})]})]})]})})})})]})}):s(b,{children:s("h6",{className:"text-base text-slate-800 dark:text-slate-300 mb-[0.5rem] mt-[0.5rem]",children:"No Property Data Found"})})})}),ge={option:(e,h)=>({...e,fontSize:"14px"})},Fe=()=>{var a,r;const[e,h]=i.exports.useState({propertyid:"",filteredDates:[]}),[n,H]=i.exports.useState([]),[S,V]=i.exports.useState(""),[T,j]=i.exports.useState(""),[A,Y]=i.exports.useState([]),[f,y]=i.exports.useState(""),[re,F]=i.exports.useState(""),[q,W]=i.exports.useState({}),[I,P]=i.exports.useState({PropertyData:{},filteredData:[]}),[G,de]=i.exports.useState([]),[ie,Q]=i.exports.useState(""),[oe,X]=i.exports.useState(0),[Z,R]=i.exports.useState(0),[w,_]=i.exports.useState(0),[k,C]=i.exports.useState(0),[B,O]=i.exports.useState(0),[ee,te]=i.exports.useState(0);i.exports.useEffect(()=>{if(n!=null&&n.length){const c=n.map(d=>{const{TotalDaysinMonth:l}=d;return l});console.log("days"),X(c.reduce((d,l)=>d+l,0))}},[n==null?void 0:n.length]),i.exports.useEffect(()=>{if(n!=null&&n.length){const c=n.map(d=>{const{No_of_Booked_Nights:l}=d;return l});R(c.reduce((d,l)=>d+l,0))}},[n==null?void 0:n.length]),i.exports.useEffect(()=>{if(n!=null&&n.length){const c=n.map(l=>{const{OccpancyRate:m}=l;return m});let d=Math.round(c.reduce((l,m)=>l+Number(m),0)/c.length);C(d)}},[n==null?void 0:n.length]),i.exports.useEffect(()=>{var c;if(n!=null&&n.length){let d=0;for(let l=0;l<(n==null?void 0:n.length);l++){let m=parseFloat((c=n[l])==null?void 0:c.totalNonight);d+=m}O(d||0)}},[n==null?void 0:n.length]),i.exports.useEffect(()=>{var c;if(n!=null&&n.length){let d=0;for(let l=0;l<(n==null?void 0:n.length);l++){let m=Number((c=n[l])==null?void 0:c.AveragePerNight);d+=m}te(d||0)}},[n==null?void 0:n.length]),i.exports.useEffect(()=>{var c;if(n!=null&&n.length){let d=0;for(let l=0;l<(n==null?void 0:n.length);l++){let m=Number((c=n[l])==null?void 0:c.TotalHostPayable);d+=m}console.log("totalbookednights",d),_(d||0)}},[n==null?void 0:n.length]),i.exports.useEffect(()=>{fetch("http://portals.rarehomesgroup.com/property").then(c=>c.json()).then(c=>{const d=c==null?void 0:c.map(l=>({label:l.unitnumber+" | "+l.communityname+" | "+l.projectname+" | "+l.buildingname,value:l._id}));Y(d)})},[]),i.exports.useEffect(()=>{(async()=>{if(e!=null&&e.propertyid){Q(e.propertyid);const l=await(await fetch(`http://portals.rarehomesgroup.com/property/${e==null?void 0:e.propertyid}`)).json();P(G==null?void 0:G.data),l&&y(l)}})()},[e==null?void 0:e.propertyid]),i.exports.useEffect(()=>{(async()=>{if(e!=null&&e.propertyid){let d=`http://portals.rarehomesgroup.com/booking/summarybyDates/${e==null?void 0:e.propertyid}`;newValue&&(newValue==null?void 0:newValue.startDate)&&(newValue==null?void 0:newValue.endDate)&&(d+=`?fromdate=${newValue.startDate}&todate=${newValue.endDate}`);const m=await(await fetch(d)).json();P(m==null?void 0:m.data),V(m==null?void 0:m.data)}})()},[]);const[J,L]=i.exports.useState({startDate:"",endDate:""}),$=i.exports.useRef(null),se=async()=>{if(e!=null&&e.propertyid){let c=new Date().toISOString(),d=new Date(c).getFullYear(),l=new Date(c).getMonth(),m=new Date(d,l+1,0).toJSON().split("T")[0],g=new Date(d,new Date(c).getMonth()-5,1).toJSON().split("T")[0],p=`http://portals.rarehomesgroup.com/booking/summarybyDates/${e==null?void 0:e.propertyid}`;g&&m&&(p+=`?fromdate=${g}&todate=${m}`);const v=await(await fetch(p)).json();H(v.data?v.data:[]);const z={owner_name:f==null?void 0:f.owner_name,building_name:f==null?void 0:f.building_name,community_name:f==null?void 0:f.communityname,project_name:f==null?void 0:f.project_name,unitnumber:f==null?void 0:f.unitnumber};P({filteredData:v==null?void 0:v.data,PropertyData:z})}};i.exports.useEffect(()=>{if(S!=null&&S.length&&(e==null?void 0:e.propertyid)&&(e==null?void 0:e.startDate)&&(e==null?void 0:e.endDate)){const c=S.filter(d=>{let l=!0;return e.propertyid&&d.propertyid!==e.propertyid&&(l=!1),(d==null?void 0:d.checkindate)<(e==null?void 0:e.startDate)&&(d==null?void 0:d.checkindate)>(e==null?void 0:e.endDate)&&(l=!1),l});H(c)}se()},[e==null?void 0:e.propertyid,e==null?void 0:e.startDate,e==null?void 0:e.endDate,S,I]);const U=()=>{j(""),h({...e,filteredDates:[]}),L({startDate:null,endDate:null})},D=async c=>{if(y(!0),j(c),!c){h({...e,filteredDates:[]});return}const l=await(await fetch(`http://portals.rarehomesgroup.com/booking/summarybyDates/${e==null?void 0:e.propertyid}?fromdate=${c.startDate}&todate=${c.endDate}`)).json();y(!1);let m=f;h({...e,filteredDates:l==null?void 0:l.data});const g={owner_name:m.owner_name,building_name:m.building_name,community_name:m.communityname,project_name:m.project_name,unitnumber:m.unitnumber};W(g),F(g),P({filteredData:l==null?void 0:l.data,PropertyData:g})};function t(c){var v,z,ce,ae;const{filteredData:d,PropertyData:l}=c;let m=[];m.push(l),console.log("122222",m,d);const g=new be.Workbook,p=g.addWorksheet("CombinedSheet");p.mergeCells("A1:W1"),p.addRow(["PROPERTY SUMMARY"]),p.columns=[{header:"Landlord Name",key:"owner_name",width:30},{header:"Community Name",key:"community_name",width:40},{header:"Project Name",key:"project_name",width:25},{header:"Apartment No",key:"unitnumber",width:25},{header:"Building No",key:"building_name",width:25},{header:"",key:"",width:20},{header:"",key:"",width:55},{header:"",key:"",width:55}],m&&(console.log("PropertyData",l),[["Landlord Name","Community Name","Project Name","Apartment No","Building No"],...m.map(x=>[x.owner_name,x.community_name,x.project_name,x.unitnumber,x.building_name])].forEach(x=>{p.addRow(x)}),p.addRow([]),p.addRow([]));const K=p.addRow(["MONTH / PERIOD","TOTAL AVAILABLE NUMBER OF NIGHTS / MONTH","NO OF NIGHTS BOOKED","AVERAGE RATE PER NIGHT","OCCUPANCY RATE","REFUND /CANCELLATION","TOTAL BOOKING AMOUNT"]);if(d){d.forEach(o=>{p.addRow([o==null?void 0:o.TimePerid,o==null?void 0:o.TotalDaysinMonth,o==null?void 0:o.No_of_Booked_Nights,Number(o==null?void 0:o.AveragePerNight).toFixed(2),Math.round(Number(o==null?void 0:o.OccpancyRate).toFixed(0))+"%","NOT AVAILABLE",o==null?void 0:o.TotalHostPayable])}),p.addRow([]);const E=d.map(o=>Number(o.AveragePerNight)).reduce((o,N)=>o+N,0),x=p.addRow(["TOTAL",((v=d.map(o=>Number(o.TotalDaysinMonth)).reduce((o,N)=>o+N,0))==null?void 0:v.toLocaleString())+" Available Nights",((z=d.map(o=>Number(o.No_of_Booked_Nights)).reduce((o,N)=>o+N,0))==null?void 0:z.toLocaleString())+"  Booked Nights","AED "+(E==null?void 0:E.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})),Math.round(Number(d.map(o=>Number(o.OccpancyRate)).reduce((o,N)=>o+N,0)/d.length).toFixed(0))+"%","","AED "+((ae=(ce=d.map(o=>Number(o.TotalHostPayable)).reduce((o,N)=>o+N,0))==null?void 0:ce.toLocaleString())==null?void 0:ae.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))]);{const o={type:"pattern",pattern:"solid",fgColor:{argb:"808080"}};x.fill=o,K.fill=o;const N={argb:"FFFFFF"};[x,K].forEach(he=>{he.eachCell({includeEmpty:!0},me=>{me.font={color:N}})})}}p.getRow(2).font={bold:!0},p.getRow(2).fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},p.getRow(3).fill={type:"pattern",pattern:"solid",fgColor:{argb:"808080"}},p.getRow(7).fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},p.getRow(2).font={color:{argb:"FFFFFF"}},p.getRow(3).font={color:{argb:"FFFFFF"}},p.getRow(7).font={color:{argb:"FFFFFF"}},p.getRow(7).alignment={horizontal:"center"},g.xlsx.writeBuffer().then(E=>{const x=new Blob([E],{type:"application/octet-stream"}),o=URL.createObjectURL(x),N=document.createElement("a");N.href=o,N.download="booking-"+new Date+".xlsx",document.body.appendChild(N),N.click(),document.body.removeChild(N)})}return s(b,{children:s("div",{className:"xl:col-span-2 col-span-1",children:u(fe,{title:"Booking Summary",children:[e.propertyid?(e==null?void 0:e.filteredDates)&&((a=e==null?void 0:e.filteredDates)==null?void 0:a.length)?s(b,{children:s("div",{className:"flex flex-row-reverse",children:u("button",{className:"h-[34px] rounded-[10px] relative bg-white border1px flex items-center gap-x-[10px] justify-around px-[10px] py-[5px] cursor-pointer",onClick:()=>t(I),children:[s("img",{src:ne,alt:"Excel icon",className:"w-[20px] h-[20px] noselect"}),s("p",{className:"text-[14px] leading regular color-black",children:"Export in Excel"})]})})}):s(b,{children:s("div",{className:"flex flex-row-reverse",children:u("button",{className:"h-[34px] rounded-[10px] relative bg-white border1px flex items-center gap-x-[10px] justify-around px-[10px] py-[5px] cursor-pointer",onClick:()=>t(I),children:[s("img",{src:ne,alt:"Excel icon",className:"w-[20px] h-[20px] noselect"}),s("p",{className:"text-[14px] leading regular color-black",children:"Export in Excel"})]})})}):null,u("div",{children:[u("form",{className:"lg:grid-cols-3 grid gap-5 grid-cols-1 ",children:[s("div",{className:"w-[100%] col-span-3",children:s("h4",{className:"text-base text-slate-800 dark:text-slate-300 mb-[0.5rem] mt-[0.5rem]",children:"Select Property"})}),s("div",{className:"w-[100%] col-span-3",children:s(Ne,{label:"Basic Select",className:"react-select",classNamePrefix:"select",options:A,value:A&&T?A.filter(function(c){return c.value===(e==null?void 0:e.propertyid)}):A.filter(function(c){return c.value===(e==null?void 0:e.propertyid)}),onChange:c=>{T?U():h({...e,propertyid:c==null?void 0:c.value})},styles:ge,id:"hh",placeholder:"Select and Search property"})})]}),e.propertyid&&s(b,{children:u("div",{className:"flex justify-end mt-[25px]",children:[s("div",{className:"w-[150px]",children:s("div",{className:"date-range-custom relative",children:s(xe,{value:J,inputClassName:"input-class",containerClassName:"container-class",onChange:D,placeholder:"SELECT DATE"})})}),T&&s("div",{className:"flex justify-end",children:s("div",{className:"w-[90px]",children:s("div",{className:"date-range-custom relative",children:s("button",{className:"btn btn-dark text-white  text-center",type:"button",onClick:U,children:"Reset"})})})})]})})]}),(r=e.filteredDates)!=null&&r.length?s(b,{children:s(le,{allBooking:e.filteredDates,propertyData:q,ref:$,fetchDetails:!0})}):s(b,{children:f?s(le,{allBooking:n,propertyData:f,ref:$,fetchDetails:!0}):""})]})})})};export{Fe as default};
