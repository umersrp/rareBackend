import{R as V,r as d,b as F,j as t,F as x,c as m,c5 as B,c6 as w,c9 as ee,C as te,aq as ae,b$ as le}from"./index.4d3efcf7.js";import{D as se}from"./index.esm.e0979674.js";import"./jspdf.es.min.73f0fece.js";import"./html2canvas.esm.0eae2bf4.js";import{L as ne}from"./Rare logo New Gif Loading.02c4dc82.js";import{E as ie}from"./exceljs.min.2271767a.js";import{E as ce}from"./excel.9601f4f9.js";const re=V.forwardRef(({allBooking:c,propertyData:n,loadingPropertyforData:l},N)=>{const _=[{Header:"Sr no",accessor:"id",Cell:({row:e,flatRows:a})=>t("span",{children:a.indexOf(e)+1})},{Header:"Guest Name",accessor:"guestname",Cell:e=>{var a,s;return t("div",{children:t("span",{className:"inline-flex items-center",children:t("span",{className:"text-sm text-slate-600 dark:text-slate-300",children:(a=e==null?void 0:e.cell)!=null&&a.value?(s=e==null?void 0:e.cell)==null?void 0:s.value:"Not Available"})})})}},{Header:"Booking Date",accessor:"reservation_date",Cell:e=>{var a,s;return t("span",{children:(a=e==null?void 0:e.cell)!=null&&a.value?new Date((s=e==null?void 0:e.cell)==null?void 0:s.value).toDateString():"Not Available"})}},{Header:"Confirmation Code",accessor:"confirmationcode",Cell:e=>{var a,s;return t("span",{children:(a=e==null?void 0:e.cell)!=null&&a.value?(s=e==null?void 0:e.cell)==null?void 0:s.value:"Not Available"})}},{Header:"Check in Date",accessor:"checkindate",Cell:e=>{var a,s;return t("span",{children:(a=e==null?void 0:e.cell)!=null&&a.value?(s=e==null?void 0:e.cell)==null?void 0:s.value:"Not Available"})},sortType:(e,a,s,r)=>B(e,a,s,r)},{Header:"Check out Date",accessor:"checkoutdate",Cell:e=>{var a,s;return t("span",{children:(a=e==null?void 0:e.cell)!=null&&a.value?(s=e==null?void 0:e.cell)==null?void 0:s.value:"Not Available"})},sortType:(e,a,s,r)=>w(e,a,s,r)},{Header:"NO OF NIGHTS STAYED",accessor:"nonight",Cell:e=>{var a,s;return t("span",{children:(a=e==null?void 0:e.cell)!=null&&a.value?(s=e==null?void 0:e.cell)==null?void 0:s.value:"0.00"})}},{Header:"RATE PER NIGHT",accessor:"tourismfee",Cell:e=>{var R,K,U,$,D,q,W,Y,J,Q,X,Z;let a=(U=(K=(R=e==null?void 0:e.cell)==null?void 0:R.row)==null?void 0:K.original)!=null&&U.nonight?parseFloat((q=(D=($=e==null?void 0:e.cell)==null?void 0:$.row)==null?void 0:D.original)==null?void 0:q.nonight):0,r=((J=(Y=(W=e==null?void 0:e.cell)==null?void 0:W.row)==null?void 0:Y.original)!=null&&J.roomrenthostpayable?parseFloat((Z=(X=(Q=e==null?void 0:e.cell)==null?void 0:Q.row)==null?void 0:X.original)==null?void 0:Z.roomrenthostpayable):0)/a;return t("span",{children:r?parseFloat(r).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})+" AED":"0.00"})}},{Header:"BOOKING AMOUNT",accessor:"roomrenthostpayable",Cell:e=>{var a,s;return t("span",{children:(a=e==null?void 0:e.cell)!=null&&a.value?parseFloat((s=e==null?void 0:e.cell)==null?void 0:s.value).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})+" AED":"0.00"})}}],C=d.exports.useMemo(()=>_,[]),g=d.exports.useMemo(()=>c),j=F.exports.useTable({columns:C,data:g,initialState:{pageIndex:0,pageSize:50}},F.exports.useGlobalFilter,F.exports.useSortBy,F.exports.usePagination,F.exports.useRowSelect),{getTableProps:b,getTableBodyProps:A,headerGroups:v,footerGroups:H,page:p,nextPage:k,previousPage:E,canNextPage:T,canPreviousPage:I,pageOptions:L,state:S,gotoPage:G,pageCount:z,setPageSize:M,setGlobalFilter:O,prepareRow:P}=j,[u,y]=d.exports.useState(0),[i,h]=d.exports.useState(0),[o,f]=d.exports.useState(0);return d.exports.useEffect(()=>{var e;if(c!=null&&c.length){let a=0;for(let s=0;s<(c==null?void 0:c.length);s++){let r=parseFloat((e=c[s])==null?void 0:e.nonight);a+=r}y(a||0)}},[c==null?void 0:c.length]),d.exports.useEffect(()=>{if(c!=null&&c.length){let s=c.filter(r=>r.roomrenthostpayable!==void 0?r.roomrenthostpayable:null).map(r=>Number(r.roomrenthostpayable)).reduce((r,R)=>r+R,0);console.log("mmmmmmmmmmmm333",s),h(s.toFixed(2))}},[c==null?void 0:c.length]),d.exports.useEffect(()=>{if(u&&i){let e=i/u;f(e)}},[u,i]),t(x,{children:m("div",{ref:N,children:[m("div",{className:"mt-[25px]",children:[m("div",{className:"flex gap-x-[10px]",children:[t("p",{className:"font-semibold",children:"Landlord Name: "}),t("p",{className:"capitalize",children:n!=null&&n.owner_name?n==null?void 0:n.owner_name:"Not Available"})]}),m("div",{className:"flex gap-x-[10px]",children:[t("p",{className:"font-semibold",children:"Community Name: "}),t("p",{className:"capitalize",children:n!=null&&n.communityname?n==null?void 0:n.communityname:"Not Available"})]}),m("div",{className:"flex gap-x-[10px]",children:[t("p",{className:"font-semibold",children:"Project Name: "}),t("p",{className:"capitalize",children:n!=null&&n.project_name?n==null?void 0:n.project_name:"Not Available"})]}),m("div",{className:"flex gap-x-[10px]",children:[t("p",{className:"font-semibold",children:"Apartment No: "}),t("p",{className:"capitalize",children:n!=null&&n.unitnumber?n==null?void 0:n.unitnumber:"Not Available"})]}),m("div",{className:"flex gap-x-[10px]",children:[t("p",{className:"font-semibold",children:"Building No: "}),t("p",{className:"capitalize",children:n!=null&&n.building_name?n==null?void 0:n.building_name:"Not Available"})]})]}),t("div",{className:"overflow-x-auto -mx-6 mt-6",children:t("div",{className:"inline-block min-w-full align-middle",children:t("div",{className:"",children:m("table",{className:"min-w-[100%] overflow-x-scroll divide-y divide-slate-100 table-fixed dark:divide-slate-700",...b,children:[t("thead",{className:"bg-slate-200 dark:bg-slate-700",children:v.map(e=>t("tr",{...e.getHeaderGroupProps(),children:e.headers.map(a=>m("th",{...a.getHeaderProps(a.getSortByToggleProps()),scope:"col",className:"table-th",children:[a.render("Header"),t("span",{children:a.isSorted?a.isSortedDesc?" \u{1F53D}":" \u{1F53C}":""})]}))}))}),m("tbody",{className:"bg-white divide-y divide-slate-100 dark:bg-slate-800 dark:divide-slate-700",...A,children:[p&&p.length>0&&p.map(e=>(P(e),t(x,{children:t("tr",{...e.getRowProps(),children:e.cells.map(a=>t("td",{...a.getCellProps(),className:"table-td",children:a.render("Cell")}))})}))),m("tr",{children:[t("td",{}),t("td",{}),t("td",{}),t("td",{}),t("td",{}),t("td",{className:"font-semibold",children:"TOTAL"}),t("td",{className:"table-td font-semibold",children:(u==null?void 0:u.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))+" Nights"}),t("td",{className:"table-td font-semibold",children:(o==null?void 0:o.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))+" AED"}),t("td",{className:"table-td font-semibold",children:(i==null?void 0:i.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))+" AED"})]})]})]})})})})]})})}),de={option:(c,n)=>({...c,fontSize:"14px"})},ge=()=>{var u,y;const[c,n]=ee(),[l,N]=d.exports.useState({propertyid:c.get("propertyId")?c.get("propertyId"):"",filteredDates:[]}),[_,C]=d.exports.useState([]),[g,j]=d.exports.useState(""),[b,A]=d.exports.useState(""),[v,H]=d.exports.useState([]),[p,k]=d.exports.useState(""),[E,T]=d.exports.useState(!1),[I,L]=d.exports.useState({filteredData:[],PropertyData:{}}),[S,G]=d.exports.useState({startDate:c.get("startDate")?new Date(c.get("startDate")):"",endDate:c.get("endDate")?new Date(c.get("endDate")):""}),z=d.exports.useRef(null);function M(i){const{filteredData:h,PropertyData:o}=i;let f=[];f.push(o);const e=new ie.Workbook,a=e.addWorksheet("Sheet1");a.mergeCells("A1:F1"),a.addRow(["BOOKING REPORTS"]),a.columns=[{header:"Landlord Name",key:"",width:30},{header:"Community Name",key:"",width:40},{header:"Project Name",key:"",width:25},{header:"Apartment No",key:"",width:25},{header:"Building No",key:"",width:25},{header:"",key:"",width:25}],f&&([["Landlord Name","Community Name","Project Name","Apartment No","Building No"],...f.map(r=>[r.owner_name,r.community_name,r.project_name,r.unitnumber,r.building_name])].forEach(r=>{a.addRow(r)}),a.addRow([]),a.addRow([]),a.addRow([]),a.addRow([])),a.addRow(["GUEST NAME","BOOKING DATE","CONFIRMATION CODE","CHECK IN DATE","CHECK OUT DATE","NO OF NIGHTS STAYED","BOOKING AMOUNT"]),h.forEach(s=>{a.addRow([s.guestname,s.Created_At,s.confirmationcode,s.checkin_date,s.checkout_date,s.nonight,Number(s.roomrenthostpayable).toFixed(2)])}),a.getRow(2).font={color:{argb:"FFFFFF"}},a.getRow(2).fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},a.getRow(3).fill={type:"pattern",pattern:"solid",fgColor:{argb:"808080"}},a.getRow(9).fill={type:"pattern",pattern:"solid",fgColor:{argb:"808080"}},a.getRow(3).font={color:{argb:"FFFFFF"}},a.getRow(9).font={color:{argb:"FFFFFF"}},e.xlsx.writeBuffer().then(s=>{le.exports.saveAs(new Blob([s],{type:"application/octet-stream"}),"bookings.xlsx")})}d.exports.useEffect(()=>{fetch("http://dev-rare.srp.ai/property").then(i=>i.json()).then(i=>{const h=i==null?void 0:i.map(o=>({label:o.unitnumber+" | "+o.communityname+" | "+o.projectname+" | "+o.buildingname,value:o._id}));H(h)})},[]),d.exports.useEffect(()=>{(async()=>{if(l!=null&&l.propertyid){const o=await(await fetch(`http://dev-rare.srp.ai/property/${l==null?void 0:l.propertyid}`)).json();o&&k(o),S.startDate&&S.endDate&&P(S)}})()},[l==null?void 0:l.propertyid]),d.exports.useEffect(()=>{if(g!=null&&g.length&&(l==null?void 0:l.propertyid)&&(l==null?void 0:l.startDate)&&(l==null?void 0:l.endDate)){const i=g.filter(h=>{let o=!0;return l.propertyid&&h.propertyid!==l.propertyid&&(o=!1),(h==null?void 0:h.checkindate)<(l==null?void 0:l.startDate)&&(h==null?void 0:h.checkindate)>(l==null?void 0:l.endDate)&&(o=!1),o});C(i)}},[l==null?void 0:l.propertyid,l==null?void 0:l.startDate,l==null?void 0:l.endDate,g]);const O=()=>{A(""),N({...l,filteredDates:[]}),G({startDate:null,endDate:null})},P=async i=>{if(T(!0),A(i),!i){N({...l,filteredDates:[]});return}const f=(await(await fetch(`http://dev-rare.srp.ai/booking/api/reservationdate?propertyid=${l==null?void 0:l.propertyid}&checkindate=${i.startDate}&checkoutdate=${i.endDate}`)).json()).filter(a=>a.propertyid===l.propertyid&&a.cancelled===!1),e={owner_name:p.owner_name,building_name:p.building_name,community_name:p.communityname,project_name:p.project_name,unitnumber:p.unitnumber};T(!1),N({...l,filteredDates:f}),C(f),L({filteredData:f,PropertyData:e})};return t(x,{children:t("div",{className:"xl:col-span-2 col-span-1",children:m(te,{title:"Booking Report",children:[l&&((u=l.filteredDates)==null?void 0:u.length)?t(x,{children:t("div",{className:"flex flex-row-reverse",children:m("button",{className:"h-[34px] rounded-[10px] relative bg-white border1px flex items-center gap-x-[10px] justify-around px-[10px] py-[5px] cursor-pointer",onClick:()=>M(I),children:[t("img",{src:ce,alt:"Excel icon",className:"w-[20px] h-[20px] noselect"}),t("p",{className:"text-[14px] leading regular color-black",children:"Export in Excel"})]})})}):null,m("div",{children:[m("form",{className:"lg:grid-cols-3 grid gap-5 grid-cols-1 ",children:[t("div",{className:"w-[100%] col-span-3",children:t("h4",{className:"text-base text-slate-800 dark:text-slate-300 mb-[0.5rem] mt-[0.5rem]",children:"Select Property"})}),t("div",{className:"w-[100%] col-span-3",children:t(ae,{label:"Basic Select",className:"react-select",classNamePrefix:"select",options:v,value:v&&b?v.filter(function(i){return i.value===(l==null?void 0:l.propertyid)}):v.filter(function(i){return i.value===(l==null?void 0:l.propertyid)}),onChange:i=>{b?O():N({...l,propertyid:i==null?void 0:i.value})},styles:de,id:"hh",placeholder:"Select and Search property"})})]}),l.propertyid&&t(x,{children:E===!0?null:m("div",{className:"flex justify-end mt-[25px]",children:[t("div",{className:"w-[150px]",children:t("div",{className:"date-range-custom relative",children:t(se,{value:S,inputClassName:"input-class",containerClassName:"container-class",onChange:P,placeholder:"SELECT DATE"})})}),b&&t("div",{className:"flex justify-end",children:t("div",{className:"w-[90px]",children:t("div",{className:"date-range-custom relative",children:t("button",{className:"btn btn-dark text-white  text-center",type:"button",onClick:O,children:"Reset"})})})})]})})]}),E===!0?t(x,{children:t("div",{className:"flex items-center justify-center h-[100%]",children:t("img",{src:ne,width:150,height:150})})}):(y=l.filteredDates)!=null&&y.length?t(x,{children:t(re,{loadingPropertyforData:E,allBooking:l.filteredDates,propertyData:p,ref:z})}):t(x,{children:t("h6",{className:"text-base text-slate-800 dark:text-slate-300 mb-[0.5rem] mt-[0.5rem]",children:"No Property Data Found"})})]})})})};export{ge as default};
